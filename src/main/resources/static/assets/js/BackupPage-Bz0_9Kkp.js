import{_ as a}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                *//* empty css                  *//* empty css                   */import{i as e,av as t,J as o,c as n,a as r,y as s,d as l,f as c,D as i,e as d}from"./element-plus-C0Di9U4-.js";import{s as u}from"./request-B41dlSwZ.js";import{d as p,b as m,c as v,Q as f,I as h,o as g,a as b,u as w,S as y}from"./vue-vendor-uyOI1CZy.js";import"./vendor-CE_fW1yV.js";const _={class:"page-container"},j={class:"card-header"},k={class:"action-section"},R={class:"action-item"},x={class:"action-item"},B=a(p({__name:"BackupPage",setup(a){const p=m(!1),B=m(!1),C=m(),D=a=>{var e;"application/octet-stream"===(null==(e=a.raw)?void 0:e.type)||a.name.endsWith(".db")?s.confirm(`您确定要使用文件 "${a.name}" 恢复数据库吗？此操作不可逆。`,"警告",{confirmButtonText:"确定恢复",cancelButtonText:"取消",type:"warning"}).then(()=>{L(a)}).catch(()=>{r.info("已取消恢复操作")}):r.error("只能上传 .db 格式的数据库文件!")},L=async a=>{var e;if(!a.raw)return;B.value=!0;const t=new FormData;t.append("multipartFile",a.raw);try{const a=await u({url:"/backup/upload",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}});if(1!==a.data.code)throw new Error(a.data.msg||"数据库恢复失败");r.success("数据库恢复成功")}catch(o){r.error(o.message||"数据库恢复失败")}finally{B.value=!1,null==(e=C.value)||e.clearFiles()}},T=async()=>{p.value=!0;try{const a=await u({url:"/backup/download",method:"get",responseType:"blob"}),e=new Blob([a.data]),t=window.URL.createObjectURL(e),o=document.createElement("a");o.href=t;const n=(new Date).toISOString().slice(0,19).replace(/:/g,"-");o.setAttribute("download",`tgDrive-backup-${n}.db`),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(t),r.success("数据库备份下载成功")}catch(a){r.error("下载失败："+a.message)}finally{p.value=!1}};return(a,r)=>{const s=l,u=c,m=i,L=d,U=e;return g(),v("div",_,[f(U,{class:"content-card"},{header:h(()=>[b("div",j,[f(s,null,{default:h(()=>[f(w(t))]),_:1}),r[0]||(r[0]=b("span",null,"数据库管理",-1))])]),default:h(()=>[b("div",k,[b("div",R,[r[2]||(r[2]=b("h3",null,"备份数据库",-1)),r[3]||(r[3]=b("p",null,"将当前数据库下载为 .db 文件。请妥善保管备份文件。",-1)),f(u,{type:"primary",onClick:T,loading:p.value,icon:w(o),size:"large"},{default:h(()=>r[1]||(r[1]=[y(" 下载备份 ")])),_:1},8,["loading","icon"])]),f(m,{direction:"horizontal"}),b("div",x,[r[5]||(r[5]=b("h3",null,"恢复数据库",-1)),r[6]||(r[6]=b("p",null,"从 .db 备份文件恢复数据库。此操作将覆盖当前所有数据，请谨慎操作。",-1)),f(L,{ref_key:"uploadRef",ref:C,"auto-upload":!1,"show-file-list":!1,accept:".db","on-change":D},{default:h(()=>[f(u,{type:"danger",loading:B.value,icon:w(n),size:"large",plain:""},{default:h(()=>r[4]||(r[4]=[y(" 选择文件并恢复 ")])),_:1},8,["loading","icon"])]),_:1},512)])])]),_:1})])}}}),[["__scopeId","data-v-3422c4d6"]]);export{B as default};
