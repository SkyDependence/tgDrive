import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                 *//* empty css                *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   */import{e as l,c as a,q as t,B as o,h as d,z as i,r as s,aG as n,s as r,_ as u,A as c,H as p,aH as m,aI as b,i as f,a5 as v,X as _,aJ as g,aK as w,aD as V,G as x}from"./element-plus-D2f55jhA.js";import{a as h}from"./vendor-mcYxur_T.js";import{d as y,r as D,V as A,b as W,l as C,c as U,M as j,D as k,H as M,E as S,o as q,J as P,u as z,a as B,K as R}from"./vue-vendor-Cc5FuWtX.js";const T={class:"webdav-config-container"},E={class:"button-group"},F={class:"usage-content"},G={class:"webdav-url"},H=e(y({__name:"WebDavConfigPage",setup(e){const y=D(),H=D(!1),$=D(!1),I=A({enabled:!0,pathPrefix:"/webdav",requireAuth:!0,allowedRoles:"admin",maxUploadSize:100,allowMkdir:!0,allowDelete:!0,allowMove:!0,allowCopy:!0,description:"WebDAV服务配置"}),J={pathPrefix:[{required:!0,message:"请输入访问路径",trigger:"blur"},{pattern:/^\/.*/,message:"路径必须以/开头",trigger:"blur"}],allowedRoles:[{required:!0,message:"请选择允许的角色",trigger:"change"}],maxUploadSize:[{required:!0,message:"请输入最大上传大小",trigger:"blur"},{type:"number",min:1,max:1024,message:"大小必须在1-1024MB之间",trigger:"blur"}]},K=W(()=>`${window.location.protocol}//${window.location.host}${I.pathPrefix}`),O=async()=>{try{const e=await h.get("/api/webdav-config");1===e.data.code?Object.assign(I,e.data.data):a.error(e.data.msg||"加载配置失败")}catch(e){a.error("加载配置失败")}},L=async()=>{if(y.value)try{await y.value.validate(),H.value=!0;const e=await h.put("/api/webdav-config",I);1===e.data.code?a.success("配置保存成功"):a.error(e.data.msg||"配置保存失败")}catch(e){a.error("配置保存失败")}finally{H.value=!1}},N=()=>{y.value&&(y.value.resetFields(),O())},X=async()=>{try{await x.confirm("确定要恢复默认配置吗？这将覆盖当前所有设置。","确认恢复默认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),$.value=!0;const e=await h.post("/api/webdav-config/reset");1===e.data.code?(a.success("已恢复默认配置"),await O()):a.error(e.data.msg||"恢复默认配置失败")}catch(e){"cancel"!==e&&a.error("恢复默认配置失败")}finally{$.value=!1}},Q=e=>{e||x.confirm("禁用WebDAV服务后，所有WebDAV客户端将无法访问。确定要禁用吗？","确认禁用",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>{I.enabled=!0})},Y=async()=>{const e=K.value,l="WebDAV地址已复制到剪贴板";if(navigator.clipboard&&window.isSecureContext)try{await navigator.clipboard.writeText(e),a.success(l)}catch(t){Z(e,l)}else Z(e,l)},Z=(e,l)=>{const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")?a.success(l):a.error("复制失败，请手动复制")}catch(o){a.error("复制失败，请手动复制")}document.body.removeChild(t)};return C(()=>{O()}),(e,a)=>{const x=d,h=o,D=n,A=s,W=r,C=p,O=c,Z=b,ee=f,le=t,ae=l,te=V;return q(),U("div",T,[j(ae,{class:"config-card"},{header:S(()=>a[10]||(a[10]=[B("div",{class:"card-header"},[B("h2",null,"WebDAV配置"),B("p",{class:"subtitle"},"配置WebDAV服务的访问权限和功能设置")],-1)])),default:S(()=>[j(le,{ref_key:"configFormRef",ref:y,model:I,rules:J,"label-width":"140px",class:"config-form"},{default:S(()=>[j(h,{"content-position":"left"},{default:S(()=>[j(x,null,{default:S(()=>[j(z(i))]),_:1}),a[11]||(a[11]=P(" 基础设置 ",-1))]),_:1,__:[11]}),j(A,{label:"启用WebDAV",prop:"enabled"},{default:S(()=>[j(D,{modelValue:I.enabled,"onUpdate:modelValue":a[0]||(a[0]=e=>I.enabled=e),"active-text":"启用","inactive-text":"禁用",onChange:Q},null,8,["modelValue"]),a[12]||(a[12]=B("div",{class:"form-tip"},"启用后可通过WebDAV协议访问文件",-1))]),_:1,__:[12]}),j(A,{label:"访问路径",prop:"pathPrefix"},{default:S(()=>[j(W,{modelValue:I.pathPrefix,"onUpdate:modelValue":a[1]||(a[1]=e=>I.pathPrefix=e),placeholder:"/webdav",disabled:!I.enabled},null,8,["modelValue","disabled"]),a[13]||(a[13]=B("div",{class:"form-tip"},"WebDAV服务的访问路径前缀",-1))]),_:1,__:[13]}),j(A,{label:"需要认证",prop:"requireAuth"},{default:S(()=>[j(D,{modelValue:I.requireAuth,"onUpdate:modelValue":a[2]||(a[2]=e=>I.requireAuth=e),"active-text":"需要","inactive-text":"不需要",disabled:!I.enabled},null,8,["modelValue","disabled"]),a[14]||(a[14]=B("div",{class:"form-tip"},"是否需要用户名密码认证",-1))]),_:1,__:[14]}),j(h,{"content-position":"left"},{default:S(()=>[j(x,null,{default:S(()=>[j(z(u))]),_:1}),a[15]||(a[15]=P(" 权限设置 ",-1))]),_:1,__:[15]}),j(A,{label:"允许的角色",prop:"allowedRoles"},{default:S(()=>[j(O,{modelValue:I.allowedRoles,"onUpdate:modelValue":a[3]||(a[3]=e=>I.allowedRoles=e),placeholder:"请选择允许访问的用户角色",disabled:!I.enabled},{default:S(()=>[j(C,{label:"仅管理员",value:"admin"}),j(C,{label:"访客用户",value:"visitor"})]),_:1},8,["modelValue","disabled"]),a[16]||(a[16]=B("div",{class:"form-tip"},"设置哪些角色的用户可以访问WebDAV",-1))]),_:1,__:[16]}),j(h,{"content-position":"left"},{default:S(()=>[j(x,null,{default:S(()=>[j(z(m))]),_:1}),a[17]||(a[17]=P(" 功能设置 ",-1))]),_:1,__:[17]}),j(A,{label:"最大上传大小",prop:"maxUploadSize"},{default:S(()=>[j(Z,{modelValue:I.maxUploadSize,"onUpdate:modelValue":a[4]||(a[4]=e=>I.maxUploadSize=e),min:1,max:1024,step:10,disabled:!I.enabled},null,8,["modelValue","disabled"]),a[18]||(a[18]=B("span",{class:"unit"},"MB",-1)),a[19]||(a[19]=B("div",{class:"form-tip"},"单个文件的最大上传大小限制",-1))]),_:1,__:[18,19]}),j(A,{label:"允许创建目录",prop:"allowMkdir"},{default:S(()=>[j(D,{modelValue:I.allowMkdir,"onUpdate:modelValue":a[5]||(a[5]=e=>I.allowMkdir=e),"active-text":"允许","inactive-text":"禁止",disabled:!I.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"允许删除文件",prop:"allowDelete"},{default:S(()=>[j(D,{modelValue:I.allowDelete,"onUpdate:modelValue":a[6]||(a[6]=e=>I.allowDelete=e),"active-text":"允许","inactive-text":"禁止",disabled:!I.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"允许移动文件",prop:"allowMove"},{default:S(()=>[j(D,{modelValue:I.allowMove,"onUpdate:modelValue":a[7]||(a[7]=e=>I.allowMove=e),"active-text":"允许","inactive-text":"禁止",disabled:!I.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"允许复制文件",prop:"allowCopy"},{default:S(()=>[j(D,{modelValue:I.allowCopy,"onUpdate:modelValue":a[8]||(a[8]=e=>I.allowCopy=e),"active-text":"允许","inactive-text":"禁止",disabled:!I.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"配置描述",prop:"description"},{default:S(()=>[j(W,{modelValue:I.description,"onUpdate:modelValue":a[9]||(a[9]=e=>I.description=e),type:"textarea",rows:3,placeholder:"请输入配置描述",disabled:!I.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,null,{default:S(()=>[B("div",E,[j(ee,{type:"primary",onClick:L,loading:H.value},{default:S(()=>[j(x,null,{default:S(()=>[j(z(v))]),_:1}),a[20]||(a[20]=P(" 保存配置 ",-1))]),_:1,__:[20]},8,["loading"]),j(ee,{onClick:N},{default:S(()=>[j(x,null,{default:S(()=>[j(z(_))]),_:1}),a[21]||(a[21]=P(" 重置 ",-1))]),_:1,__:[21]}),j(ee,{onClick:X,loading:$.value},{default:S(()=>[j(x,null,{default:S(()=>[j(z(g))]),_:1}),a[22]||(a[22]=P(" 恢复默认 ",-1))]),_:1,__:[22]},8,["loading"])])]),_:1})]),_:1},8,["model"])]),_:1}),I.enabled?(q(),k(ae,{key:0,class:"usage-card"},{header:S(()=>a[23]||(a[23]=[B("div",{class:"card-header"},[B("h3",null,"WebDAV使用说明")],-1)])),default:S(()=>[B("div",F,[j(te,{title:"WebDAV访问地址",type:"info",closable:!1,"show-icon":""},{default:S(()=>[B("div",G,[B("code",null,R(K.value),1),j(ee,{size:"small",type:"primary",link:"",onClick:Y},{default:S(()=>[j(x,null,{default:S(()=>[j(z(w))]),_:1}),a[24]||(a[24]=P(" 复制 ",-1))]),_:1,__:[24]})])]),_:1}),a[25]||(a[25]=B("div",{class:"usage-steps"},[B("h4",null,"使用步骤："),B("ol",null,[B("li",null,"在支持WebDAV的客户端中添加网络位置"),B("li",null,"输入上述WebDAV访问地址"),B("li",null,"使用您的用户名和密码进行认证"),B("li",null,"即可像本地文件夹一样操作远程文件")])],-1)),a[26]||(a[26]=B("div",{class:"client-recommendations"},[B("h4",null,"推荐客户端："),B("ul",null,[B("li",null,[B("strong",null,"Windows:"),P(" 文件资源管理器、WinSCP")]),B("li",null,[B("strong",null,"macOS:"),P(" Finder、Cyberduck")]),B("li",null,[B("strong",null,"Linux:"),P(" Nautilus、Dolphin")]),B("li",null,[B("strong",null,"移动端:"),P(" ES文件浏览器、FE文件管理器")])])],-1))])]),_:1})):M("",!0)])}}}),[["__scopeId","data-v-cf840e02"]]);export{H as default};
