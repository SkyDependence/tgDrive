import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                *//* empty css                     *//* empty css                 */import{e as a,q as s,s as r,_ as l,r as o,y as d,a9 as u,i as n,h as i,a3 as t,c as p}from"./element-plus-D2f55jhA.js";import{s as m}from"./request-ENSuvgzy.js";import{u as w}from"./user-CqZQgeNy.js";import{d as c,b as v,r as f,c as g,M as P,E as b,o as _,D as h,H as x,u as y,J as V,K as j,a as k}from"./vue-vendor-Cc5FuWtX.js";import"./vendor-mcYxur_T.js";import"./index-BNZ_jOiX.js";const q={class:"page-container"},z={class:"card-header"},U=e(c({__name:"ChangePassword",setup(e){const c=w(),U=v(()=>"admin"===c.role),E=f({username:"",oldPassword:"",newPassword:"",confirmPassword:""}),C=f(),F=f(!1),A=(e,a,s)=>{""===a?s(new Error("请再次输入新密码")):a!==E.value.newPassword?s(new Error("两次输入的密码不一致")):s()},D=v(()=>{const e={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:16,message:"密码长度为6-16位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:A,trigger:"blur"}]};return U.value?e.username=[{required:!0,message:"请输入用户名",trigger:"blur"}]:e.oldPassword=[{required:!0,message:"请输入旧密码",trigger:"blur"}],e}),H=()=>{var e;null==(e=C.value)||e.validate(async e=>{var a;if(e){F.value=!0;try{let e;e=U.value?await m.post("/auth/admin/change-password",{username:E.value.username,newPassword:E.value.newPassword}):await m.post("/auth/change-password",{oldPassword:E.value.oldPassword,newPassword:E.value.newPassword}),1===e.data.code?(p.success("密码修改成功"),null==(a=C.value)||a.resetFields()):p.error(e.data.msg||"密码修改失败")}catch(s){p.error("修改密码失败，请检查网络或联系管理员")}finally{F.value=!1}}})};return(e,p)=>{const m=i,w=r,c=o,v=n,f=s,A=a;return _(),g("div",q,[P(A,{class:"content-card"},{header:b(()=>[k("div",z,[P(m,null,{default:b(()=>[P(y(t))]),_:1}),k("span",null,j(U.value?"管理员修改用户密码":"修改密码"),1)])]),default:b(()=>[P(f,{model:E.value,rules:D.value,ref_key:"passwordFormRef",ref:C,"label-position":"top",class:"password-form"},{default:b(()=>[U.value?(_(),h(c,{key:0,label:"用户名",prop:"username"},{default:b(()=>[P(w,{modelValue:E.value.username,"onUpdate:modelValue":p[0]||(p[0]=e=>E.value.username=e),"prefix-icon":y(l),placeholder:"请输入要修改密码的用户名",size:"large",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1})):x("",!0),U.value?x("",!0):(_(),h(c,{key:1,label:"旧密码",prop:"oldPassword"},{default:b(()=>[P(w,{modelValue:E.value.oldPassword,"onUpdate:modelValue":p[1]||(p[1]=e=>E.value.oldPassword=e),"prefix-icon":y(d),type:"password",placeholder:"请输入您的当前密码",size:"large","show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1})),P(c,{label:"新密码",prop:"newPassword"},{default:b(()=>[P(w,{modelValue:E.value.newPassword,"onUpdate:modelValue":p[2]||(p[2]=e=>E.value.newPassword=e),"prefix-icon":y(d),type:"password",placeholder:"请输入 6-16 位的新密码",size:"large","show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),P(c,{label:"确认新密码",prop:"confirmPassword"},{default:b(()=>[P(w,{modelValue:E.value.confirmPassword,"onUpdate:modelValue":p[3]||(p[3]=e=>E.value.confirmPassword=e),"prefix-icon":y(u),type:"password",placeholder:"请再次输入新密码",size:"large","show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),P(c,null,{default:b(()=>[P(v,{type:"primary",onClick:H,loading:F.value,class:"submit-button",size:"large",block:""},{default:b(()=>[V(j(F.value?"正在提交...":U.value?"修改用户密码":"确认修改"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}}),[["__scopeId","data-v-fae8cb98"]]);export{U as default};
