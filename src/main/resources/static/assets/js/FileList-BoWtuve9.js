import{_ as e}from"./_plugin-vue_export-helper-Bm9C0Znx.js";import{F as l}from"./FilePreview-ws1KVEVL.js";/* empty css                   *//* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css                  *//* empty css                 */import{d as a,r as o,f as i,y as n,c as t,P as s,H as r,o as u,a as c,u as d,ah as p,R as v,I as m,G as f,O as g,M as y,Q as w,aa as h,K as k,$ as C}from"./vue-vendor-B9yd_xiB.js";import{s as b}from"./request-Btv0w3bA.js";import{a as _,i as z,I as U,J as j,K as x,L as I,l as V,v as $,M as P,m as L,N as R,O as T,y as N,d as S,z as B,f as M,P as D,Q as E,R as F,S as K,T as O,U as Q,V as W,k as q,W as A}from"./element-plus-DGu32Jg7.js";import"./vendor-u6XoYjkS.js";const G={class:"page-container"},H={class:"card-header"},J={class:"header-left"},X={class:"header-right"},Y={style:{display:"flex","align-items":"center",gap:"8px"}},Z={key:2},ee=["onClick"],le={class:"file-info"},ae={class:"file-name-mobile"},oe={class:"file-meta"},ie={key:0,class:"file-public"},ne={class:"file-actions"},te={class:"batch-actions"},se={class:"dialog-footer"},re=e(a({__name:"FileList",setup(e){const a=o([]),re=o(!1),ue=o(1),ce=o(10),de=o(0),pe=o(!1),ve=o([]),me=o(!1),fe=o(null),ge=o(!1),ye=o(null),we=o(""),he=()=>{me.value=window.innerWidth<768},ke=e=>ve.value.some(l=>l.fileId===e.fileId),Ce=e=>{ke(e)?ve.value=ve.value.filter(l=>l.fileId!==e.fileId):ve.value.push(e)},be=async()=>{var e,l;re.value=!0;try{let o=`/fileList?page=${ue.value}&size=${ce.value}`;we.value&&(o+=`&keyword=${encodeURIComponent(we.value)}`);const i=await b.get(o);if(1===(null==(e=i.data)?void 0:e.code)){const e=i.data.data;a.value=e.records||[],de.value=e.total||0}else _.error((null==(l=i.data)?void 0:l.msg)||"获取文件列表失败")}catch(o){_.error("获取文件列表失败，请检查网络")}finally{re.value=!1}},_e=e=>{ve.value=e},ze=(e,l)=>{navigator.clipboard.writeText(e).then(()=>{_.success(l)}).catch(e=>{_.error("复制失败: "+e)})},Ue=()=>{const e=ve.value.map(e=>`[${e.fileName}](${e.downloadUrl})`).join("\n");ze(e,`已批量复制 ${ve.value.length} 个 Markdown 链接`)},je=()=>{const e=ve.value.map(e=>e.downloadUrl).join("\n");ze(e,`已批量复制 ${ve.value.length} 个下载链接`)},xe=async()=>{var e,l;if(0!==ve.value.length)try{await N.confirm(`确定要删除选中的 ${ve.value.length} 个文件吗？此操作不可撤销。`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const e=ve.value.map(e=>b.delete(`/file/${e.fileId}`)),l=await Promise.allSettled(e);let a=0,o=0;l.forEach((e,l)=>{"fulfilled"===e.status&&1===e.value.data.code?a++:o++}),a>0&&_.success(`成功删除 ${a} 个文件`),o>0&&_.error(`${o} 个文件删除失败`),ve.value=[],be()}catch(a){"cancel"!==a&&_.error("批量删除失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.msg)||a.message))}else _.warning("请先选择要删除的文件")},Ie=e=>new Date(1e3*e).toLocaleString("zh-CN",{hour12:!1}),Ve=()=>{pe.value=!0},$e=async()=>{var e,l;pe.value=!1;const a=_({message:"正在更新...",type:"info",duration:0});try{const a=await b.put("/file-url");1===(null==(e=a.data)?void 0:e.code)?(_.success("URL 更新成功"),be()):_.error((null==(l=a.data)?void 0:l.msg)||"URL 更新失败")}catch(o){_.error("更新失败，请检查网络")}finally{a.close()}},Pe=e=>{ue.value=e,ve.value=[],be(),me.value&&fe.value&&(fe.value.scrollTop=0)},Le=e=>{ce.value=e,ue.value=1,ve.value=[],be()},Re=e=>{ze(`[${e.fileName}](${e.downloadUrl})`,"Markdown 格式已复制")},Te=e=>{ze(e.downloadUrl,"下载链接已复制")},Ne=e=>{window.open(e,"_blank")},Se=e=>{ye.value=e,ge.value=!0},Be=e=>{Ne(e.downloadUrl)},Me=async e=>{var l,a;try{await N.confirm(`确定要删除文件 "${e.fileName}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const l=await b.delete(`/file/${e.fileId}`);1===l.data.code?(_.success("文件删除成功"),ve.value=ve.value.filter(l=>l.fileId!==e.fileId),be()):_.error(l.data.msg||"删除失败")}catch(o){"cancel"!==o&&_.error("删除文件失败: "+((null==(a=null==(l=o.response)?void 0:l.data)?void 0:a.message)||o.message))}},De=()=>{ue.value=1,be()},Ee=()=>{we.value="",ue.value=1,be()};return i(()=>{he(),window.addEventListener("resize",he),be()}),n(()=>{window.removeEventListener("resize",he)}),(e,o)=>{const i=S,n=B,b=M,_=D,N=E,he=F,be=K,ze=q,Fe=A,Ke=O,Oe=z,Qe=U,We=Q;return u(),t("div",G,[s(Oe,{class:"content-card"},{header:r(()=>[c("div",H,[c("div",J,[s(i,null,{default:r(()=>[s(d(j))]),_:1}),o[7]||(o[7]=c("span",null,"文件列表",-1))]),c("div",X,[s(n,{modelValue:we.value,"onUpdate:modelValue":o[0]||(o[0]=e=>we.value=e),placeholder:"搜索文件名",clearable:"",style:{width:"200px","margin-right":"10px"},onKeyup:p(De,["enter"])},null,8,["modelValue"]),s(b,{type:"primary",onClick:De,icon:d(x)},{default:r(()=>o[8]||(o[8]=[v("搜索")])),_:1},8,["icon"]),s(b,{type:"default",onClick:Ee,icon:d(I)},{default:r(()=>o[9]||(o[9]=[v("全部")])),_:1},8,["icon"]),s(b,{type:"primary",onClick:Ve,icon:d(I),style:{"margin-left":"10px"}},{default:r(()=>o[10]||(o[10]=[v("更新 URL 前缀")])),_:1},8,["icon"])])])]),default:r(()=>[me.value?y("",!0):m((u(),f(be,{key:0,data:a.value,onSelectionChange:_e,height:"calc(100vh - 280px)",style:{width:"100%"}},{default:r(()=>[s(_,{type:"selection",width:"55",align:"center"}),s(_,{prop:"fileName",label:"文件名","min-width":"200","show-overflow-tooltip":"",fixed:"left"},{default:r(e=>[c("div",Y,[s(i,null,{default:r(()=>[s(d(V))]),_:1}),c("span",null,g(e.row.fileName),1)])]),_:1}),s(_,{prop:"size",label:"大小",width:"120",align:"center"}),s(_,{prop:"uploadTime",label:"上传时间",width:"180",align:"center"},{default:r(e=>[v(g(Ie(e.row.uploadTime)),1)]),_:1}),s(_,{label:"公开",width:"100",align:"center"},{default:r(l=>["admin"===e.currentRole||l.row.userId===e.currentUserId?(u(),f(N,{key:0,modelValue:l.row.isPublic,"onUpdate:modelValue":e=>l.row.isPublic=e,onChange:a=>e.updatePublicStatus(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])):y("",!0)]),_:1}),s(_,{label:"操作",width:"480",align:"center",fixed:"right"},{default:r(e=>[s(he,null,{default:r(()=>[s(b,{type:"info",size:"small",onClick:l=>Se(e.row),icon:d($)},{default:r(()=>o[11]||(o[11]=[v("预览")])),_:2},1032,["onClick","icon"]),s(b,{type:"primary",size:"small",onClick:l=>Re(e.row),icon:d(P)},{default:r(()=>o[12]||(o[12]=[v("Markdown")])),_:2},1032,["onClick","icon"]),s(b,{type:"success",size:"small",onClick:l=>Te(e.row),icon:d(L)},{default:r(()=>o[13]||(o[13]=[v("链接")])),_:2},1032,["onClick","icon"]),s(b,{type:"warning",size:"small",onClick:l=>Ne(e.row.downloadUrl),icon:d(R)},{default:r(()=>o[14]||(o[14]=[v("下载")])),_:2},1032,["onClick","icon"]),s(b,{type:"danger",size:"small",onClick:l=>Me(e.row),icon:d(T)},{default:r(()=>o[15]||(o[15]=[v("删除")])),_:2},1032,["onClick","icon"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[We,re.value]]),me.value?(u(),t("div",{key:1,class:"mobile-file-list",ref_key:"mobileListRef",ref:fe},[0!==a.value.length||re.value?y("",!0):(u(),f(ze,{key:0,description:"暂无文件"})),re.value?(u(),f(Fe,{key:1,rows:5,animated:""})):(u(),t("div",Z,[(u(!0),t(w,null,h(a.value,l=>(u(),t("div",{key:l.fileId,class:k(["mobile-file-item",{"is-selected":ke(l)}]),onClick:e=>Ce(l)},[c("div",le,[s(d(W),{"model-value":ke(l),onChange:()=>Ce(l),onClick:o[1]||(o[1]=C(()=>{},["stop"])),size:"large",class:"mobile-checkbox"},null,8,["model-value","onChange"]),s(i,{class:"file-icon"},{default:r(()=>[s(d(V))]),_:1}),c("span",ae,g(l.fileName),1)]),c("div",oe,[c("span",null,"大小: "+g(l.size),1),c("span",null,"上传时间: "+g(Ie(l.uploadTime)),1),"admin"===e.currentRole||l.userId===e.currentUserId?(u(),t("div",ie,[s(N,{modelValue:l.isPublic,"onUpdate:modelValue":e=>l.isPublic=e,onChange:a=>e.updatePublicStatus(l),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"]),o[16]||(o[16]=v(" 公开 "))])):y("",!0)]),c("div",ne,[s(he,null,{default:r(()=>[s(b,{type:"info",size:"small",onClick:C(e=>Se(l),["stop"]),icon:d($),circle:""},null,8,["onClick","icon"]),s(b,{type:"primary",size:"small",onClick:C(e=>Re(l),["stop"]),icon:d(P),circle:""},null,8,["onClick","icon"]),s(b,{type:"success",size:"small",onClick:C(e=>Te(l),["stop"]),icon:d(L),circle:""},null,8,["onClick","icon"]),s(b,{type:"warning",size:"small",onClick:C(e=>Ne(l.downloadUrl),["stop"]),icon:d(R),circle:""},null,8,["onClick","icon"]),s(b,{type:"danger",size:"small",onClick:C(e=>Me(l),["stop"]),icon:d(T),circle:""},null,8,["onClick","icon"])]),_:2},1024)])],10,ee))),128))]))],512)):y("",!0),c("div",{class:k(["footer-toolbar",{"is-mobile":me.value}])},[c("div",te,[s(b,{type:"primary",onClick:Ue,disabled:0===ve.value.length,icon:d(P),plain:""},{default:r(()=>o[17]||(o[17]=[v(" 批量复制 (MD) ")])),_:1},8,["disabled","icon"]),s(b,{type:"success",onClick:je,disabled:0===ve.value.length,icon:d(L),plain:""},{default:r(()=>o[18]||(o[18]=[v(" 批量复制 (链接) ")])),_:1},8,["disabled","icon"]),s(b,{type:"danger",onClick:xe,disabled:0===ve.value.length,icon:d(T),plain:""},{default:r(()=>[v(" 批量删除 ("+g(ve.value.length)+") ",1)]),_:1},8,["disabled","icon"])]),de.value>0?(u(),f(Ke,{key:0,"current-page":ue.value,"onUpdate:currentPage":o[2]||(o[2]=e=>ue.value=e),"page-size":ce.value,"onUpdate:pageSize":o[3]||(o[3]=e=>ce.value=e),total:de.value,"page-sizes":[10,20,50,100],layout:me.value?"sizes, prev, pager, next":"total, sizes, prev, pager, next, jumper",onSizeChange:Le,onCurrentChange:Pe,background:"",small:""},null,8,["current-page","page-size","total","layout"])):y("",!0)],2)]),_:1}),s(Qe,{modelValue:pe.value,"onUpdate:modelValue":o[5]||(o[5]=e=>pe.value=e),title:"更新 URL 前缀",width:"500px"},{footer:r(()=>[c("span",se,[s(b,{onClick:o[4]||(o[4]=e=>pe.value=!1)},{default:r(()=>o[19]||(o[19]=[v("取消")])),_:1}),s(b,{type:"primary",onClick:$e},{default:r(()=>o[20]||(o[20]=[v("确认更新")])),_:1})])]),default:r(()=>[o[21]||(o[21]=c("span",null," 此操作将根据服务器最新配置，更新所有文件的下载链接前缀。当您更换了域名或IP地址后，可以使用此功能。 ",-1))]),_:1},8,["modelValue"]),s(l,{modelValue:ge.value,"onUpdate:modelValue":o[6]||(o[6]=e=>ge.value=e),"file-info":ye.value,onDownload:Be},null,8,["modelValue","file-info"])])}}}),[["__scopeId","data-v-95d41336"]]);export{re as default};
