import{_ as e}from"./_plugin-vue_export-helper-Bm9C0Znx.js";import{F as l}from"./FilePreview-ws1KVEVL.js";/* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css                  *//* empty css                 */import{d as a,r as i,f as n,y as s,c as o,P as t,H as c,o as r,a as u,u as d,ah as p,I as v,G as m,O as f,R as g,M as w,Q as h,aa as y,K as b,$ as k}from"./vue-vendor-B9yd_xiB.js";import{s as C}from"./request-Btv0w3bA.js";import{a as _,i as z,J as j,L as U,K as x,l as $,v as I,M as P,m as T,N as V,O as N,y as B,d as L,f as M,z as S,P as D,Q as R,R as F,S as K,T as E,U as O,k as Q,W}from"./element-plus-DGu32Jg7.js";/* empty css                   */import"./vendor-u6XoYjkS.js";const q={class:"page-container"},A={class:"card-header"},G={class:"search-bar"},H={class:"file-name-cell"},J={class:"file-name"},X={key:2},Y=["onClick"],Z={class:"file-info"},ee={class:"file-header"},le={class:"file-name"},ae={class:"file-meta"},ie={class:"file-size"},ne={class:"file-time"},se={class:"file-status"},oe={class:"file-actions"},te={key:2,class:"batch-operations"},ce={class:"batch-info"},re={class:"batch-buttons"},ue=e(a({__name:"UserFileList",setup(e){const a=i([]),ue=i(!1),de=i(1),pe=i(20),ve=i(0),me=i(""),fe=i([]),ge=i(!1),we=i(),he=i(!1),ye=i(null),be=()=>{ge.value=window.innerWidth<=768},ke=()=>{be()},Ce=async()=>{var e,l;ue.value=!0;try{let i=`/fileList?page=${de.value}&size=${pe.value}`;me.value&&(i+=`&keyword=${encodeURIComponent(me.value)}`);const n=await C.get(i);1===(null==(e=n.data)?void 0:e.code)?(a.value=n.data.data.records||[],ve.value=n.data.data.total||0):_.error((null==(l=n.data)?void 0:l.msg)||"获取文件列表失败")}catch(i){_.error("获取文件列表失败，请检查网络")}finally{ue.value=!1}},_e=e=>{fe.value=e},ze=e=>fe.value.some(l=>l.fileId===e.fileId),je=async()=>{var e,l;if(0!==fe.value.length)try{await B.confirm(`确定要删除选中的 ${fe.value.length} 个文件吗？此操作不可撤销。`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const e=fe.value.map(e=>C.delete(`/file/${e.fileId}`));await Promise.all(e),_.success(`成功删除 ${fe.value.length} 个文件`),fe.value=[],Ce()}catch(a){"cancel"!==a&&_.error("批量删除失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message))}else _.warning("请先选择要删除的文件")},Ue=()=>{if(0===fe.value.length)return void _.warning("请先选择文件");const e=fe.value.map(e=>`![${e.fileName}](${e.downloadUrl})`).join("\n");navigator.clipboard.writeText(e).then(()=>{_.success(`已复制 ${fe.value.length} 个文件的 Markdown 格式`)}).catch(()=>{_.error("复制失败")})},xe=()=>{if(0===fe.value.length)return void _.warning("请先选择文件");const e=fe.value.map(e=>e.downloadUrl).join("\n");navigator.clipboard.writeText(e).then(()=>{_.success(`已复制 ${fe.value.length} 个文件的下载链接`)}).catch(()=>{_.error("复制失败")})},$e=e=>{const l=`![${e.fileName}](${e.downloadUrl})`;navigator.clipboard.writeText(l).then(()=>{_.success("Markdown 格式已复制到剪贴板")}).catch(()=>{_.error("复制失败")})},Ie=e=>{navigator.clipboard.writeText(e.downloadUrl).then(()=>{_.success("下载链接已复制到剪贴板")}).catch(()=>{_.error("复制失败")})},Pe=e=>{window.open(e,"_blank")},Te=async e=>{try{await C.put(`/file/${e.fileId}/public`,{isPublic:e.isPublic}),_.success("文件状态更新成功")}catch(l){_.error("更新文件状态失败"),e.isPublic=!e.isPublic}},Ve=e=>{ye.value=e,he.value=!0},Ne=e=>{Pe(e.downloadUrl)},Be=async e=>{var l,a;try{await B.confirm(`确定要删除文件 "${e.fileName}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const l=await C.delete(`/file/${e.fileId}`);1===l.data.code?(_.success("文件删除成功"),fe.value=fe.value.filter(l=>l.fileId!==e.fileId),Ce()):_.error(l.data.msg||"删除失败")}catch(i){"cancel"!==i&&_.error("删除文件失败: "+((null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||i.message))}},Le=()=>{de.value=1,Ce()},Me=()=>{me.value="",de.value=1,Ce()},Se=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return n(()=>{be(),window.addEventListener("resize",ke),Ce()}),s(()=>{window.removeEventListener("resize",ke)}),(e,i)=>{const n=L,s=M,C=S,_=D,B=R,be=F,ke=K,De=Q,Re=W,Fe=E,Ke=z,Ee=O;return r(),o("div",q,[t(Ke,{class:"content-card"},{header:c(()=>[u("div",A,[t(n,null,{default:c(()=>[t(d(j))]),_:1}),i[4]||(i[4]=u("span",null,"我的文件",-1)),t(s,{type:"primary",onClick:Ce,loading:ue.value,icon:d(U),circle:""},null,8,["loading","icon"])])]),default:c(()=>[u("div",G,[t(C,{modelValue:me.value,"onUpdate:modelValue":i[0]||(i[0]=e=>me.value=e),placeholder:"搜索文件名...","prefix-icon":d(x),onKeyup:p(Le,["enter"]),clearable:"",onClear:Me},{append:c(()=>[t(s,{onClick:Le,icon:d(x)},null,8,["icon"])]),_:1},8,["modelValue","prefix-icon"])]),ge.value?w("",!0):v((r(),m(ke,{key:0,data:a.value,style:{width:"100%"},onSelectionChange:_e,"empty-text":"暂无文件"},{default:c(()=>[t(_,{type:"selection",width:"55"}),t(_,{prop:"fileName",label:"文件名","min-width":"200"},{default:c(e=>[u("div",H,[t(n,{class:"file-icon"},{default:c(()=>[t(d($))]),_:1}),u("span",J,f(e.row.fileName),1)])]),_:1}),t(_,{prop:"size",label:"大小",width:"120",align:"center"}),t(_,{prop:"uploadTime",label:"上传时间",width:"180",align:"center"},{default:c(e=>[u("span",null,f(Se(e.row.uploadTime)),1)]),_:1}),t(_,{label:"公开状态",width:"100",align:"center"},{default:c(e=>[t(B,{modelValue:e.row.isPublic,"onUpdate:modelValue":l=>e.row.isPublic=l,onChange:l=>Te(e.row),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(_,{label:"操作",width:"300",align:"center"},{default:c(e=>[t(be,null,{default:c(()=>[t(s,{type:"info",size:"small",onClick:l=>Ve(e.row),icon:d(I)},{default:c(()=>i[5]||(i[5]=[g("预览")])),_:2},1032,["onClick","icon"]),t(s,{type:"primary",size:"small",onClick:l=>$e(e.row),icon:d(P)},{default:c(()=>i[6]||(i[6]=[g("MD")])),_:2},1032,["onClick","icon"]),t(s,{type:"success",size:"small",onClick:l=>Ie(e.row),icon:d(T)},{default:c(()=>i[7]||(i[7]=[g("链接")])),_:2},1032,["onClick","icon"]),t(s,{type:"warning",size:"small",onClick:l=>Pe(e.row.downloadUrl),icon:d(V)},{default:c(()=>i[8]||(i[8]=[g("下载")])),_:2},1032,["onClick","icon"]),t(s,{type:"danger",size:"small",onClick:l=>Be(e.row),icon:d(N)},{default:c(()=>i[9]||(i[9]=[g("删除")])),_:2},1032,["onClick","icon"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ee,ue.value]]),ge.value?(r(),o("div",{key:1,class:"mobile-file-list",ref_key:"mobileListRef",ref:we},[0!==a.value.length||ue.value?w("",!0):(r(),m(De,{key:0,description:"暂无文件"})),ue.value?(r(),m(Re,{key:1,rows:5,animated:""})):(r(),o("div",X,[(r(!0),o(h,null,y(a.value,e=>(r(),o("div",{key:e.fileId,class:b(["mobile-file-item",{"is-selected":ze(e)}]),onClick:l=>(e=>{const l=fe.value.findIndex(l=>l.fileId===e.fileId);l>-1?fe.value.splice(l,1):fe.value.push(e)})(e)},[u("div",Z,[u("div",ee,[t(n,{class:"file-icon"},{default:c(()=>[t(d($))]),_:1}),u("span",le,f(e.fileName),1)]),u("div",ae,[u("span",ie,f(e.size),1),u("span",ne,f(Se(e.uploadTime)),1)]),u("div",se,[t(B,{modelValue:e.isPublic,"onUpdate:modelValue":l=>e.isPublic=l,onChange:l=>Te(e),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"]),i[10]||(i[10]=g(" 公开 "))])]),u("div",oe,[t(be,null,{default:c(()=>[t(s,{type:"info",size:"small",onClick:k(l=>Ve(e),["stop"]),icon:d(I),circle:""},null,8,["onClick","icon"]),t(s,{type:"primary",size:"small",onClick:k(l=>$e(e),["stop"]),icon:d(P),circle:""},null,8,["onClick","icon"]),t(s,{type:"success",size:"small",onClick:k(l=>Ie(e),["stop"]),icon:d(T),circle:""},null,8,["onClick","icon"]),t(s,{type:"warning",size:"small",onClick:k(l=>Pe(e.downloadUrl),["stop"]),icon:d(V),circle:""},null,8,["onClick","icon"]),t(s,{type:"danger",size:"small",onClick:k(l=>Be(e),["stop"]),icon:d(N),circle:""},null,8,["onClick","icon"])]),_:2},1024)])],10,Y))),128))]))],512)):w("",!0),fe.value.length>0?(r(),o("div",te,[u("div",ce," 已选择 "+f(fe.value.length)+" 个文件 ",1),u("div",re,[t(s,{type:"primary",onClick:Ue,disabled:0===fe.value.length,icon:d(P),plain:""},{default:c(()=>i[11]||(i[11]=[g(" 批量复制 (MD) ")])),_:1},8,["disabled","icon"]),t(s,{type:"success",onClick:xe,disabled:0===fe.value.length,icon:d(T),plain:""},{default:c(()=>i[12]||(i[12]=[g(" 批量复制 (链接) ")])),_:1},8,["disabled","icon"]),t(s,{type:"danger",onClick:je,disabled:0===fe.value.length,icon:d(N),plain:""},{default:c(()=>[g(" 批量删除 ("+f(fe.value.length)+") ",1)]),_:1},8,["disabled","icon"])])])):w("",!0),ve.value>0?(r(),m(Fe,{key:3,"current-page":de.value,"onUpdate:currentPage":i[1]||(i[1]=e=>de.value=e),"page-size":pe.value,"onUpdate:pageSize":i[2]||(i[2]=e=>pe.value=e),total:ve.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ce,onCurrentChange:Ce,class:"pagination"},null,8,["current-page","page-size","total"])):w("",!0)]),_:1}),t(l,{visible:he.value,"onUpdate:visible":i[3]||(i[3]=e=>he.value=e),file:ye.value,onDownload:Ne},null,8,["visible","file"])])}}}),[["__scopeId","data-v-9b76b146"]]);export{ue as default};
