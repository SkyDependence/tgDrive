import{_ as a}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                *//* empty css                    *//* empty css                   */import{e,i as t,M as o,B as r,f as n,j as s,h as l,aC as i,E as c,G as d}from"./element-plus-CgPdM7LF.js";import{s as u}from"./index-DrHwzDkJ.js";import{t as p,r as m,v,M as f,E as h,A as g,u as w,J as b,x as _}from"./vue-vendor-BNZdp1ez.js";import"./vendor-JtNx7una.js";const y={class:"page-container"},j={class:"card-header"},k={class:"action-section"},x={class:"action-item"},B={class:"action-item"},C=a(p({__name:"BackupPage",setup(a){const p=m(!1),C=m(!1),R=m(),E=a=>{var e;"application/octet-stream"===(null==(e=a.raw)?void 0:e.type)||a.name.endsWith(".db")?d.confirm(`您确定要使用文件 "${a.name}" 恢复数据库吗？此操作不可逆。`,"警告",{confirmButtonText:"确定恢复",cancelButtonText:"取消",type:"warning"}).then(()=>{L(a)}).catch(()=>{c.info("已取消恢复操作")}):c.error("只能上传 .db 格式的数据库文件!")},L=async a=>{var e;if(!a.raw)return;C.value=!0;const t=new FormData;t.append("multipartFile",a.raw);try{const a=await u({url:"/backup/upload",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}});if(1!==a.data.code)throw new Error(a.data.msg||"数据库恢复失败");c.success("数据库恢复成功")}catch(o){c.error(o.message||"数据库恢复失败")}finally{C.value=!1,null==(e=R.value)||e.clearFiles()}},T=async()=>{p.value=!0;try{const a=await u({url:"/backup/download",method:"get",responseType:"blob"}),e=new Blob([a.data]),t=window.URL.createObjectURL(e),o=document.createElement("a");o.href=t;const r=(new Date).toISOString().slice(0,19).replace(/:/g,"-");o.setAttribute("download",`tgDrive-backup-${r}.db`),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(t),c.success("数据库备份下载成功")}catch(a){c.error("下载失败："+a.message)}finally{p.value=!1}};return(a,c)=>{const d=l,u=t,m=r,L=n,U=e;return _(),v("div",y,[f(U,{class:"content-card"},{header:h(()=>[g("div",j,[f(d,null,{default:h(()=>[f(w(i))]),_:1}),c[0]||(c[0]=g("span",null,"数据库管理",-1))])]),default:h(()=>[g("div",k,[g("div",x,[c[2]||(c[2]=g("h3",null,"备份数据库",-1)),c[3]||(c[3]=g("p",null,"将当前数据库下载为 .db 文件。请妥善保管备份文件。",-1)),f(u,{type:"primary",onClick:T,loading:p.value,icon:w(o),size:"large"},{default:h(()=>c[1]||(c[1]=[b(" 下载备份 ",-1)])),_:1,__:[1]},8,["loading","icon"])]),f(m,{direction:"horizontal"}),g("div",B,[c[5]||(c[5]=g("h3",null,"恢复数据库",-1)),c[6]||(c[6]=g("p",null,"从 .db 备份文件恢复数据库。此操作将覆盖当前所有数据，请谨慎操作。",-1)),f(L,{ref_key:"uploadRef",ref:R,"auto-upload":!1,"show-file-list":!1,accept:".db","on-change":E},{default:h(()=>[f(u,{type:"danger",loading:C.value,icon:w(s),size:"large",plain:""},{default:h(()=>c[4]||(c[4]=[b(" 选择文件并恢复 ",-1)])),_:1,__:[4]},8,["loading","icon"])]),_:1},512)])])]),_:1})])}}}),[["__scopeId","data-v-ad761a38"]]);export{C as default};
