import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                     *//* empty css                 */import{d as a,r as l,c as s,o as r,a as o,H as i,G as t,D as u,E as n,M as c,u as d,J as v,K as m,L as p,a9 as f,I as g,ah as h,ab as _,av as y}from"./vue-vendor-CxLOoai_.js";import{a0 as b,a1 as k,a2 as w,_ as x,z as C,W as V,a3 as j,R as P,a4 as z,a5 as M,f as I,h as U,X as q,b as T,q as R,Z as A,r as E,s as G,y as H,a6 as K}from"./element-plus-DQjCWvVU.js";import{s as D}from"./request-DvzUJvtB.js";import{u as F}from"./user-CWlPWJjU.js";import"./vendor-CPGCUlN1.js";import"./index-CLLrkTrC.js";const J={class:"captcha-container"},L={class:"captcha-content"},O={class:"checkbox-wrapper"},S={key:1,class:"loading-spinner"},W={class:"captcha-text"},X={key:0},Z={key:1},B={key:2,class:"verified-text"},N={key:0,class:"image-verify-modal"},Q={class:"modal-content"},Y={class:"modal-header"},$={class:"icon-grid"},ee=["onClick"],ae={class:"icon-wrapper"},le={class:"icon-label"},se={key:0,class:"selection-overlay"},re={class:"modal-footer"},oe=e(a({__name:"CaptchaVerify",emits:["verified"],setup(e,{expose:a,emit:h}){const _=h,y=l(!1),R=l(!1),A=l(!1),E=l("汽车"),G=l([]),H=l([{icon:b,name:"房子",isCorrect:!1},{icon:k,name:"星星",isCorrect:!1},{icon:w,name:"铃铛",isCorrect:!1},{icon:x,name:"用户",isCorrect:!1},{icon:C,name:"设置",isCorrect:!1},{icon:V,name:"搜索",isCorrect:!1},{icon:j,name:"编辑",isCorrect:!1},{icon:P,name:"删除",isCorrect:!1},{icon:z,name:"关闭",isCorrect:!1}]),K=async()=>{if(y.value||R.value)return;R.value=!0,await new Promise(e=>setTimeout(e,1500));Math.random()>.3?(R.value=!1,A.value=!0,oe()):(y.value=!0,R.value=!1,_("verified",!0),T.success("验证成功"))},D=()=>{const e=H.value.map((e,a)=>e.isCorrect?a:-1).filter(e=>-1!==e);G.value.length===e.length&&G.value.every(a=>e.includes(a))?(y.value=!0,A.value=!1,G.value=[],_("verified",!0),T.success("验证成功")):(T.error("验证失败，请重试"),F())},F=()=>{G.value=[],oe()},oe=()=>{const e=["房子","星星","铃铛","用户","设置","搜索","编辑","删除","关闭"];if(E.value=e[Math.floor(Math.random()*e.length)],H.value.forEach(e=>{e.isCorrect=e.name===E.value}),!H.value.some(e=>e.isCorrect)){const e=Math.floor(3*Math.random())+1;for(let a=0;a<e;a++){const e=Math.floor(Math.random()*H.value.length);H.value[e].isCorrect=!0}}},ie=()=>{A.value=!1,G.value=[]};return a({reset:()=>{y.value=!1,R.value=!1,A.value=!1,G.value=[],_("verified",!1)}}),(e,a)=>{const l=I,h=U;return r(),s("div",J,[o("div",{class:t(["captcha-box",{verified:y.value,loading:R.value}])},[o("div",L,[o("div",O,[o("div",{class:t(["checkbox",{checked:y.value,loading:R.value}]),onClick:K},[y.value?(r(),u(l,{key:0,class:"check-icon"},{default:n(()=>[c(d(M))]),_:1})):R.value?(r(),s("div",S)):i("",!0)],2)]),o("div",W,[y.value||R.value?R.value?(r(),s("span",Z,"验证中...")):(r(),s("span",B,"验证成功")):(r(),s("span",X,"我不是机器人"))])]),a[0]||(a[0]=o("div",{class:"captcha-logo"},[o("div",{class:"logo-text"},"reCAPTCHA"),o("div",{class:"logo-subtext"},"隐私 - 条款")],-1))],2),A.value?(r(),s("div",N,[o("div",{class:"modal-overlay",onClick:ie}),o("div",Q,[o("div",Y,[o("h3",null,[a[1]||(a[1]=v("选择所有的 ")),o("strong",null,m(E.value),1),a[2]||(a[2]=v(" 图标"))]),c(h,{type:"text",onClick:ie,class:"close-btn"},{default:n(()=>[c(l,null,{default:n(()=>[c(d(z))]),_:1})]),_:1})]),o("div",$,[(r(!0),s(p,null,f(H.value,(e,a)=>(r(),s("div",{key:a,class:t(["icon-item",{selected:G.value.includes(a)}]),onClick:e=>(e=>{const a=G.value.indexOf(e);a>-1?G.value.splice(a,1):G.value.push(e)})(a)},[o("div",ae,[c(l,{class:"challenge-icon"},{default:n(()=>[(r(),u(g(e.icon)))]),_:2},1024),o("span",le,m(e.name),1)]),G.value.includes(a)?(r(),s("div",se,[c(l,{class:"check-mark"},{default:n(()=>[c(d(M))]),_:1})])):i("",!0)],10,ee))),128))]),o("div",re,[c(h,{onClick:F,type:"text"},{default:n(()=>[c(l,null,{default:n(()=>[c(d(q))]),_:1}),a[3]||(a[3]=v(" 刷新 "))]),_:1,__:[3]}),c(h,{type:"primary",onClick:D,disabled:0===G.value.length},{default:n(()=>a[4]||(a[4]=[v(" 验证 ")])),_:1,__:[4]},8,["disabled"])])])])):i("",!0)])}}}),[["__scopeId","data-v-4e689b6c"]]),ie={class:"register-page-container"},te={class:"register-card"},ue={class:"register-header"},ne={class:"login-prompt"},ce=e(a({__name:"registerpage",setup(e){const a=y(),i=F(),t=l(),u=l(),p=l(!1),f=l(!1),g=l({username:"",password:"",confirmPassword:"",email:""}),b={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a)=>a===g.value.password,message:"两次输入密码不一致",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},k=e=>{f.value=e},w=async()=>{if(!p.value&&t.value)if(f.value)try{await t.value.validate(),p.value=!0;const e=await D.post("/auth/register",{username:g.value.username,password:g.value.password,confirmPassword:g.value.confirmPassword,email:g.value.email});if(1===e.data.code){const l=e.data.data;i.setUserInfo({token:l.token,role:l.role,userId:l.UserId,username:l.username,email:l.email}),T.success("注册成功，已自动登录"),"admin"===l.role?a.push("/home"):"user"===l.role?a.push("/user/home"):a.push("/")}else T.error(e.data.msg||"注册失败"),u.value&&(u.value.reset(),f.value=!1)}catch(e){T.error("注册失败，请重试"),u.value&&(u.value.reset(),f.value=!1)}finally{p.value=!1}else T.warning("请先完成人机验证")};return(e,a)=>{const l=I,i=G,y=E,C=U,V=_("router-link"),j=R;return r(),s("div",ie,[o("div",te,[o("div",ue,[c(l,{size:28,color:"var(--el-color-primary)"},{default:n(()=>[c(d(A))]),_:1}),a[4]||(a[4]=o("h2",{class:"register-title"},"创建账户",-1)),a[5]||(a[5]=o("p",{class:"register-subtitle"},"注册以开始使用 ST-TG网盘",-1))]),c(j,{model:g.value,rules:b,ref_key:"registerFormRef",ref:t,"label-position":"top",onKeyup:h(w,["enter"]),class:"register-form"},{default:n(()=>[c(y,{label:"用户名",prop:"username"},{default:n(()=>[c(i,{modelValue:g.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value.username=e),placeholder:"请输入用户名","prefix-icon":d(x),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,{label:"密码",prop:"password"},{default:n(()=>[c(i,{modelValue:g.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value.password=e),type:"password",placeholder:"请输入密码","show-password":"","prefix-icon":d(H),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,{label:"确认密码",prop:"confirmPassword"},{default:n(()=>[c(i,{modelValue:g.value.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value.confirmPassword=e),type:"password",placeholder:"请确认密码","show-password":"","prefix-icon":d(H),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,{label:"邮箱（可选）",prop:"email"},{default:n(()=>[c(i,{modelValue:g.value.email,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value.email=e),type:"email",placeholder:"请输入邮箱地址","prefix-icon":d(K),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,null,{default:n(()=>[c(oe,{onVerified:k,ref_key:"captchaRef",ref:u},null,512)]),_:1}),c(y,null,{default:n(()=>[c(C,{type:"primary",onClick:w,loading:p.value,disabled:!f.value,class:"register-button",size:"large",block:""},{default:n(()=>[v(m(p.value?"注册中...":"注册"),1)]),_:1},8,["loading","disabled"])]),_:1}),c(y,{class:"login-link"},{default:n(()=>[o("div",ne,[a[7]||(a[7]=o("span",{class:"prompt-text"},"已有账户？",-1)),c(V,{to:"/login",class:"login-btn"},{default:n(()=>[c(C,{type:"primary",plain:"",size:"small"},{default:n(()=>a[6]||(a[6]=[v(" 立即登录 ")])),_:1,__:[6]})]),_:1})])]),_:1})]),_:1},8,["model"])])])}}}),[["__scopeId","data-v-9ece0a34"]]);export{ce as default};
