import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                     *//* empty css                 */import{t as a,r as l,v as s,A as r,H as o,G as i,D as t,E as u,M as n,u as c,ab as d,J as v,K as m,L as p,a9 as f,x as g,I as _,aj as h,av as y}from"./vue-vendor-BNZdp1ez.js";import{a0 as k,a1 as w,a2 as x,_ as b,z as C,W as V,a3 as P,R as j,a4 as z,a5 as M,h as I,i as U,X as T,E as q,q as A,Z as E,r as R,s as G,y as H,a6 as K}from"./element-plus-CgPdM7LF.js";import{u as S,s as D}from"./index-DrHwzDkJ.js";import"./vendor-JtNx7una.js";const F={class:"captcha-container"},J={class:"captcha-content"},L={class:"checkbox-wrapper"},O={key:1,class:"loading-spinner"},W={class:"captcha-text"},X={key:0},Z={key:1},B={key:2,class:"verified-text"},N={class:"captcha-logo"},Q={class:"logo-subtext"},Y={key:0,class:"image-verify-modal"},$={class:"modal-content"},ee={class:"modal-header"},ae={class:"icon-grid"},le=["onClick"],se={class:"icon-wrapper"},re={class:"icon-label"},oe={key:0,class:"selection-overlay"},ie={class:"modal-footer"},te=e(a({__name:"CaptchaVerify",emits:["verified"],setup(e,{expose:a,emit:h}){const y=h,A=l(!1),E=l(!1),R=l(!1),G=l("汽车"),H=l([]),K=l([{icon:k,name:"房子",isCorrect:!1},{icon:w,name:"星星",isCorrect:!1},{icon:x,name:"铃铛",isCorrect:!1},{icon:b,name:"用户",isCorrect:!1},{icon:C,name:"设置",isCorrect:!1},{icon:V,name:"搜索",isCorrect:!1},{icon:P,name:"编辑",isCorrect:!1},{icon:j,name:"删除",isCorrect:!1},{icon:z,name:"关闭",isCorrect:!1}]),S=async()=>{if(A.value||E.value)return;E.value=!0,await new Promise(e=>setTimeout(e,1500));Math.random()>.3?(E.value=!1,R.value=!0,ue()):(A.value=!0,E.value=!1,y("verified",!0),q.success("验证成功"))},D=()=>{const e=K.value.map((e,a)=>e.isCorrect?a:-1).filter(e=>-1!==e);H.value.length===e.length&&H.value.every(a=>e.includes(a))?(A.value=!0,R.value=!1,H.value=[],y("verified",!0),q.success("验证成功")):(q.error("验证失败，请重试"),te())},te=()=>{H.value=[],ue()},ue=()=>{const e=["房子","星星","铃铛","用户","设置","搜索","编辑","删除","关闭"];if(G.value=e[Math.floor(Math.random()*e.length)],K.value.forEach(e=>{e.isCorrect=e.name===G.value}),!K.value.some(e=>e.isCorrect)){const e=Math.floor(3*Math.random())+1;for(let a=0;a<e;a++){const e=Math.floor(Math.random()*K.value.length);K.value[e].isCorrect=!0}}},ne=()=>{R.value=!1,H.value=[]};return a({reset:()=>{A.value=!1,E.value=!1,R.value=!1,H.value=[],y("verified",!1)}}),(e,a)=>{const l=I,h=d("router-link"),y=U;return g(),s("div",F,[r("div",{class:i(["captcha-box",{verified:A.value,loading:E.value}])},[r("div",J,[r("div",L,[r("div",{class:i(["checkbox",{checked:A.value,loading:E.value}]),onClick:S},[A.value?(g(),t(l,{key:0,class:"check-icon"},{default:u(()=>[n(c(M))]),_:1})):E.value?(g(),s("div",O)):o("",!0)],2)]),r("div",W,[A.value||E.value?E.value?(g(),s("span",Z,"验证中...")):(g(),s("span",B,"验证成功")):(g(),s("span",X,"我不是机器人"))])]),r("div",N,[a[3]||(a[3]=r("div",{class:"logo-text"},"ST-reCAPTCHA",-1)),r("div",Q,[n(h,{to:"/privacy",class:"privacy-link"},{default:u(()=>a[0]||(a[0]=[v("隐私",-1)])),_:1,__:[0]}),a[2]||(a[2]=r("span",{class:"separator"}," - ",-1)),n(h,{to:"/user-agreement",class:"terms-link"},{default:u(()=>a[1]||(a[1]=[v("条款",-1)])),_:1,__:[1]})])])],2),R.value?(g(),s("div",Y,[r("div",{class:"modal-overlay",onClick:ne}),r("div",$,[r("div",ee,[r("h3",null,[a[4]||(a[4]=v("选择所有的 ",-1)),r("strong",null,m(G.value),1),a[5]||(a[5]=v(" 图标",-1))]),n(y,{type:"text",onClick:ne,class:"close-btn"},{default:u(()=>[n(l,null,{default:u(()=>[n(c(z))]),_:1})]),_:1})]),r("div",ae,[(g(!0),s(p,null,f(K.value,(e,a)=>(g(),s("div",{key:a,class:i(["icon-item",{selected:H.value.includes(a)}]),onClick:e=>(e=>{const a=H.value.indexOf(e);a>-1?H.value.splice(a,1):H.value.push(e)})(a)},[r("div",se,[n(l,{class:"challenge-icon"},{default:u(()=>[(g(),t(_(e.icon)))]),_:2},1024),r("span",re,m(e.name),1)]),H.value.includes(a)?(g(),s("div",oe,[n(l,{class:"check-mark"},{default:u(()=>[n(c(M))]),_:1})])):o("",!0)],10,le))),128))]),r("div",ie,[n(y,{onClick:te,type:"text"},{default:u(()=>[n(l,null,{default:u(()=>[n(c(T))]),_:1}),a[6]||(a[6]=v(" 刷新 ",-1))]),_:1,__:[6]}),n(y,{type:"primary",onClick:D,disabled:0===H.value.length},{default:u(()=>a[7]||(a[7]=[v(" 验证 ",-1)])),_:1,__:[7]},8,["disabled"])])])])):o("",!0)])}}}),[["__scopeId","data-v-57638f10"]]),ue={class:"register-page-container"},ne={class:"register-card"},ce={class:"register-header"},de={class:"login-prompt"},ve={class:"agreement-text"},me=e(a({__name:"registerpage",setup(e){const a=y(),o=S(),i=l(),t=l(),p=l(!1),f=l(!1),_=l({username:"",password:"",confirmPassword:"",email:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a)=>a===_.value.password,message:"两次输入密码不一致",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},w=e=>{f.value=e},x=async()=>{if(!p.value&&i.value)if(f.value)try{await i.value.validate(),p.value=!0;const e=await D.post("/auth/register",{username:_.value.username,password:_.value.password,confirmPassword:_.value.confirmPassword,email:_.value.email});if(1===e.data.code){const l=e.data.data;o.setUserInfo({token:l.token,role:l.role,userId:l.UserId,username:l.username,email:l.email}),q.success("注册成功，已自动登录"),"admin"===l.role?a.push("/home"):"user"===l.role?a.push("/user/home"):a.push("/")}else q.error(e.data.msg||"注册失败"),t.value&&(t.value.reset(),f.value=!1)}catch(e){q.error("注册失败，请重试"),t.value&&(t.value.reset(),f.value=!1)}finally{p.value=!1}else q.warning("请先完成人机验证")};return(e,a)=>{const l=I,o=G,y=R,C=U,V=d("router-link"),P=A;return g(),s("div",ue,[r("div",ne,[r("div",ce,[n(l,{size:28,color:"var(--el-color-primary)"},{default:u(()=>[n(c(E))]),_:1}),a[4]||(a[4]=r("h2",{class:"register-title"},"创建账户",-1)),a[5]||(a[5]=r("p",{class:"register-subtitle"},"注册以开始使用 ST-TG网盘",-1))]),n(P,{model:_.value,rules:k,ref_key:"registerFormRef",ref:i,"label-position":"top",onKeyup:h(x,["enter"]),class:"register-form"},{default:u(()=>[n(y,{label:"用户名",prop:"username"},{default:u(()=>[n(o,{modelValue:_.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>_.value.username=e),placeholder:"请输入用户名","prefix-icon":c(b),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),n(y,{label:"密码",prop:"password"},{default:u(()=>[n(o,{modelValue:_.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value.password=e),type:"password",placeholder:"请输入密码","show-password":"","prefix-icon":c(H),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),n(y,{label:"确认密码",prop:"confirmPassword"},{default:u(()=>[n(o,{modelValue:_.value.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>_.value.confirmPassword=e),type:"password",placeholder:"请确认密码","show-password":"","prefix-icon":c(H),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),n(y,{label:"邮箱（可选）",prop:"email"},{default:u(()=>[n(o,{modelValue:_.value.email,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value.email=e),type:"email",placeholder:"请输入邮箱地址","prefix-icon":c(K),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),n(y,null,{default:u(()=>[n(te,{onVerified:w,ref_key:"captchaRef",ref:t},null,512)]),_:1}),n(y,null,{default:u(()=>[n(C,{type:"primary",onClick:x,loading:p.value,disabled:!f.value,class:"register-button",size:"large",block:""},{default:u(()=>[v(m(p.value?"注册中...":"注册"),1)]),_:1},8,["loading","disabled"])]),_:1}),n(y,{class:"login-link"},{default:u(()=>[r("div",de,[a[7]||(a[7]=r("span",{class:"prompt-text"},"已有账户？",-1)),n(V,{to:"/login",class:"login-btn"},{default:u(()=>[n(C,{type:"primary",plain:"",size:"small"},{default:u(()=>a[6]||(a[6]=[v(" 立即登录 ",-1)])),_:1,__:[6]})]),_:1})])]),_:1}),n(y,{class:"agreement-links"},{default:u(()=>[r("div",ve,[a[10]||(a[10]=r("span",{class:"agreement-prompt"},"注册即表示您同意我们的",-1)),n(V,{to:"/agreement",class:"agreement-link"},{default:u(()=>a[8]||(a[8]=[v(" 用户协议 ",-1)])),_:1,__:[8]}),a[11]||(a[11]=r("span",{class:"agreement-separator"},"和",-1)),n(V,{to:"/privacy",class:"agreement-link"},{default:u(()=>a[9]||(a[9]=[v(" 隐私政策 ",-1)])),_:1,__:[9]})])]),_:1})]),_:1},8,["model"])])])}}}),[["__scopeId","data-v-6d36cd31"]]);export{me as default};
