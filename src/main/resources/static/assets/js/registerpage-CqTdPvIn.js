import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                     *//* empty css                 */import{d as a,r as l,c as s,o as r,a as o,H as i,G as t,D as u,E as n,M as c,u as d,ab as m,J as v,K as p,L as f,a9 as g,I as _,ah as h,av as y}from"./vue-vendor-Cc5FuWtX.js";import{a0 as k,a1 as w,a2 as b,_ as x,z as C,W as V,a3 as j,R as z,a4 as P,a5 as M,h as I,i as U,X as q,c as T,q as A,Z as R,r as E,s as G,y as H,a6 as K}from"./element-plus-D2f55jhA.js";import{s as S}from"./request-ENSuvgzy.js";import{u as D}from"./user-CqZQgeNy.js";import"./vendor-mcYxur_T.js";import"./index-BNZ_jOiX.js";const F={class:"captcha-container"},J={class:"captcha-content"},L={class:"checkbox-wrapper"},O={key:1,class:"loading-spinner"},W={class:"captcha-text"},X={key:0},Z={key:1},B={key:2,class:"verified-text"},N={class:"captcha-logo"},Q={class:"logo-subtext"},Y={key:0,class:"image-verify-modal"},$={class:"modal-content"},ee={class:"modal-header"},ae={class:"icon-grid"},le=["onClick"],se={class:"icon-wrapper"},re={class:"icon-label"},oe={key:0,class:"selection-overlay"},ie={class:"modal-footer"},te=e(a({__name:"CaptchaVerify",emits:["verified"],setup(e,{expose:a,emit:h}){const y=h,A=l(!1),R=l(!1),E=l(!1),G=l("汽车"),H=l([]),K=l([{icon:k,name:"房子",isCorrect:!1},{icon:w,name:"星星",isCorrect:!1},{icon:b,name:"铃铛",isCorrect:!1},{icon:x,name:"用户",isCorrect:!1},{icon:C,name:"设置",isCorrect:!1},{icon:V,name:"搜索",isCorrect:!1},{icon:j,name:"编辑",isCorrect:!1},{icon:z,name:"删除",isCorrect:!1},{icon:P,name:"关闭",isCorrect:!1}]),S=async()=>{if(A.value||R.value)return;R.value=!0,await new Promise(e=>setTimeout(e,1500));Math.random()>.3?(R.value=!1,E.value=!0,ue()):(A.value=!0,R.value=!1,y("verified",!0),T.success("验证成功"))},D=()=>{const e=K.value.map((e,a)=>e.isCorrect?a:-1).filter(e=>-1!==e);H.value.length===e.length&&H.value.every(a=>e.includes(a))?(A.value=!0,E.value=!1,H.value=[],y("verified",!0),T.success("验证成功")):(T.error("验证失败，请重试"),te())},te=()=>{H.value=[],ue()},ue=()=>{const e=["房子","星星","铃铛","用户","设置","搜索","编辑","删除","关闭"];if(G.value=e[Math.floor(Math.random()*e.length)],K.value.forEach(e=>{e.isCorrect=e.name===G.value}),!K.value.some(e=>e.isCorrect)){const e=Math.floor(3*Math.random())+1;for(let a=0;a<e;a++){const e=Math.floor(Math.random()*K.value.length);K.value[e].isCorrect=!0}}},ne=()=>{E.value=!1,H.value=[]};return a({reset:()=>{A.value=!1,R.value=!1,E.value=!1,H.value=[],y("verified",!1)}}),(e,a)=>{const l=I,h=m("router-link"),y=U;return r(),s("div",F,[o("div",{class:t(["captcha-box",{verified:A.value,loading:R.value}])},[o("div",J,[o("div",L,[o("div",{class:t(["checkbox",{checked:A.value,loading:R.value}]),onClick:S},[A.value?(r(),u(l,{key:0,class:"check-icon"},{default:n(()=>[c(d(M))]),_:1})):R.value?(r(),s("div",O)):i("",!0)],2)]),o("div",W,[A.value||R.value?R.value?(r(),s("span",Z,"验证中...")):(r(),s("span",B,"验证成功")):(r(),s("span",X,"我不是机器人"))])]),o("div",N,[a[3]||(a[3]=o("div",{class:"logo-text"},"ST-reCAPTCHA",-1)),o("div",Q,[c(h,{to:"/privacy",class:"privacy-link"},{default:n(()=>a[0]||(a[0]=[v("隐私",-1)])),_:1,__:[0]}),a[2]||(a[2]=o("span",{class:"separator"}," - ",-1)),c(h,{to:"/user-agreement",class:"terms-link"},{default:n(()=>a[1]||(a[1]=[v("条款",-1)])),_:1,__:[1]})])])],2),E.value?(r(),s("div",Y,[o("div",{class:"modal-overlay",onClick:ne}),o("div",$,[o("div",ee,[o("h3",null,[a[4]||(a[4]=v("选择所有的 ",-1)),o("strong",null,p(G.value),1),a[5]||(a[5]=v(" 图标",-1))]),c(y,{type:"text",onClick:ne,class:"close-btn"},{default:n(()=>[c(l,null,{default:n(()=>[c(d(P))]),_:1})]),_:1})]),o("div",ae,[(r(!0),s(f,null,g(K.value,(e,a)=>(r(),s("div",{key:a,class:t(["icon-item",{selected:H.value.includes(a)}]),onClick:e=>(e=>{const a=H.value.indexOf(e);a>-1?H.value.splice(a,1):H.value.push(e)})(a)},[o("div",se,[c(l,{class:"challenge-icon"},{default:n(()=>[(r(),u(_(e.icon)))]),_:2},1024),o("span",re,p(e.name),1)]),H.value.includes(a)?(r(),s("div",oe,[c(l,{class:"check-mark"},{default:n(()=>[c(d(M))]),_:1})])):i("",!0)],10,le))),128))]),o("div",ie,[c(y,{onClick:te,type:"text"},{default:n(()=>[c(l,null,{default:n(()=>[c(d(q))]),_:1}),a[6]||(a[6]=v(" 刷新 ",-1))]),_:1,__:[6]}),c(y,{type:"primary",onClick:D,disabled:0===H.value.length},{default:n(()=>a[7]||(a[7]=[v(" 验证 ",-1)])),_:1,__:[7]},8,["disabled"])])])])):i("",!0)])}}}),[["__scopeId","data-v-57638f10"]]),ue={class:"register-page-container"},ne={class:"register-card"},ce={class:"register-header"},de={class:"login-prompt"},me={class:"agreement-text"},ve=e(a({__name:"registerpage",setup(e){const a=y(),i=D(),t=l(),u=l(),f=l(!1),g=l(!1),_=l({username:"",password:"",confirmPassword:"",email:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a)=>a===_.value.password,message:"两次输入密码不一致",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},w=e=>{g.value=e},b=async()=>{if(!f.value&&t.value)if(g.value)try{await t.value.validate(),f.value=!0;const e=await S.post("/auth/register",{username:_.value.username,password:_.value.password,confirmPassword:_.value.confirmPassword,email:_.value.email});if(1===e.data.code){const l=e.data.data;i.setUserInfo({token:l.token,role:l.role,userId:l.UserId,username:l.username,email:l.email}),T.success("注册成功，已自动登录"),"admin"===l.role?a.push("/home"):"user"===l.role?a.push("/user/home"):a.push("/")}else T.error(e.data.msg||"注册失败"),u.value&&(u.value.reset(),g.value=!1)}catch(e){T.error("注册失败，请重试"),u.value&&(u.value.reset(),g.value=!1)}finally{f.value=!1}else T.warning("请先完成人机验证")};return(e,a)=>{const l=I,i=G,y=E,C=U,V=m("router-link"),j=A;return r(),s("div",ue,[o("div",ne,[o("div",ce,[c(l,{size:28,color:"var(--el-color-primary)"},{default:n(()=>[c(d(R))]),_:1}),a[4]||(a[4]=o("h2",{class:"register-title"},"创建账户",-1)),a[5]||(a[5]=o("p",{class:"register-subtitle"},"注册以开始使用 ST-TG网盘",-1))]),c(j,{model:_.value,rules:k,ref_key:"registerFormRef",ref:t,"label-position":"top",onKeyup:h(b,["enter"]),class:"register-form"},{default:n(()=>[c(y,{label:"用户名",prop:"username"},{default:n(()=>[c(i,{modelValue:_.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>_.value.username=e),placeholder:"请输入用户名","prefix-icon":d(x),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,{label:"密码",prop:"password"},{default:n(()=>[c(i,{modelValue:_.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value.password=e),type:"password",placeholder:"请输入密码","show-password":"","prefix-icon":d(H),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,{label:"确认密码",prop:"confirmPassword"},{default:n(()=>[c(i,{modelValue:_.value.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>_.value.confirmPassword=e),type:"password",placeholder:"请确认密码","show-password":"","prefix-icon":d(H),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,{label:"邮箱（可选）",prop:"email"},{default:n(()=>[c(i,{modelValue:_.value.email,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value.email=e),type:"email",placeholder:"请输入邮箱地址","prefix-icon":d(K),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),c(y,null,{default:n(()=>[c(te,{onVerified:w,ref_key:"captchaRef",ref:u},null,512)]),_:1}),c(y,null,{default:n(()=>[c(C,{type:"primary",onClick:b,loading:f.value,disabled:!g.value,class:"register-button",size:"large",block:""},{default:n(()=>[v(p(f.value?"注册中...":"注册"),1)]),_:1},8,["loading","disabled"])]),_:1}),c(y,{class:"login-link"},{default:n(()=>[o("div",de,[a[7]||(a[7]=o("span",{class:"prompt-text"},"已有账户？",-1)),c(V,{to:"/login",class:"login-btn"},{default:n(()=>[c(C,{type:"primary",plain:"",size:"small"},{default:n(()=>a[6]||(a[6]=[v(" 立即登录 ",-1)])),_:1,__:[6]})]),_:1})])]),_:1}),c(y,{class:"agreement-links"},{default:n(()=>[o("div",me,[a[10]||(a[10]=o("span",{class:"agreement-prompt"},"注册即表示您同意我们的",-1)),c(V,{to:"/agreement",class:"agreement-link"},{default:n(()=>a[8]||(a[8]=[v(" 用户协议 ",-1)])),_:1,__:[8]}),a[11]||(a[11]=o("span",{class:"agreement-separator"},"和",-1)),c(V,{to:"/privacy",class:"agreement-link"},{default:n(()=>a[9]||(a[9]=[v(" 隐私政策 ",-1)])),_:1,__:[9]})])]),_:1})]),_:1},8,["model"])])])}}}),[["__scopeId","data-v-6d36cd31"]]);export{ve as default};
