import{_ as a}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                *//* empty css                  *//* empty css                   */import{k as e,aw as t,O as o,c as r,a as n,F as s,f as l,i as c,J as i,h as d}from"./element-plus-BmgivntE.js";import{s as u}from"./request-DnKA1yHd.js";import{d as p,r as m,c as f,P as v,H as h,o as g,a as w,u as b,R as y}from"./vue-vendor-B9yd_xiB.js";import"./vendor-BVvGM7bJ.js";const _={class:"page-container"},j={class:"card-header"},k={class:"action-section"},R={class:"action-item"},x={class:"action-item"},B=a(p({__name:"BackupPage",setup(a){const p=m(!1),B=m(!1),C=m(),F=a=>{var e;"application/octet-stream"===(null==(e=a.raw)?void 0:e.type)||a.name.endsWith(".db")?s.confirm(`您确定要使用文件 "${a.name}" 恢复数据库吗？此操作不可逆。`,"警告",{confirmButtonText:"确定恢复",cancelButtonText:"取消",type:"warning"}).then(()=>{L(a)}).catch(()=>{n.info("已取消恢复操作")}):n.error("只能上传 .db 格式的数据库文件!")},L=async a=>{var e;if(!a.raw)return;B.value=!0;const t=new FormData;t.append("multipartFile",a.raw);try{const a=await u({url:"/backup/upload",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}});if(1!==a.data.code)throw new Error(a.data.msg||"数据库恢复失败");n.success("数据库恢复成功")}catch(o){n.error(o.message||"数据库恢复失败")}finally{B.value=!1,null==(e=C.value)||e.clearFiles()}},O=async()=>{p.value=!0;try{const a=await u({url:"/backup/download",method:"get",responseType:"blob"}),e=new Blob([a.data]),t=window.URL.createObjectURL(e),o=document.createElement("a");o.href=t;const r=(new Date).toISOString().slice(0,19).replace(/:/g,"-");o.setAttribute("download",`tgDrive-backup-${r}.db`),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(t),n.success("数据库备份下载成功")}catch(a){n.error("下载失败："+a.message)}finally{p.value=!1}};return(a,n)=>{const s=l,u=c,m=i,L=d,T=e;return g(),f("div",_,[v(T,{class:"content-card"},{header:h(()=>[w("div",j,[v(s,null,{default:h(()=>[v(b(t))]),_:1}),n[0]||(n[0]=w("span",null,"数据库管理",-1))])]),default:h(()=>[w("div",k,[w("div",R,[n[2]||(n[2]=w("h3",null,"备份数据库",-1)),n[3]||(n[3]=w("p",null,"将当前数据库下载为 .db 文件。请妥善保管备份文件。",-1)),v(u,{type:"primary",onClick:O,loading:p.value,icon:b(o),size:"large"},{default:h(()=>n[1]||(n[1]=[y(" 下载备份 ")])),_:1},8,["loading","icon"])]),v(m,{direction:"horizontal"}),w("div",x,[n[5]||(n[5]=w("h3",null,"恢复数据库",-1)),n[6]||(n[6]=w("p",null,"从 .db 备份文件恢复数据库。此操作将覆盖当前所有数据，请谨慎操作。",-1)),v(L,{ref_key:"uploadRef",ref:C,"auto-upload":!1,"show-file-list":!1,accept:".db","on-change":F},{default:h(()=>[v(u,{type:"danger",loading:B.value,icon:b(r),size:"large",plain:""},{default:h(()=>n[4]||(n[4]=[y(" 选择文件并恢复 ")])),_:1},8,["loading","icon"])]),_:1},512)])])]),_:1})])}}}),[["__scopeId","data-v-3422c4d6"]]);export{B as default};
