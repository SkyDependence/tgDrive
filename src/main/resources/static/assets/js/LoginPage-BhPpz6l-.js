import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                     *//* empty css                    *//* empty css                 */import{t as a,r as s,f as l,v as r,A as t,M as o,E as n,J as i,aj as u,u as m,D as d,H as c,K as p,ab as g,aw as v,av as f,x as _}from"./vue-vendor-BNZdp1ez.js";import{h as y,q as b,E as h,Z as k,r as w,s as x,_ as j,y as V,Y as I,$ as U,i as z,G as q}from"./element-plus-CgPdM7LF.js";import{u as C,s as S}from"./index-DrHwzDkJ.js";import"./vendor-JtNx7una.js";const A={class:"login-page-container"},B={class:"login-card"},E={class:"login-header"},K={class:"account-info"},R={class:"login-options"},T={class:"register-prompt"},$={class:"agreement-text"},D=e(a({__name:"LoginPage",setup(e){const a=async e=>{try{await navigator.clipboard.writeText(e),h.success(`"${e}" 已复制到剪贴板！`)}catch(a){h.error("呜喵... 复制失败了，请手动复制哦")}},D=f(),F=v(),G=C(),H=s({username:"",password:""}),J=s(),L=s(!1),M=s(!1),P=s(!1),Y={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,message:"用户名长度至少为3个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,message:"密码长度至少为5个字符",trigger:"blur"}]},Z=()=>{var e;L.value||null==(e=J.value)||e.validate(async e=>{if(e){L.value=!0;try{const e=await S.post("/auth/login",{username:H.value.username,password:H.value.password});if(1===e.data.code){const a=e.data.data;G.setUserInfo({token:a.token,role:a.role,userId:a.UserId,username:a.username,email:a.email}),M.value?localStorage.setItem("rememberedUsername",H.value.username):localStorage.removeItem("rememberedUsername"),h.success(e.data.msg||"登录成功");const s=F.query.redirect;s?D.push(s):"admin"===a.role?D.push("/home"):"user"===a.role?D.push("/user/home"):D.push("/")}else h.error(e.data.msg||"登录失败")}catch(a){h.error("登录失败，请检查网络或联系管理员")}finally{L.value=!1}}})},N=()=>{q.alert("请联系管理员重置您的密码。","忘记密码",{confirmButtonText:"好的"})};return l(()=>{const e=localStorage.getItem("username");e&&(H.value.username=e,M.value=!0),(async()=>{try{const e=await S.get("/setting/registration-status");1===e.data.code&&(P.value=e.data.data.isRegistrationAllowed)}catch(e){P.value=!1}})()}),(e,s)=>{const l=y,v=x,f=w,h=I,q=U,C=z,S=g("router-link"),D=b;return _(),r("div",A,[t("div",B,[t("div",E,[o(l,{size:28,color:"var(--el-color-primary)"},{default:n(()=>[o(m(k))]),_:1}),s[7]||(s[7]=t("h2",{class:"login-title"},"欢迎回来",-1)),s[8]||(s[8]=t("p",{class:"login-subtitle"},"您可以使用访客账户登录",-1)),t("div",K,[t("p",null,[s[5]||(s[5]=t("strong",null,"访客账户:",-1)),t("span",{class:"copyable-text",onClick:s[0]||(s[0]=e=>a("visitor"))},"visitor"),s[6]||(s[6]=i(" / ",-1)),t("span",{class:"copyable-text",onClick:s[1]||(s[1]=e=>a("hello"))},"hello")])])]),o(D,{model:H.value,rules:Y,ref_key:"loginFormRef",ref:J,"label-position":"top",onKeyup:u(Z,["enter"]),class:"login-form"},{default:n(()=>[o(f,{label:"用户名",prop:"username"},{default:n(()=>[o(v,{modelValue:H.value.username,"onUpdate:modelValue":s[2]||(s[2]=e=>H.value.username=e),"prefix-icon":m(j),placeholder:"请输入用户名或邮箱",size:"large",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),o(f,{label:"密码",prop:"password"},{default:n(()=>[o(v,{modelValue:H.value.password,"onUpdate:modelValue":s[3]||(s[3]=e=>H.value.password=e),"prefix-icon":m(V),type:"password",placeholder:"请输入密码",size:"large","show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),o(f,null,{default:n(()=>[t("div",R,[o(h,{modelValue:M.value,"onUpdate:modelValue":s[4]||(s[4]=e=>M.value=e)},{default:n(()=>s[9]||(s[9]=[i("记住我",-1)])),_:1,__:[9]},8,["modelValue"]),o(q,{type:"primary",onClick:N},{default:n(()=>s[10]||(s[10]=[i("忘记密码？",-1)])),_:1,__:[10]})])]),_:1}),o(f,null,{default:n(()=>[o(C,{type:"primary",onClick:Z,loading:L.value,class:"login-button",size:"large",block:""},{default:n(()=>[i(p(L.value?"登录中...":"登 录"),1)]),_:1},8,["loading"])]),_:1}),P.value?(_(),d(f,{key:0,class:"register-link"},{default:n(()=>[t("div",T,[s[12]||(s[12]=t("span",{class:"prompt-text"},"没有账户？",-1)),o(S,{to:"/register",class:"register-btn"},{default:n(()=>[o(C,{type:"primary",plain:"",size:"small"},{default:n(()=>s[11]||(s[11]=[i(" 立即注册 ",-1)])),_:1,__:[11]})]),_:1})])]),_:1})):c("",!0),o(f,{class:"agreement-links"},{default:n(()=>[t("div",$,[s[15]||(s[15]=t("span",{class:"agreement-prompt"},"登录即表示您同意我们的",-1)),o(S,{to:"/agreement",class:"agreement-link"},{default:n(()=>s[13]||(s[13]=[i(" 用户协议 ",-1)])),_:1,__:[13]}),s[16]||(s[16]=t("span",{class:"agreement-separator"},"和",-1)),o(S,{to:"/privacy",class:"agreement-link"},{default:n(()=>s[14]||(s[14]=[i(" 隐私政策 ",-1)])),_:1,__:[14]})])]),_:1})]),_:1},8,["model"])])])}}}),[["__scopeId","data-v-c9b8da1b"]]);export{D as default};
