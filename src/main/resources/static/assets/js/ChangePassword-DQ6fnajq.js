import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                *//* empty css                     *//* empty css                 */import{e as a,q as s,s as r,_ as l,r as o,y as d,a9 as u,i as n,h as i,a3 as t,E as p}from"./element-plus-CgPdM7LF.js";import{u as m,s as w}from"./index-DrHwzDkJ.js";import{t as c,c as v,r as f,v as g,M as P,E as b,D as _,H as h,u as x,J as y,K as V,A as j,x as k}from"./vue-vendor-BNZdp1ez.js";import"./vendor-JtNx7una.js";const q={class:"page-container"},z={class:"card-header"},E=e(c({__name:"ChangePassword",setup(e){const c=m(),E=v(()=>"admin"===c.role),U=f({username:"",oldPassword:"",newPassword:"",confirmPassword:""}),C=f(),F=f(!1),A=(e,a,s)=>{""===a?s(new Error("请再次输入新密码")):a!==U.value.newPassword?s(new Error("两次输入的密码不一致")):s()},D=v(()=>{const e={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:16,message:"密码长度为6-16位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:A,trigger:"blur"}]};return E.value?e.username=[{required:!0,message:"请输入用户名",trigger:"blur"}]:e.oldPassword=[{required:!0,message:"请输入旧密码",trigger:"blur"}],e}),H=()=>{var e;null==(e=C.value)||e.validate(async e=>{var a;if(e){F.value=!0;try{let e;e=E.value?await w.post("/auth/admin/change-password",{username:U.value.username,newPassword:U.value.newPassword}):await w.post("/auth/change-password",{oldPassword:U.value.oldPassword,newPassword:U.value.newPassword}),1===e.data.code?(p.success("密码修改成功"),null==(a=C.value)||a.resetFields()):p.error(e.data.msg||"密码修改失败")}catch(s){p.error("修改密码失败，请检查网络或联系管理员")}finally{F.value=!1}}})};return(e,p)=>{const m=i,w=r,c=o,v=n,f=s,A=a;return k(),g("div",q,[P(A,{class:"content-card"},{header:b(()=>[j("div",z,[P(m,null,{default:b(()=>[P(x(t))]),_:1}),j("span",null,V(E.value?"管理员修改用户密码":"修改密码"),1)])]),default:b(()=>[P(f,{model:U.value,rules:D.value,ref_key:"passwordFormRef",ref:C,"label-position":"top",class:"password-form"},{default:b(()=>[E.value?(k(),_(c,{key:0,label:"用户名",prop:"username"},{default:b(()=>[P(w,{modelValue:U.value.username,"onUpdate:modelValue":p[0]||(p[0]=e=>U.value.username=e),"prefix-icon":x(l),placeholder:"请输入要修改密码的用户名",size:"large",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1})):h("",!0),E.value?h("",!0):(k(),_(c,{key:1,label:"旧密码",prop:"oldPassword"},{default:b(()=>[P(w,{modelValue:U.value.oldPassword,"onUpdate:modelValue":p[1]||(p[1]=e=>U.value.oldPassword=e),"prefix-icon":x(d),type:"password",placeholder:"请输入您的当前密码",size:"large","show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1})),P(c,{label:"新密码",prop:"newPassword"},{default:b(()=>[P(w,{modelValue:U.value.newPassword,"onUpdate:modelValue":p[2]||(p[2]=e=>U.value.newPassword=e),"prefix-icon":x(d),type:"password",placeholder:"请输入 6-16 位的新密码",size:"large","show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),P(c,{label:"确认新密码",prop:"confirmPassword"},{default:b(()=>[P(w,{modelValue:U.value.confirmPassword,"onUpdate:modelValue":p[3]||(p[3]=e=>U.value.confirmPassword=e),"prefix-icon":x(u),type:"password",placeholder:"请再次输入新密码",size:"large","show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),P(c,null,{default:b(()=>[P(v,{type:"primary",onClick:H,loading:F.value,class:"submit-button",size:"large",block:""},{default:b(()=>[y(V(F.value?"正在提交...":E.value?"修改用户密码":"确认修改"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}}),[["__scopeId","data-v-fae8cb98"]]);export{E as default};
