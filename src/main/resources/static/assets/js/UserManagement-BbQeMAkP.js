import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                 */import{d as a,r as l,b as s,l as r,U as t,c as o,M as i,E as d,o as n,a as u,F as c,H as m,u as v,K as p,D as w,J as f,L as _,a9 as g,ah as h}from"./vue-vendor-CxLOoai_.js";import{d as b,I as y,b as k,f as j,_ as C,N as P,O as x,a7 as V,P as z,h as L,ax as U,R as q,S as B,T as E,l as I,s as D,W as M,X as T,q as F,r as K,G as R}from"./element-plus-DQjCWvVU.js";import{s as W}from"./request-DvzUJvtB.js";import"./vendor-CPGCUlN1.js";import"./user-CWlPWJjU.js";import"./index-CLLrkTrC.js";const $={class:"page-container"},A={class:"card-header"},G={class:"header-left"},H={class:"header-right"},J={class:"stats-container"},N={class:"stat-card"},O={class:"stat-icon total-users"},S={class:"stat-content"},X={class:"stat-number"},Q={class:"stat-card"},Y={class:"stat-icon online-users"},Z={class:"stat-content"},ee={class:"stat-number"},ae={class:"stat-card"},le={class:"stat-icon admin-users"},se={class:"stat-content"},re={class:"stat-number"},te={style:{display:"flex","align-items":"center",gap:"8px"}},oe={key:1,class:"mobile-user-list"},ie={key:2},de={class:"user-info"},ne={class:"user-details"},ue={class:"user-name"},ce={class:"user-meta"},me={class:"user-email"},ve={class:"user-login-time"},pe={class:"user-actions"},we={class:"dialog-footer"},fe=e(a({__name:"UserManagement",setup(e){const a=l([]),fe=l(!1),_e=l(""),ge=l(!1),he=l(!1),be=l(!1),ye=l(),ke=l(null),je=l(0),Ce=l(0),Pe=l(0),xe=l({username:"",newPassword:"",confirmPassword:""}),Ve={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==xe.value.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},ze=s(()=>_e.value&&a.value?a.value.filter(e=>{var a,l;return(null==(a=e.username)?void 0:a.toLowerCase().includes(_e.value.toLowerCase()))||(null==(l=e.email)?void 0:l.toLowerCase().includes(_e.value.toLowerCase()))}):a.value||[]),Le=()=>{ge.value=window.innerWidth<768},Ue=e=>{switch(e){case"admin":return"danger";case"user":return"success";case"visitor":return"info";default:return""}},qe=e=>{switch(e){case"admin":return"管理员";case"user":return"用户";case"visitor":return"访客";default:return e}},Be=async()=>{var e,l;fe.value=!0;try{const s=await W.get("/auth/admin/users");1===(null==(e=s.data)?void 0:e.code)?(a.value=s.data.data||[],Ee()):k.error((null==(l=s.data)?void 0:l.msg)||"获取用户列表失败")}catch(s){k.error("获取用户列表失败，请检查网络连接")}finally{fe.value=!1}},Ee=()=>{je.value=a.value.length,Pe.value=a.value.filter(e=>"admin"===e.role).length,Ce.value=Math.floor(.1*je.value)},Ie=()=>{},De=()=>{_e.value="",Be()},Me=e=>{ke.value=e,xe.value={username:e.username,newPassword:"",confirmPassword:""},he.value=!0},Te=async()=>{var e,a,l,s;if(ye.value)try{await ye.value.validate(),be.value=!0;const l=await W.post("/auth/admin/change-password",{username:xe.value.username,newPassword:xe.value.newPassword});1===(null==(e=l.data)?void 0:e.code)?(k.success("密码修改成功"),he.value=!1):k.error((null==(a=l.data)?void 0:a.msg)||"密码修改失败")}catch(r){"validation failed"!==r&&k.error("密码修改失败: "+((null==(s=null==(l=r.response)?void 0:l.data)?void 0:s.msg)||r.message))}finally{be.value=!1}},Fe=async e=>{var a,l,s,r;if("admin"!==e.role)try{await R.confirm(`确定要删除用户 "${e.username}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const s=await W.delete(`/auth/admin/users/${e.id}`);1===(null==(a=s.data)?void 0:a.code)?(k.success("用户删除成功"),Be()):k.error((null==(l=s.data)?void 0:l.msg)||"删除失败")}catch(t){"cancel"!==t&&k.error("删除用户失败: "+((null==(r=null==(s=t.response)?void 0:s.data)?void 0:r.msg)||t.message))}else k.warning("不能删除管理员账户")};return r(()=>{Le(),window.addEventListener("resize",Le),Be()}),t(()=>{window.removeEventListener("resize",Le)}),(e,a)=>{const l=j,s=D,r=L,t=x,k=V,R=z,W=B,ke=E,Le=I,Be=b,Ee=K,Ke=F,Re=y,We=P;return n(),o("div",$,[i(Be,{class:"content-card"},{header:d(()=>[u("div",A,[u("div",G,[i(l,null,{default:d(()=>[i(v(C))]),_:1}),a[6]||(a[6]=u("span",null,"用户管理",-1))]),u("div",H,[i(s,{modelValue:_e.value,"onUpdate:modelValue":a[0]||(a[0]=e=>_e.value=e),placeholder:"搜索用户名或邮箱",clearable:"",style:{width:"200px","margin-right":"10px"},onKeyup:h(Ie,["enter"])},null,8,["modelValue"]),i(r,{type:"primary",onClick:Ie,icon:v(M)},{default:d(()=>a[7]||(a[7]=[f("搜索")])),_:1,__:[7]},8,["icon"]),i(r,{type:"default",onClick:De,icon:v(T)},{default:d(()=>a[8]||(a[8]=[f("刷新")])),_:1,__:[8]},8,["icon"])])])]),default:d(()=>[u("div",J,[u("div",N,[u("div",O,[i(l,null,{default:d(()=>[i(v(C))]),_:1})]),u("div",S,[u("div",X,p(je.value),1),a[9]||(a[9]=u("div",{class:"stat-label"},"总用户数",-1))])]),u("div",Q,[u("div",Y,[i(l,null,{default:d(()=>[i(v(C))]),_:1})]),u("div",Z,[u("div",ee,p(Ce.value),1),a[10]||(a[10]=u("div",{class:"stat-label"},"在线用户",-1))])]),u("div",ae,[u("div",le,[i(l,null,{default:d(()=>[i(v(C))]),_:1})]),u("div",se,[u("div",re,p(Pe.value),1),a[11]||(a[11]=u("div",{class:"stat-label"},"管理员",-1))])])]),ge.value?m("",!0):c((n(),w(W,{key:0,data:ze.value,height:"calc(100vh - 280px)",style:{width:"100%"}},{default:d(()=>[i(t,{prop:"id",label:"用户ID",width:"80",align:"center"}),i(t,{prop:"username",label:"用户名","min-width":"150","show-overflow-tooltip":""},{default:d(e=>[u("div",te,[i(l,null,{default:d(()=>[i(v(C))]),_:1}),u("span",null,p(e.row.username),1)])]),_:1}),i(t,{prop:"email",label:"邮箱","min-width":"200","show-overflow-tooltip":""}),i(t,{prop:"role",label:"角色",width:"100",align:"center"},{default:d(e=>[i(k,{type:Ue(e.row.role)},{default:d(()=>[f(p(qe(e.row.role)),1)]),_:2},1032,["type"])]),_:1}),i(t,{prop:"reserved1",label:"最后上线时间",width:"180",align:"center"},{default:d(e=>[f(p(e.row.reserved1||"从未登录"),1)]),_:1}),i(t,{label:"操作",width:"200",align:"center",fixed:"right"},{default:d(e=>[i(R,null,{default:d(()=>[i(r,{type:"warning",size:"small",onClick:a=>Me(e.row),icon:v(U),disabled:"admin"===e.row.role},{default:d(()=>a[12]||(a[12]=[f(" 改密 ")])),_:2,__:[12]},1032,["onClick","icon","disabled"]),i(r,{type:"danger",size:"small",onClick:a=>Fe(e.row),icon:v(q),disabled:"admin"===e.row.role},{default:d(()=>a[13]||(a[13]=[f(" 删除 ")])),_:2,__:[13]},1032,["onClick","icon","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[We,fe.value]]),ge.value?(n(),o("div",oe,[fe.value?(n(),w(ke,{key:0,rows:5,animated:""})):0===ze.value.length?(n(),w(Le,{key:1,description:"暂无用户"})):(n(),o("div",ie,[(n(!0),o(_,null,g(ze.value,e=>(n(),o("div",{key:e.id,class:"mobile-user-item"},[u("div",de,[i(l,{class:"user-icon"},{default:d(()=>[i(v(C))]),_:1}),u("div",ne,[u("div",ue,p(e.username),1),u("div",ce,[u("span",null,"ID: "+p(e.id),1),i(k,{type:Ue(e.role),size:"small"},{default:d(()=>[f(p(qe(e.role)),1)]),_:2},1032,["type"])]),u("div",me,p(e.email),1),u("div",ve,"最后上线: "+p(e.reserved1||"从未登录"),1)])]),u("div",pe,[i(R,null,{default:d(()=>[i(r,{type:"warning",size:"small",onClick:a=>Me(e),icon:v(U),disabled:"admin"===e.role},{default:d(()=>a[14]||(a[14]=[f(" 改密 ")])),_:2,__:[14]},1032,["onClick","icon","disabled"]),i(r,{type:"danger",size:"small",onClick:a=>Fe(e),icon:v(q),disabled:"admin"===e.role},{default:d(()=>a[15]||(a[15]=[f(" 删除 ")])),_:2,__:[15]},1032,["onClick","icon","disabled"])]),_:2},1024)])]))),128))]))])):m("",!0)]),_:1}),i(Re,{modelValue:he.value,"onUpdate:modelValue":a[5]||(a[5]=e=>he.value=e),title:"修改用户密码",width:"400px","close-on-click-modal":!1},{footer:d(()=>[u("span",we,[i(r,{onClick:a[4]||(a[4]=e=>he.value=!1)},{default:d(()=>a[16]||(a[16]=[f("取消")])),_:1,__:[16]}),i(r,{type:"primary",onClick:Te,loading:be.value},{default:d(()=>a[17]||(a[17]=[f(" 确定 ")])),_:1,__:[17]},8,["loading"])])]),default:d(()=>[i(Ke,{ref_key:"changePasswordFormRef",ref:ye,model:xe.value,rules:Ve,"label-width":"100px"},{default:d(()=>[i(Ee,{label:"用户名"},{default:d(()=>[i(s,{modelValue:xe.value.username,"onUpdate:modelValue":a[1]||(a[1]=e=>xe.value.username=e),disabled:""},null,8,["modelValue"])]),_:1}),i(Ee,{label:"新密码",prop:"newPassword"},{default:d(()=>[i(s,{modelValue:xe.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>xe.value.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),i(Ee,{label:"确认密码",prop:"confirmPassword"},{default:d(()=>[i(s,{modelValue:xe.value.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>xe.value.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b21e690c"]]);export{fe as default};
