import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                        *//* empty css                   *//* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        */import{t as l,c as a,r as i,w as o,D as t,E as s,A as n,v as u,F as r,H as c,M as d,u as v,K as p,J as f,G as m,x as g,n as y,f as w,U as h,L as _,a9 as k,aj as C,R as b}from"./vue-vendor-BNZdp1ez.js";import{s as x}from"./index-DrHwzDkJ.js";import{I,J as j,K as z,h as U,L as V,m as $,M as B,i as L,N,E as M,e as T,O as R,P as S,v as F,Q as E,o as P,R as D,S as H,l as K,T as A,U as G,V as J,H as W,A as O,s as Q,W as X,X as Y,G as q,Y as Z}from"./element-plus-CgPdM7LF.js";import{H as ee}from"./vendor-JtNx7una.js";const le={class:"preview-container"},ae={key:0,class:"image-preview"},ie={key:1,class:"video-preview"},oe=["src"],te={key:2,class:"audio-preview"},se={class:"audio-info"},ne=["src"],ue={key:3,class:"pdf-preview"},re=["src"],ce=["href"],de={key:4,class:"text-preview"},ve={class:"text-content"},pe={key:5,class:"office-preview"},fe={class:"office-viewer"},me=["src"],ge={key:6,class:"code-preview"},ye=["innerHTML"],we={key:7,class:"unsupported-preview"},he={class:"unsupported-content"},_e={key:8,"element-loading-text":"加载中...",class:"loading-overlay"},ke={class:"dialog-footer"},Ce=e(l({__name:"FilePreview",props:{modelValue:{type:Boolean},fileInfo:{}},emits:["update:modelValue","download"],setup(e,{emit:l}){const w=e,h=l,_=a({get:()=>w.modelValue,set:e=>h("update:modelValue",e)}),k=i(!1),C=i(""),b=i(""),x=a(()=>{var e,l;return(null==(e=w.fileInfo)?void 0:e.fileName)&&(null==(l=w.fileInfo.fileName.split(".").pop())?void 0:l.toLowerCase())||""}),T=a(()=>["jpg","jpeg","png","gif","bmp","webp","svg"].includes(x.value)),R=a(()=>["mp4","avi","mov","wmv","flv","webm","mkv"].includes(x.value)),S=a(()=>["mp3","wav","flac","aac","ogg","m4a"].includes(x.value)),F=a(()=>"pdf"===x.value),E=a(()=>["txt","md","json","xml","csv","log"].includes(x.value)),P=a(()=>["doc","docx","xls","xlsx","ppt","pptx"].includes(x.value)),D=a(()=>["js","ts","vue","html","css","scss","less","java","py","cpp","c","go","rs","php","rb","swift","kt"].includes(x.value)),H=a(()=>{var e;return(null==(e=w.fileInfo)?void 0:e.downloadUrl)||""}),K=()=>({js:"javascript",ts:"typescript",vue:"vue",html:"html",css:"css",scss:"scss",less:"less",java:"java",py:"python",cpp:"cpp",c:"c",go:"go",rs:"rust",php:"php",rb:"ruby",swift:"swift",kt:"kotlin"}[x.value]||"plaintext"),A=e=>{const l="string"==typeof e?parseInt(e):e;if(0===l)return"0 B";const a=Math.floor(Math.log(l)/Math.log(1024));return parseFloat((l/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB","TB"][a]},G=async()=>{if(w.fileInfo&&(E.value||D.value)){k.value=!0;try{const e=await fetch(H.value),l=await e.text();if(D.value){const e=ee.highlight(l,{language:K()});b.value=e.value}else C.value=l}catch(e){M.error("加载文件内容失败")}finally{k.value=!1}}},J=()=>{w.fileInfo&&h("download",w.fileInfo)},W=()=>{_.value=!1,C.value="",b.value=""};return o(()=>w.fileInfo,async e=>{e&&_.value&&(await y(),(E.value||D.value)&&G())},{immediate:!0}),o(_,async e=>{e&&w.fileInfo&&(await y(),(E.value||D.value)&&G())}),(e,l)=>{var a;const i=j,o=U,y=V,w=L,h=I,x=N;return g(),t(h,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=e=>_.value=e),title:(null==(a=e.fileInfo)?void 0:a.fileName)||"文件预览",width:"80%","before-close":W,class:"file-preview-dialog"},{footer:s(()=>[n("div",ke,[d(w,{onClick:J},{default:s(()=>[d(o,null,{default:s(()=>[d(v(B))]),_:1}),l[4]||(l[4]=f(" 下载 ",-1))]),_:1,__:[4]}),d(w,{type:"primary",onClick:W},{default:s(()=>l[5]||(l[5]=[f("关闭",-1)])),_:1,__:[5]})])]),default:s(()=>{var a,t,h,_;return[n("div",le,[T.value?(g(),u("div",ae,[d(i,{src:H.value,alt:null==(a=e.fileInfo)?void 0:a.fileName,fit:"contain",class:"preview-image","preview-src-list":[H.value],"initial-index":0,"preview-teleported":""},null,8,["src","alt","preview-src-list"])])):R.value?(g(),u("div",ie,[n("video",{src:H.value,controls:"",class:"preview-video",preload:"metadata"}," 您的浏览器不支持视频播放 ",8,oe)])):S.value?(g(),u("div",te,[n("div",se,[d(o,{size:"48",color:"#409EFF"},{default:s(()=>[d(v(z))]),_:1}),n("h3",null,p(null==(t=e.fileInfo)?void 0:t.fileName),1)]),n("audio",{src:H.value,controls:"",class:"preview-audio",preload:"metadata"}," 您的浏览器不支持音频播放 ",8,ne)])):F.value?(g(),u("div",ue,[n("iframe",{src:H.value,class:"preview-iframe",frameborder:"0"},[l[1]||(l[1]=f(" 您的浏览器不支持PDF预览，请",-1)),n("a",{href:H.value,target:"_blank"},"点击下载",8,ce)],8,re)])):E.value?(g(),u("div",de,[d(y,{height:"500px"},{default:s(()=>[n("pre",ve,p(C.value),1)]),_:1})])):P.value?(g(),u("div",pe,[n("div",fe,[n("iframe",{src:`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(H.value)}`,class:"preview-iframe",frameborder:"0"}," 文档预览加载中... ",8,me)])])):D.value?(g(),u("div",ge,[d(y,{height:"500px"},{default:s(()=>[n("pre",null,[n("code",{class:m(K()),innerHTML:b.value},null,10,ye)])]),_:1})])):(g(),u("div",we,[n("div",he,[d(o,{size:"64",color:"#909399"},{default:s(()=>[d(v($))]),_:1}),l[3]||(l[3]=n("h3",null,"暂不支持此文件类型的预览",-1)),n("p",null,"文件名: "+p(null==(h=e.fileInfo)?void 0:h.fileName),1),n("p",null,"文件大小: "+p(A(null==(_=e.fileInfo)?void 0:_.size)),1),d(w,{type:"primary",onClick:J},{default:s(()=>[d(o,null,{default:s(()=>[d(v(B))]),_:1}),l[2]||(l[2]=f(" 下载文件 ",-1))]),_:1,__:[2]})])])),k.value?r((g(),u("div",_e,null,512)),[[x,k.value]]):c("",!0)])]}),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-f6f0ac49"]]),be={class:"page-container"},xe={class:"card-header"},Ie={class:"header-left"},je={class:"header-right"},ze={class:"search-button-group"},Ue={style:{display:"flex","align-items":"center",gap:"8px"}},Ve={key:2},$e=["onClick"],Be={class:"file-info"},Le={class:"file-name-mobile"},Ne={class:"file-meta"},Me={key:0},Te={class:"file-actions"},Re={class:"batch-actions"},Se={class:"dialog-footer"},Fe=e(l({__name:"FileList",setup(e){const l=i([]),o=i(!1),y=i(1),j=i(10),z=i(0),V=i(!1),ee=i([]),le=i(!1),ae=i(null),ie=i(!1),oe=i(null),te=i(""),se=i(null),ne=i([]),ue=a(()=>localStorage.getItem("role")||"");a(()=>{const e=localStorage.getItem("userId");return e?parseInt(e):null});const re=()=>{le.value=window.innerWidth<768},ce=e=>ee.value.some(l=>l.fileId===e.fileId),de=e=>{ce(e)?ee.value=ee.value.filter(l=>l.fileId!==e.fileId):ee.value.push(e)},ve=async()=>{var e,a;o.value=!0;try{let i=`/file-list?page=${y.value}&size=${j.value}`;te.value&&(i+=`&keyword=${encodeURIComponent(te.value)}`),se.value&&(i+=`&userId=${se.value}`);const o=await x.get(i);if(1===(null==(e=o.data)?void 0:e.code)){const e=o.data.data;l.value=e.records||[],z.value=e.total||0}else M.error((null==(a=o.data)?void 0:a.msg)||"获取文件列表失败")}catch(i){M.error("获取文件列表失败，请检查网络")}finally{o.value=!1}},pe=e=>{ee.value=e},fe=(e,l)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{M.success(l)}).catch(a=>{me(e,l)}):me(e,l)},me=(e,l)=>{const a=document.createElement("textarea");a.value=e,a.style.top="0",a.style.left="0",a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.focus(),a.select();try{document.execCommand("copy")?M.success(l):M.error("复制失败，请手动复制")}catch(i){M.error("复制失败，请手动复制")}document.body.removeChild(a)},ge=()=>{const e=ee.value.map(e=>`![${e.fileName}](${e.downloadUrl})`).join("\n");fe(e,`已批量复制 ${ee.value.length} 个 Markdown 链接`)},ye=()=>{const e=ee.value.map(e=>e.downloadUrl).join("\n");fe(e,`已批量复制 ${ee.value.length} 个下载链接`)},we=async()=>{var e,l;if(0!==ee.value.length)try{await q.confirm(`确定要删除选中的 ${ee.value.length} 个文件吗？此操作不可撤销。`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const e=ee.value.map(e=>x.delete(`/file/${e.fileId}`)),l=await Promise.allSettled(e);let a=0,i=0;l.forEach((e,l)=>{"fulfilled"===e.status&&1===e.value.data.code?a++:i++}),a>0&&M.success(`成功删除 ${a} 个文件`),i>0&&M.error(`${i} 个文件删除失败`),ee.value=[],ve()}catch(a){"cancel"!==a&&M.error("批量删除失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.msg)||a.message))}else M.warning("请先选择要删除的文件")},he=e=>new Date(1e3*e).toLocaleString("zh-CN",{hour12:!1}),_e=()=>{V.value=!0},ke=async()=>{var e,l;V.value=!1;const a=M({message:"正在更新...",type:"info",duration:0});try{const a=await x.put("/file-url");1===(null==(e=a.data)?void 0:e.code)?(M.success("URL 更新成功"),ve()):M.error((null==(l=a.data)?void 0:l.msg)||"URL 更新失败")}catch(i){M.error("更新失败，请检查网络")}finally{a.close()}},Fe=e=>{y.value=e,ee.value=[],ve(),le.value&&ae.value&&(ae.value.scrollTop=0)},Ee=e=>{j.value=e,y.value=1,ee.value=[],ve()},Pe=e=>{fe(`![${e.fileName}](${e.downloadUrl})`,"Markdown 格式已复制")},De=e=>{fe(e.downloadUrl,"下载链接已复制")},He=e=>{window.open(e,"_blank")},Ke=e=>{oe.value=e,ie.value=!0},Ae=e=>{He(e.downloadUrl)},Ge=async e=>{var l,a;try{await q.confirm(`确定要删除文件 "${e.fileName}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const l=await x.delete(`/file/${e.fileId}`);1===l.data.code?(M.success("文件删除成功"),ee.value=ee.value.filter(l=>l.fileId!==e.fileId),ve()):M.error(l.data.msg||"删除失败")}catch(i){"cancel"!==i&&M.error("删除文件失败: "+((null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||i.message))}},Je=()=>{y.value=1,ve()},We=()=>{te.value="",se.value=null,y.value=1,ve()},Oe=()=>{y.value=1,ve()};return w(()=>{re(),window.addEventListener("resize",re),ve(),(async()=>{var e;if("admin"===ue.value)try{const l=await x.get("/auth/admin/users");1===(null==(e=l.data)?void 0:e.code)&&(ne.value=l.data.data.map(e=>({id:e.id,username:e.username})))}catch(l){}})()}),h(()=>{window.removeEventListener("resize",re)}),(e,a)=>{const i=U,w=W,h=O,x=Q,M=L,q=R,re=S,ve=H,fe=K,me=A,Qe=G,Xe=T,Ye=I,qe=N;return g(),u("div",be,[d(Xe,{class:"content-card"},{header:s(()=>[n("div",xe,[n("div",Ie,[d(i,null,{default:s(()=>[d(v(J))]),_:1}),a[8]||(a[8]=n("span",null,"文件列表",-1))]),n("div",je,["admin"===ue.value?(g(),t(h,{key:0,modelValue:se.value,"onUpdate:modelValue":a[0]||(a[0]=e=>se.value=e),placeholder:"选择用户",clearable:"",filterable:"",style:{width:"150px","margin-right":"10px"},onChange:Oe,"max-height":200},{default:s(()=>[d(w,{label:"全部用户",value:null}),(g(!0),u(_,null,k(ne.value,e=>(g(),t(w,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):c("",!0),d(x,{modelValue:te.value,"onUpdate:modelValue":a[1]||(a[1]=e=>te.value=e),placeholder:"搜索文件名",clearable:"",style:{width:"200px","margin-right":"10px"},onKeyup:C(Je,["enter"])},null,8,["modelValue"]),n("div",ze,[d(M,{type:"primary",onClick:Je,icon:v(X)},{default:s(()=>a[9]||(a[9]=[f("搜索",-1)])),_:1,__:[9]},8,["icon"]),d(M,{type:"default",onClick:We,icon:v(Y)},{default:s(()=>a[10]||(a[10]=[f("全部",-1)])),_:1,__:[10]},8,["icon"])]),"admin"===ue.value?(g(),t(M,{key:1,type:"primary",onClick:_e,icon:v(Y),class:"update-url-btn"},{default:s(()=>a[11]||(a[11]=[f("更新 URL 前缀",-1)])),_:1,__:[11]},8,["icon"])):c("",!0)])])]),default:s(()=>[le.value?c("",!0):r((g(),t(ve,{key:0,data:l.value,onSelectionChange:pe,height:"calc(100vh - 280px)",style:{width:"100%"}},{default:s(()=>[d(q,{type:"selection",width:"55",align:"center"}),d(q,{prop:"fileName",label:"文件名","min-width":"200","show-overflow-tooltip":"",fixed:"left"},{default:s(e=>[n("div",Ue,[d(i,null,{default:s(()=>[d(v($))]),_:1}),n("span",null,p(e.row.fileName),1)])]),_:1}),d(q,{prop:"size",label:"大小",width:"120",align:"center"}),d(q,{prop:"uploadTime",label:"上传时间",width:"180",align:"center"},{default:s(e=>[f(p(he(e.row.uploadTime)),1)]),_:1}),"admin"===ue.value?(g(),t(q,{key:0,prop:"uploader",label:"上传者",width:"120",align:"center"},{default:s(e=>[f(p(e.row.uploader||"未知"),1)]),_:1})):c("",!0),d(q,{label:"操作",width:"480",align:"center",fixed:"right"},{default:s(e=>[d(re,null,{default:s(()=>[d(M,{type:"info",size:"small",onClick:l=>Ke(e.row),icon:v(F)},{default:s(()=>a[12]||(a[12]=[f("预览",-1)])),_:2,__:[12]},1032,["onClick","icon"]),d(M,{type:"primary",size:"small",onClick:l=>Pe(e.row),icon:v(E)},{default:s(()=>a[13]||(a[13]=[f("Markdown",-1)])),_:2,__:[13]},1032,["onClick","icon"]),d(M,{type:"success",size:"small",onClick:l=>De(e.row),icon:v(P)},{default:s(()=>a[14]||(a[14]=[f("链接",-1)])),_:2,__:[14]},1032,["onClick","icon"]),d(M,{type:"warning",size:"small",onClick:l=>He(e.row.downloadUrl),icon:v(B)},{default:s(()=>a[15]||(a[15]=[f("下载",-1)])),_:2,__:[15]},1032,["onClick","icon"]),d(M,{type:"danger",size:"small",onClick:l=>Ge(e.row),icon:v(D)},{default:s(()=>a[16]||(a[16]=[f("删除",-1)])),_:2,__:[16]},1032,["onClick","icon"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[qe,o.value]]),le.value?(g(),u("div",{key:1,class:"mobile-file-list",ref_key:"mobileListRef",ref:ae},[0!==l.value.length||o.value?c("",!0):(g(),t(fe,{key:0,description:"暂无文件"})),o.value?(g(),t(me,{key:1,rows:5,animated:""})):(g(),u("div",Ve,[(g(!0),u(_,null,k(l.value,e=>(g(),u("div",{key:e.fileId,class:m(["mobile-file-item",{"is-selected":ce(e)}]),onClick:l=>de(e)},[n("div",Be,[d(v(Z),{"model-value":ce(e),onChange:()=>de(e),onClick:a[2]||(a[2]=b(()=>{},["stop"])),size:"large",class:"mobile-checkbox"},null,8,["model-value","onChange"]),d(i,{class:"file-icon"},{default:s(()=>[d(v($))]),_:1}),n("span",Le,p(e.fileName),1)]),n("div",Ne,[n("span",null,"大小: "+p(e.size),1),n("span",null,"上传时间: "+p(he(e.uploadTime)),1),"admin"===ue.value?(g(),u("span",Me,"上传者: "+p(e.uploader||"未知"),1)):c("",!0)]),n("div",Te,[d(re,null,{default:s(()=>[d(M,{type:"info",size:"small",onClick:b(l=>Ke(e),["stop"]),icon:v(F),circle:""},null,8,["onClick","icon"]),d(M,{type:"primary",size:"small",onClick:b(l=>Pe(e),["stop"]),icon:v(E),circle:""},null,8,["onClick","icon"]),d(M,{type:"success",size:"small",onClick:b(l=>De(e),["stop"]),icon:v(P),circle:""},null,8,["onClick","icon"]),d(M,{type:"warning",size:"small",onClick:b(l=>He(e.downloadUrl),["stop"]),icon:v(B),circle:""},null,8,["onClick","icon"]),d(M,{type:"danger",size:"small",onClick:b(l=>Ge(e),["stop"]),icon:v(D),circle:""},null,8,["onClick","icon"])]),_:2},1024)])],10,$e))),128))]))],512)):c("",!0),n("div",{class:m(["footer-toolbar",{"is-mobile":le.value}])},[n("div",Re,[d(M,{type:"primary",onClick:ge,disabled:0===ee.value.length,icon:v(E),plain:""},{default:s(()=>a[17]||(a[17]=[f(" 批量复制 (MD) ",-1)])),_:1,__:[17]},8,["disabled","icon"]),d(M,{type:"success",onClick:ye,disabled:0===ee.value.length,icon:v(P),plain:""},{default:s(()=>a[18]||(a[18]=[f(" 批量复制 (链接) ",-1)])),_:1,__:[18]},8,["disabled","icon"]),d(M,{type:"danger",onClick:we,disabled:0===ee.value.length,icon:v(D),plain:""},{default:s(()=>[f(" 批量删除 ("+p(ee.value.length)+") ",1)]),_:1},8,["disabled","icon"])]),z.value>0?(g(),t(Qe,{key:0,"current-page":y.value,"onUpdate:currentPage":a[3]||(a[3]=e=>y.value=e),"page-size":j.value,"onUpdate:pageSize":a[4]||(a[4]=e=>j.value=e),total:z.value,"page-sizes":[10,20,50,100],layout:le.value?"prev, pager, next":"total, sizes, prev, pager, next, jumper",onSizeChange:Ee,onCurrentChange:Fe,background:"",small:""},null,8,["current-page","page-size","total","layout"])):c("",!0)],2)]),_:1}),d(Ye,{modelValue:V.value,"onUpdate:modelValue":a[6]||(a[6]=e=>V.value=e),title:"更新 URL 前缀",width:"500px"},{footer:s(()=>[n("span",Se,[d(M,{onClick:a[5]||(a[5]=e=>V.value=!1)},{default:s(()=>a[19]||(a[19]=[f("取消",-1)])),_:1,__:[19]}),d(M,{type:"primary",onClick:ke},{default:s(()=>a[20]||(a[20]=[f("确认更新",-1)])),_:1,__:[20]})])]),default:s(()=>[a[21]||(a[21]=n("span",null," 此操作将根据服务器最新配置，更新所有文件的下载链接前缀。当您更换了域名或IP地址后，可以使用此功能。 ",-1))]),_:1,__:[21]},8,["modelValue"]),d(Ce,{modelValue:ie.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ie.value=e),"file-info":oe.value,onDownload:Ae},null,8,["modelValue","file-info"])])}}}),[["__scopeId","data-v-286c3583"]]);export{Fe as default};
