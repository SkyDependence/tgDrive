import{_ as e}from"./_plugin-vue_export-helper-DvehuVrX.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css                 */import{d as a,r as l,b as s,l as r,U as o,c as t,M as i,E as d,o as n,a as u,F as c,H as m,u as v,K as p,D as w,J as f,L as _,a9 as g,ah as h}from"./vue-vendor-Cc5FuWtX.js";import{e as y,I as b,c as k,h as C,_ as V,N as j,O as x,a7 as P,P as R,i as z,ay as L,R as U,S as T,T as q,l as E,s as B,W as D,X as I,q as $,r as F,A as M,H as A,G as H}from"./element-plus-D2f55jhA.js";import{s as K}from"./request-ENSuvgzy.js";import"./vendor-mcYxur_T.js";import"./user-CqZQgeNy.js";import"./index-BNZ_jOiX.js";const W={class:"page-container"},G={class:"card-header"},J={class:"header-left"},N={class:"header-right"},O={class:"search-button-group"},S={class:"stats-container"},X={class:"stat-card"},Q={class:"stat-icon total-users"},Y={class:"stat-content"},Z={class:"stat-number"},ee={class:"stat-card"},ae={class:"stat-icon online-users"},le={class:"stat-content"},se={class:"stat-number"},re={class:"stat-card"},oe={class:"stat-icon admin-users"},te={class:"stat-content"},ie={class:"stat-number"},de={style:{display:"flex","align-items":"center",gap:"8px"}},ne={key:1,class:"mobile-user-list"},ue={key:2},ce={class:"user-info"},me={class:"user-details"},ve={class:"user-name"},pe={class:"user-meta"},we={class:"user-email"},fe={class:"user-login-time"},_e={class:"user-actions"},ge={class:"dialog-footer"},he={class:"dialog-footer"},ye=e(a({__name:"UserManagement",setup(e){const a=l([]),ye=l(!1),be=l(""),ke=l(!1),Ce=l(!1),Ve=l(!1),je=l(),xe=l(!1),Pe=l(!1),Re=l(),ze=l(null),Le=l(0),Ue=l(0),Te=l(0),qe=l({username:"",newPassword:"",confirmPassword:""}),Ee=l({username:"",currentRole:"",newRole:""}),Be={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==qe.value.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},De={newRole:[{required:!0,message:"请选择新角色",trigger:"change"}]},Ie=s(()=>be.value&&a.value?a.value.filter(e=>{var a,l;return(null==(a=e.username)?void 0:a.toLowerCase().includes(be.value.toLowerCase()))||(null==(l=e.email)?void 0:l.toLowerCase().includes(be.value.toLowerCase()))}):a.value||[]),$e=()=>{ke.value=window.innerWidth<768},Fe=e=>{switch(e){case"admin":return"danger";case"user":return"success";case"visitor":return"info";default:return""}},Me=e=>{switch(e){case"admin":return"管理员";case"user":return"用户";case"visitor":return"访客";default:return e}},Ae=async()=>{var e,l;ye.value=!0;try{const s=await K.get("/auth/admin/users");1===(null==(e=s.data)?void 0:e.code)?(a.value=s.data.data||[],He()):k.error((null==(l=s.data)?void 0:l.msg)||"获取用户列表失败")}catch(s){k.error("获取用户列表失败，请检查网络连接")}finally{ye.value=!1}},He=()=>{Le.value=a.value.length,Te.value=a.value.filter(e=>"admin"===e.role).length,Ue.value=Math.floor(.1*Le.value)},Ke=()=>{},We=()=>{be.value="",Ae()},Ge=e=>{ze.value=e,qe.value={username:e.username,newPassword:"",confirmPassword:""},Ce.value=!0},Je=async()=>{var e,a,l,s;if(je.value)try{await je.value.validate(),Ve.value=!0;const l=await K.post("/auth/admin/change-password",{username:qe.value.username,newPassword:qe.value.newPassword});1===(null==(e=l.data)?void 0:e.code)?(k.success("密码修改成功"),Ce.value=!1):k.error((null==(a=l.data)?void 0:a.msg)||"密码修改失败")}catch(r){"validation failed"!==r&&k.error("密码修改失败: "+((null==(s=null==(l=r.response)?void 0:l.data)?void 0:s.msg)||r.message))}finally{Ve.value=!1}},Ne=e=>{ze.value=e,Ee.value={username:e.username,currentRole:e.role,newRole:e.role},xe.value=!0},Oe=async()=>{var e,a,l,s,r;if(Re.value)try{if(await Re.value.validate(),Ee.value.newRole===Ee.value.currentRole)return void k.warning("新角色与当前角色相同");Pe.value=!0;const s=await K.put(`/auth/admin/users/${null==(e=ze.value)?void 0:e.id}/role?role=${Ee.value.newRole}`);1===(null==(a=s.data)?void 0:a.code)?(k.success("用户角色设置成功"),xe.value=!1,Ae()):k.error((null==(l=s.data)?void 0:l.msg)||"角色设置失败")}catch(o){"validation failed"!==o&&k.error("角色设置失败: "+((null==(r=null==(s=o.response)?void 0:s.data)?void 0:r.msg)||o.message))}finally{Pe.value=!1}},Se=async e=>{var a,l,s,r;if("admin"!==e.role)try{await H.confirm(`确定要删除用户 "${e.username}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const s=await K.delete(`/auth/admin/users/${e.id}`);1===(null==(a=s.data)?void 0:a.code)?(k.success("用户删除成功"),Ae()):k.error((null==(l=s.data)?void 0:l.msg)||"删除失败")}catch(o){"cancel"!==o&&k.error("删除用户失败: "+((null==(r=null==(s=o.response)?void 0:s.data)?void 0:r.msg)||o.message))}else k.warning("不能删除管理员账户")};return r(()=>{$e(),window.addEventListener("resize",$e),Ae()}),o(()=>{window.removeEventListener("resize",$e)}),(e,a)=>{const l=C,s=B,r=z,o=x,k=P,H=R,K=T,ze=q,$e=E,Ae=y,He=F,Xe=$,Qe=b,Ye=A,Ze=M,ea=j;return n(),t("div",W,[i(Ae,{class:"content-card"},{header:d(()=>[u("div",G,[u("div",J,[i(l,null,{default:d(()=>[i(v(V))]),_:1}),a[10]||(a[10]=u("span",null,"用户管理",-1))]),u("div",N,[i(s,{modelValue:be.value,"onUpdate:modelValue":a[0]||(a[0]=e=>be.value=e),placeholder:"搜索用户名或邮箱",clearable:"",style:{width:"200px","margin-right":"10px"},onKeyup:h(Ke,["enter"])},null,8,["modelValue"]),u("div",O,[i(r,{type:"primary",onClick:Ke,icon:v(D)},{default:d(()=>a[11]||(a[11]=[f("搜索",-1)])),_:1,__:[11]},8,["icon"]),i(r,{type:"default",onClick:We,icon:v(I)},{default:d(()=>a[12]||(a[12]=[f("刷新",-1)])),_:1,__:[12]},8,["icon"])])])])]),default:d(()=>[u("div",S,[u("div",X,[u("div",Q,[i(l,null,{default:d(()=>[i(v(V))]),_:1})]),u("div",Y,[u("div",Z,p(Le.value),1),a[13]||(a[13]=u("div",{class:"stat-label"},"总用户数",-1))])]),u("div",ee,[u("div",ae,[i(l,null,{default:d(()=>[i(v(V))]),_:1})]),u("div",le,[u("div",se,p(Ue.value),1),a[14]||(a[14]=u("div",{class:"stat-label"},"在线用户",-1))])]),u("div",re,[u("div",oe,[i(l,null,{default:d(()=>[i(v(V))]),_:1})]),u("div",te,[u("div",ie,p(Te.value),1),a[15]||(a[15]=u("div",{class:"stat-label"},"管理员",-1))])])]),ke.value?m("",!0):c((n(),w(K,{key:0,data:Ie.value,height:"calc(100vh - 280px)",style:{width:"100%"}},{default:d(()=>[i(o,{prop:"id",label:"用户ID",width:"80",align:"center"}),i(o,{prop:"username",label:"用户名","min-width":"150","show-overflow-tooltip":""},{default:d(e=>[u("div",de,[i(l,null,{default:d(()=>[i(v(V))]),_:1}),u("span",null,p(e.row.username),1)])]),_:1}),i(o,{prop:"email",label:"邮箱","min-width":"200","show-overflow-tooltip":""},{default:d(e=>[f(p("admin"===e.row.role?e.row.email||"":e.row.email),1)]),_:1}),i(o,{prop:"role",label:"角色",width:"100",align:"center"},{default:d(e=>[i(k,{type:Fe(e.row.role)},{default:d(()=>[f(p(Me(e.row.role)),1)]),_:2},1032,["type"])]),_:1}),i(o,{prop:"lastLoginTime",label:"最后上线时间",width:"180",align:"center"},{default:d(e=>[f(p(e.row.lastLoginTime||"从未登录"),1)]),_:1}),i(o,{label:"操作",width:"280",align:"center",fixed:"right"},{default:d(e=>[i(H,null,{default:d(()=>[i(r,{type:"primary",size:"small",onClick:a=>Ne(e.row),icon:v(V),disabled:"visitor"===e.row.username},{default:d(()=>a[16]||(a[16]=[f(" 设角色 ",-1)])),_:2,__:[16]},1032,["onClick","icon","disabled"]),i(r,{type:"warning",size:"small",onClick:a=>Ge(e.row),icon:v(L),disabled:"visitor"===e.row.username},{default:d(()=>a[17]||(a[17]=[f(" 改密 ",-1)])),_:2,__:[17]},1032,["onClick","icon","disabled"]),i(r,{type:"danger",size:"small",onClick:a=>Se(e.row),icon:v(U),disabled:"admin"===e.row.role||"visitor"===e.row.username},{default:d(()=>a[18]||(a[18]=[f(" 删除 ",-1)])),_:2,__:[18]},1032,["onClick","icon","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ea,ye.value]]),ke.value?(n(),t("div",ne,[ye.value?(n(),w(ze,{key:0,rows:5,animated:""})):0===Ie.value.length?(n(),w($e,{key:1,description:"暂无用户"})):(n(),t("div",ue,[(n(!0),t(_,null,g(Ie.value,e=>(n(),t("div",{key:e.id,class:"mobile-user-item"},[u("div",ce,[i(l,{class:"user-icon"},{default:d(()=>[i(v(V))]),_:1}),u("div",me,[u("div",ve,p(e.username),1),u("div",pe,[u("span",null,"ID: "+p(e.id),1),i(k,{type:Fe(e.role),size:"small"},{default:d(()=>[f(p(Me(e.role)),1)]),_:2},1032,["type"])]),u("div",we,p(e.email),1),u("div",fe,"最后上线: "+p(e.lastLoginTime||"从未登录"),1)])]),u("div",_e,[i(H,null,{default:d(()=>[i(r,{type:"primary",size:"small",onClick:a=>Ne(e),icon:v(V),disabled:"visitor"===e.username},{default:d(()=>a[19]||(a[19]=[f(" 设角色 ",-1)])),_:2,__:[19]},1032,["onClick","icon","disabled"]),i(r,{type:"warning",size:"small",onClick:a=>Ge(e),icon:v(L),disabled:"visitor"===e.username},{default:d(()=>a[20]||(a[20]=[f(" 改密 ",-1)])),_:2,__:[20]},1032,["onClick","icon","disabled"]),i(r,{type:"danger",size:"small",onClick:a=>Se(e),icon:v(U),disabled:"admin"===e.role||"visitor"===e.username},{default:d(()=>a[21]||(a[21]=[f(" 删除 ",-1)])),_:2,__:[21]},1032,["onClick","icon","disabled"])]),_:2},1024)])]))),128))]))])):m("",!0)]),_:1}),i(Qe,{modelValue:Ce.value,"onUpdate:modelValue":a[5]||(a[5]=e=>Ce.value=e),title:"修改用户密码",width:"400px","close-on-click-modal":!1},{footer:d(()=>[u("span",ge,[i(r,{onClick:a[4]||(a[4]=e=>Ce.value=!1)},{default:d(()=>a[22]||(a[22]=[f("取消",-1)])),_:1,__:[22]}),i(r,{type:"primary",onClick:Je,loading:Ve.value},{default:d(()=>a[23]||(a[23]=[f(" 确定 ",-1)])),_:1,__:[23]},8,["loading"])])]),default:d(()=>[i(Xe,{ref_key:"changePasswordFormRef",ref:je,model:qe.value,rules:Be,"label-width":"100px"},{default:d(()=>[i(He,{label:"用户名"},{default:d(()=>[i(s,{modelValue:qe.value.username,"onUpdate:modelValue":a[1]||(a[1]=e=>qe.value.username=e),disabled:""},null,8,["modelValue"])]),_:1}),i(He,{label:"新密码",prop:"newPassword"},{default:d(()=>[i(s,{modelValue:qe.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>qe.value.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),i(He,{label:"确认密码",prop:"confirmPassword"},{default:d(()=>[i(s,{modelValue:qe.value.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>qe.value.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),i(Qe,{modelValue:xe.value,"onUpdate:modelValue":a[9]||(a[9]=e=>xe.value=e),title:"设置用户角色",width:"400px","close-on-click-modal":!1},{footer:d(()=>[u("span",he,[i(r,{onClick:a[8]||(a[8]=e=>xe.value=!1)},{default:d(()=>a[24]||(a[24]=[f("取消",-1)])),_:1,__:[24]}),i(r,{type:"primary",onClick:Oe,loading:Pe.value},{default:d(()=>a[25]||(a[25]=[f(" 确定 ",-1)])),_:1,__:[25]},8,["loading"])])]),default:d(()=>[i(Xe,{ref_key:"setRoleFormRef",ref:Re,model:Ee.value,rules:De,"label-width":"100px"},{default:d(()=>[i(He,{label:"用户名"},{default:d(()=>[i(s,{modelValue:Ee.value.username,"onUpdate:modelValue":a[6]||(a[6]=e=>Ee.value.username=e),disabled:""},null,8,["modelValue"])]),_:1}),i(He,{label:"当前角色"},{default:d(()=>[i(k,{type:Fe(Ee.value.currentRole)},{default:d(()=>[f(p(Me(Ee.value.currentRole)),1)]),_:1},8,["type"])]),_:1}),i(He,{label:"新角色",prop:"newRole"},{default:d(()=>[i(Ze,{modelValue:Ee.value.newRole,"onUpdate:modelValue":a[7]||(a[7]=e=>Ee.value.newRole=e),placeholder:"请选择新角色",style:{width:"100%"}},{default:d(()=>[i(Ye,{label:"管理员",value:"admin"}),i(Ye,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-dfe9a108"]]);export{ye as default};
