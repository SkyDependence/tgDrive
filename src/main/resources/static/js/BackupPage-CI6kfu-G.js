var e=(e,a,t)=>new Promise((n,o)=>{var l=e=>{try{s(t.next(e))}catch(a){o(a)}},r=e=>{try{s(t.throw(e))}catch(a){o(a)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,r);s((t=t.apply(e,a)).next())});import{_ as a}from"./index-BMCoaVX0.js";/* empty css                *//* empty css                  *//* empty css                   */import{Q as t,ay as n,B as o,u as l,E as r,h as s,e as i,f as c,a5 as d,O as u}from"./element-plus-p6bCxHry.js";import{s as p}from"./request-ByDjFvYQ.js";import{p as m,a as v,q as h,U as f,O as y,v as g,t as w,u as b,S as j}from"./vue-vendor-BrR667iQ.js";import"./utils-CuRI1GyR.js";const _={class:"page-container"},k={class:"card-header"},x={class:"action-section"},B={class:"action-item"},O={class:"action-item"},R=a(m({__name:"BackupPage",setup(a){const m=v(!1),R=v(!1),U=v(),C=e=>{var a;"application/octet-stream"===(null==(a=e.raw)?void 0:a.type)||e.name.endsWith(".db")?s.confirm(`您确定要使用文件 "${e.name}" 恢复数据库吗？此操作不可逆。`,"警告",{confirmButtonText:"确定恢复",cancelButtonText:"取消",type:"warning"}).then(()=>{L(e)}).catch(()=>{r.info("已取消恢复操作")}):r.error("只能上传 .db 格式的数据库文件!")},L=a=>e(this,null,function*(){var e;if(!a.raw)return;R.value=!0;const t=new FormData;t.append("multipartFile",a.raw);try{const e=yield p({url:"/backup/upload",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}});if(1!==e.data.code)throw new Error(e.data.msg||"数据库恢复失败");r.success("数据库恢复成功")}catch(n){r.error(n.message||"数据库恢复失败")}finally{R.value=!1,null==(e=U.value)||e.clearFiles()}}),T=()=>e(this,null,function*(){m.value=!0;try{const e=yield p({url:"/backup/download",method:"get",responseType:"blob"}),a=new Blob([e.data]),t=window.URL.createObjectURL(a),n=document.createElement("a");n.href=t;const o=(new Date).toISOString().slice(0,19).replace(/:/g,"-");n.setAttribute("download",`tgDrive-backup-${o}.db`),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t),r.success("数据库备份下载成功")}catch(e){r.error("下载失败："+e.message)}finally{m.value=!1}});return(e,a)=>{const r=i,s=c,p=d,v=u,L=t;return g(),h("div",_,[f(L,{class:"content-card"},{header:y(()=>[w("div",k,[f(r,null,{default:y(()=>[f(b(n))]),_:1}),a[0]||(a[0]=w("span",null,"数据库管理",-1))])]),default:y(()=>[w("div",x,[w("div",B,[a[2]||(a[2]=w("h3",null,"备份数据库",-1)),a[3]||(a[3]=w("p",null,"将当前数据库下载为 .db 文件。请妥善保管备份文件。",-1)),f(s,{type:"primary",onClick:T,loading:m.value,icon:b(o),size:"large"},{default:y(()=>a[1]||(a[1]=[j(" 下载备份 ")])),_:1},8,["loading","icon"])]),f(p,{direction:"horizontal"}),w("div",O,[a[5]||(a[5]=w("h3",null,"恢复数据库",-1)),a[6]||(a[6]=w("p",null,"从 .db 备份文件恢复数据库。此操作将覆盖当前所有数据，请谨慎操作。",-1)),f(v,{ref_key:"uploadRef",ref:U,"auto-upload":!1,"show-file-list":!1,accept:".db","on-change":C},{default:y(()=>[f(s,{type:"danger",loading:R.value,icon:b(l),size:"large",plain:""},{default:y(()=>a[4]||(a[4]=[j(" 选择文件并恢复 ")])),_:1},8,["loading","icon"])]),_:1},512)])])]),_:1})])}}}),[["__scopeId","data-v-3422c4d6"]]);export{R as default};
