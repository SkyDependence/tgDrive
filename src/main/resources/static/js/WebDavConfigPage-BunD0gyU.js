var e=(e,l,a)=>new Promise((t,d)=>{var o=e=>{try{s(a.next(e))}catch(l){d(l)}},i=e=>{try{s(a.throw(e))}catch(l){d(l)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,i);s((a=a.apply(e,l)).next())});import{_ as l}from"./index-BMCoaVX0.js";/* empty css                 *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                   */import{E as a,Q as t,Y as d,ap as o,aD as i,c as s,ag as n,aE as u,aF as r,h as c,e as p,a5 as m,aG as b,a2 as f,a1 as v,a8 as g,a4 as V,aH as h,f as w,a3 as x,aC as _}from"./element-plus-p6bCxHry.js";import{a as y}from"./utils-CuRI1GyR.js";import{p as D,a as A,Z as W,f as U,o as k,q as C,U as j,O as M,M as P,R as S,v as q,t as R,u as z,S as B,T}from"./vue-vendor-BrR667iQ.js";const F={class:"webdav-config-container"},E={class:"usage-content"},O={class:"webdav-url"},$=l(D({__name:"WebDavConfigPage",setup(l){const D=A(),$=A(!1),G=A(!1),H=W({enabled:!0,pathPrefix:"/webdav",requireAuth:!0,allowedRoles:"admin",maxUploadSize:100,allowMkdir:!0,allowDelete:!0,allowMove:!0,allowCopy:!0,description:"WebDAV服务配置"}),I={pathPrefix:[{required:!0,message:"请输入访问路径",trigger:"blur"},{pattern:/^\/.*/,message:"路径必须以/开头",trigger:"blur"}],allowedRoles:[{required:!0,message:"请选择允许的角色",trigger:"change"}],maxUploadSize:[{required:!0,message:"请输入最大上传大小",trigger:"blur"},{type:"number",min:1,max:1024,message:"大小必须在1-1024MB之间",trigger:"blur"}]},L=U(()=>`${window.location.protocol}//${window.location.host}${H.pathPrefix}`),N=()=>e(this,null,function*(){try{const e=yield y.get("/api/webdav-config");1===e.data.code?Object.assign(H,e.data.data):a.error(e.data.msg||"加载配置失败")}catch(e){a.error("加载配置失败")}}),Q=()=>e(this,null,function*(){if(D.value)try{yield D.value.validate(),$.value=!0;const e=yield y.put("/api/webdav-config",H);1===e.data.code?a.success("配置保存成功"):a.error(e.data.msg||"配置保存失败")}catch(e){a.error("配置保存失败")}finally{$.value=!1}}),Y=()=>{D.value&&(D.value.resetFields(),N())},Z=()=>e(this,null,function*(){try{yield c.confirm("确定要恢复默认配置吗？这将覆盖当前所有设置。","确认恢复默认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),G.value=!0;const e=yield y.post("/api/webdav-config/reset");1===e.data.code?(a.success("已恢复默认配置"),yield N()):a.error(e.data.msg||"恢复默认配置失败")}catch(e){"cancel"!==e&&a.error("恢复默认配置失败")}finally{G.value=!1}}),J=e=>{e||c.confirm("禁用WebDAV服务后，所有WebDAV客户端将无法访问。确定要禁用吗？","确认禁用",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>{H.enabled=!0})},K=()=>e(this,null,function*(){try{yield navigator.clipboard.writeText(L.value),a.success("WebDAV地址已复制到剪贴板")}catch(e){a.error("复制失败")}});return k(()=>{N()}),(e,l)=>{const a=p,c=m,y=b,A=f,W=v,U=g,k=V,N=h,X=w,ee=x,le=t,ae=_;return q(),C("div",F,[j(le,{class:"config-card"},{header:M(()=>l[10]||(l[10]=[R("div",{class:"card-header"},[R("h2",null,"WebDAV配置"),R("p",{class:"subtitle"},"配置WebDAV服务的访问权限和功能设置")],-1)])),default:M(()=>[j(ee,{ref_key:"configFormRef",ref:D,model:H,rules:I,"label-width":"140px",class:"config-form"},{default:M(()=>[j(c,{"content-position":"left"},{default:M(()=>[j(a,null,{default:M(()=>[j(z(d))]),_:1}),l[11]||(l[11]=B(" 基础设置 "))]),_:1}),j(A,{label:"启用WebDAV",prop:"enabled"},{default:M(()=>[j(y,{modelValue:H.enabled,"onUpdate:modelValue":l[0]||(l[0]=e=>H.enabled=e),"active-text":"启用","inactive-text":"禁用",onChange:J},null,8,["modelValue"]),l[12]||(l[12]=R("div",{class:"form-tip"},"启用后可通过WebDAV协议访问文件",-1))]),_:1}),j(A,{label:"访问路径",prop:"pathPrefix"},{default:M(()=>[j(W,{modelValue:H.pathPrefix,"onUpdate:modelValue":l[1]||(l[1]=e=>H.pathPrefix=e),placeholder:"/webdav",disabled:!H.enabled},null,8,["modelValue","disabled"]),l[13]||(l[13]=R("div",{class:"form-tip"},"WebDAV服务的访问路径前缀",-1))]),_:1}),j(A,{label:"需要认证",prop:"requireAuth"},{default:M(()=>[j(y,{modelValue:H.requireAuth,"onUpdate:modelValue":l[2]||(l[2]=e=>H.requireAuth=e),"active-text":"需要","inactive-text":"不需要",disabled:!H.enabled},null,8,["modelValue","disabled"]),l[14]||(l[14]=R("div",{class:"form-tip"},"是否需要用户名密码认证",-1))]),_:1}),j(c,{"content-position":"left"},{default:M(()=>[j(a,null,{default:M(()=>[j(z(o))]),_:1}),l[15]||(l[15]=B(" 权限设置 "))]),_:1}),j(A,{label:"允许的角色",prop:"allowedRoles"},{default:M(()=>[j(k,{modelValue:H.allowedRoles,"onUpdate:modelValue":l[3]||(l[3]=e=>H.allowedRoles=e),placeholder:"请选择允许访问的用户角色",disabled:!H.enabled},{default:M(()=>[j(U,{label:"仅管理员",value:"admin"}),j(U,{label:"访客用户",value:"visitor"}),j(U,{label:"所有用户",value:"all"})]),_:1},8,["modelValue","disabled"]),l[16]||(l[16]=R("div",{class:"form-tip"},"设置哪些角色的用户可以访问WebDAV",-1))]),_:1}),j(c,{"content-position":"left"},{default:M(()=>[j(a,null,{default:M(()=>[j(z(i))]),_:1}),l[17]||(l[17]=B(" 功能设置 "))]),_:1}),j(A,{label:"最大上传大小",prop:"maxUploadSize"},{default:M(()=>[j(N,{modelValue:H.maxUploadSize,"onUpdate:modelValue":l[4]||(l[4]=e=>H.maxUploadSize=e),min:1,max:1024,step:10,disabled:!H.enabled},null,8,["modelValue","disabled"]),l[18]||(l[18]=R("span",{class:"unit"},"MB",-1)),l[19]||(l[19]=R("div",{class:"form-tip"},"单个文件的最大上传大小限制",-1))]),_:1}),j(A,{label:"允许创建目录",prop:"allowMkdir"},{default:M(()=>[j(y,{modelValue:H.allowMkdir,"onUpdate:modelValue":l[5]||(l[5]=e=>H.allowMkdir=e),"active-text":"允许","inactive-text":"禁止",disabled:!H.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"允许删除文件",prop:"allowDelete"},{default:M(()=>[j(y,{modelValue:H.allowDelete,"onUpdate:modelValue":l[6]||(l[6]=e=>H.allowDelete=e),"active-text":"允许","inactive-text":"禁止",disabled:!H.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"允许移动文件",prop:"allowMove"},{default:M(()=>[j(y,{modelValue:H.allowMove,"onUpdate:modelValue":l[7]||(l[7]=e=>H.allowMove=e),"active-text":"允许","inactive-text":"禁止",disabled:!H.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"允许复制文件",prop:"allowCopy"},{default:M(()=>[j(y,{modelValue:H.allowCopy,"onUpdate:modelValue":l[8]||(l[8]=e=>H.allowCopy=e),"active-text":"允许","inactive-text":"禁止",disabled:!H.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,{label:"配置描述",prop:"description"},{default:M(()=>[j(W,{modelValue:H.description,"onUpdate:modelValue":l[9]||(l[9]=e=>H.description=e),type:"textarea",rows:3,placeholder:"请输入配置描述",disabled:!H.enabled},null,8,["modelValue","disabled"])]),_:1}),j(A,null,{default:M(()=>[j(X,{type:"primary",onClick:Q,loading:$.value},{default:M(()=>[j(a,null,{default:M(()=>[j(z(s))]),_:1}),l[20]||(l[20]=B(" 保存配置 "))]),_:1},8,["loading"]),j(X,{onClick:Y},{default:M(()=>[j(a,null,{default:M(()=>[j(z(n))]),_:1}),l[21]||(l[21]=B(" 重置 "))]),_:1}),j(X,{onClick:Z,loading:G.value},{default:M(()=>[j(a,null,{default:M(()=>[j(z(u))]),_:1}),l[22]||(l[22]=B(" 恢复默认 "))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),H.enabled?(q(),P(le,{key:0,class:"usage-card"},{header:M(()=>l[23]||(l[23]=[R("div",{class:"card-header"},[R("h3",null,"WebDAV使用说明")],-1)])),default:M(()=>[R("div",E,[j(ae,{title:"WebDAV访问地址",type:"info",closable:!1,"show-icon":""},{default:M(()=>[R("div",O,[R("code",null,T(L.value),1),j(X,{size:"small",type:"primary",link:"",onClick:K},{default:M(()=>[j(a,null,{default:M(()=>[j(z(r))]),_:1}),l[24]||(l[24]=B(" 复制 "))]),_:1})])]),_:1}),l[25]||(l[25]=R("div",{class:"usage-steps"},[R("h4",null,"使用步骤："),R("ol",null,[R("li",null,"在支持WebDAV的客户端中添加网络位置"),R("li",null,"输入上述WebDAV访问地址"),R("li",null,"使用您的用户名和密码进行认证"),R("li",null,"即可像本地文件夹一样操作远程文件")])],-1)),l[26]||(l[26]=R("div",{class:"client-recommendations"},[R("h4",null,"推荐客户端："),R("ul",null,[R("li",null,[R("strong",null,"Windows:"),B(" 文件资源管理器、WinSCP")]),R("li",null,[R("strong",null,"macOS:"),B(" Finder、Cyberduck")]),R("li",null,[R("strong",null,"Linux:"),B(" Nautilus、Dolphin")]),R("li",null,[R("strong",null,"移动端:"),B(" ES文件浏览器、FE文件管理器")])])],-1))])]),_:1})):S("",!0)])}}}),[["__scopeId","data-v-2df4ceed"]]);export{$ as default};
