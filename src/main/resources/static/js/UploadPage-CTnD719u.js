import{u as e,f as a,_ as l}from"./index-BMCoaVX0.js";/* empty css                               *//* empty css                 *//* empty css                *//* empty css                  */import{p as s,a as t,f as i,o as n,A as o,q as d,U as r,O as u,ax as c,v as p,t as v,u as m,S as g,T as f,F as h,a8 as k,R as _,M as w}from"./vue-vendor-BrR667iQ.js";import{E as y,L as x,M as C,u as T,N as z,e as b,O as j,f as F,P as L,Q as M,R as U,S as $,T as P,U as N,V as R,W as D,g as E,X as O}from"./element-plus-p6bCxHry.js";import"./utils-CuRI1GyR.js";const A={class:"page-container"},I={class:"card-header"},S={class:"upload-actions"},V={key:0,class:"progress-section"},q={class:"file-header"},Q={class:"file-name"},W={class:"file-size-info"},X={key:0,class:"telegram-info"},B={class:"telegram-progress-text"},G={key:1,class:"telegram-info"},H={class:"card-header"},J={key:0,class:"empty-state"},K={key:1,class:"uploaded-files-list"},Y={class:"file-details"},Z={class:"uploaded-file-name"},ee={class:"file-actions"},ae={class:"batch-actions"},le=l(s({__name:"UploadPage",setup(l){const s=c(),le=t(),se=t([]),te=i(()=>e.uploadCompletedCount.value),ie=(e,a)=>{var l;se.value.some(a=>a.name===e.name&&a.size===e.size)?(null==(l=le.value)||l.handleRemove(e),y.warning(`文件 ${e.name} 已存在`)):se.value=a},ne=(e,a)=>{se.value=a},oe=()=>{return a=this,l=null,s=function*(){var a;if(0===se.value.length)return void y.warning("请先选择文件");const l=se.value.map(e=>({name:e.name,size:e.size,uid:e.uid,raw:e.raw,status:"ready"}));yield e.startUpload(l),se.value=[],null==(a=le.value)||a.clearFiles(),y.success("文件已加入上传队列，可以切换到其他页面，上传将在后台继续")},new Promise((e,t)=>{var i=e=>{try{o(s.next(e))}catch(a){t(a)}},n=e=>{try{o(s.throw(e))}catch(a){t(a)}},o=a=>a.done?e(a.value):Promise.resolve(a.value).then(i,n);o((s=s.apply(a,l)).next())});var a,l,s},de=()=>{s.push("/fileList")},re=(e,a)=>{navigator.clipboard.writeText(e).then(()=>{y.success(a)}).catch(e=>{y.error("复制失败: "+e)})},ue=()=>{const a=e.uploadedFiles.value.map(e=>`[${e.fileName}](${e.downloadLink})`).join("\n");re(a,`已批量复制 ${e.uploadedFiles.value.length} 个 Markdown 链接`)},ce=()=>{const a=e.uploadedFiles.value.map(e=>e.downloadLink).join("\n");re(a,`已批量复制 ${e.uploadedFiles.value.length} 个下载链接`)},pe=e=>{var a;const l=null==(a=e.clipboardData)?void 0:a.items;if(l){for(let e=0;e<l.length;e++)if("file"===l[e].kind){const a=l[e].getAsFile();if(a){const l=Date.now()+e,s={name:a.name,size:a.size,uid:l,raw:Object.assign(a,{uid:l}),status:"ready"};se.value.some(e=>e.name===s.name&&e.size===s.size)||se.value.push(s)}}se.value.length>0&&y.success("已通过粘贴添加文件")}};return n(()=>{window.addEventListener("paste",pe)}),o(()=>{window.removeEventListener("paste",pe)}),(l,s)=>{const t=b,i=j,n=F,o=E,c=L,y=M,pe=U,ve=$,me=O,ge=x;return p(),d("div",A,[r(ge,{gutter:20},{default:u(()=>[r(pe,{xs:24,sm:24,md:14,lg:14,xl:14},{default:u(()=>[r(y,{class:"content-card"},{header:u(()=>[v("div",I,[r(t,null,{default:u(()=>[r(m(C))]),_:1}),s[0]||(s[0]=v("span",null,"文件上传",-1))])]),default:u(()=>[r(i,{ref_key:"uploadRef",ref:le,drag:"",multiple:"",action:"#","auto-upload":!1,"on-change":ie,"on-remove":ne,"file-list":se.value,class:"upload-dragger"},{tip:u(()=>s[1]||(s[1]=[v("div",{class:"el-upload__tip"}," 支持多文件上传，支持 Ctrl+V 粘贴文件。 ",-1)])),default:u(()=>[r(t,{class:"el-icon--upload"},{default:u(()=>[r(m(C))]),_:1}),s[2]||(s[2]=v("div",{class:"el-upload__text"},[g(" 将文件拖到此处, 或 "),v("em",null,"点击选择")],-1))]),_:1},8,["file-list"]),v("div",S,[r(n,{type:"primary",onClick:oe,disabled:m(e).isUploading.value||0===se.value.length,loading:m(e).isUploading.value,size:"large",icon:m(T)},{default:u(()=>[g(f(m(e).isUploading.value?`正在上传 (${te.value}/${m(e).uploadProgress.value.length})`:"开始上传"),1)]),_:1},8,["disabled","loading","icon"])]),r(c,null,{default:u(()=>[m(e).uploadProgress.value.length>0?(p(),d("div",V,[(p(!0),d(h,null,k(m(e).uploadProgress.value,l=>(p(),d("div",{key:l.uid,class:"file-progress-item"},[v("div",q,[v("span",Q,f(l.name),1),l.canCancel&&m(e).isUploading.value?(p(),w(n,{key:0,text:"",type:"danger",size:"small",onClick:a=>{return s=l.uid,void e.cancelUpload(s);var s}},{default:u(()=>s[3]||(s[3]=[g(" 取消 ")])),_:2},1032,["onClick"])):_("",!0)]),r(o,{percentage:Math.round(100*l.percentage)/100,status:l.status,"stroke-width":8,striped:"","striped-flow":"success"!==l.status&&"exception"!==l.status},null,8,["percentage","status","striped-flow"]),v("div",W,f(m(a)(l.loaded))+" / "+f(m(a)(l.total)),1),"uploading"===l.serverToTelegram.status?(p(),d("div",X,[v("div",B," 传输到Telegram: "+f(l.serverToTelegram.currentChunk||0)+"/"+f(l.serverToTelegram.totalChunks||0)+" 片 ("+f(Math.round(100*l.serverToTelegram.percentage)/100)+"%) ",1),r(o,{percentage:Math.round(100*l.serverToTelegram.percentage)/100,"stroke-width":4,"show-text":!1,striped:"","striped-flow":""},null,8,["percentage"])])):"completed"===l.serverToTelegram.status?(p(),d("div",G,s[4]||(s[4]=[v("div",{class:"telegram-progress-text"},"✅ 已传输到Telegram",-1)]))):_("",!0)]))),128))])):_("",!0)]),_:1})]),_:1})]),_:1}),r(pe,{xs:24,sm:24,md:10,lg:10,xl:10},{default:u(()=>[r(y,{class:"content-card"},{header:u(()=>[v("div",H,[r(t,null,{default:u(()=>[r(m(z))]),_:1}),s[6]||(s[6]=v("span",null,"本次上传结果",-1)),r(n,{text:"",type:"primary",onClick:de},{default:u(()=>s[5]||(s[5]=[g("查看全部")])),_:1})])]),default:u(()=>[0===m(e).uploadedFiles.value.length?(p(),d("div",J,[r(ve,{description:"暂无上传成功的文件"})])):(p(),d("div",K,[(p(!0),d(h,null,k(m(e).uploadedFiles.value,e=>(p(),d("div",{key:e.fileId,class:"uploaded-file-item"},[v("div",Y,[r(t,null,{default:u(()=>[r(m(P))]),_:1}),v("span",Z,f(e.fileName),1)]),v("div",ee,[r(me,{content:"复制 Markdown 格式",placement:"top"},{default:u(()=>[r(n,{text:"",circle:"",icon:m(N),onClick:a=>(e=>{re(`[${e.fileName}](${e.downloadLink})`,"Markdown 格式已复制")})(e)},null,8,["icon","onClick"])]),_:2},1024),r(me,{content:"复制下载链接",placement:"top"},{default:u(()=>[r(n,{text:"",circle:"",icon:m(R),onClick:a=>(e=>{re(e.downloadLink,"下载链接已复制")})(e)},null,8,["icon","onClick"])]),_:2},1024),r(me,{content:"打开/下载文件",placement:"top"},{default:u(()=>[r(n,{text:"",circle:"",icon:m(D),onClick:a=>{return l=e.downloadLink,void window.open(l,"_blank");var l}},null,8,["icon","onClick"])]),_:2},1024)])]))),128)),v("div",ae,[r(n,{onClick:ue,disabled:0===m(e).uploadedFiles.value.length,size:"small",plain:""},{default:u(()=>s[7]||(s[7]=[g("批量复制 (MD)")])),_:1},8,["disabled"]),r(n,{onClick:ce,disabled:0===m(e).uploadedFiles.value.length,size:"small",plain:""},{default:u(()=>s[8]||(s[8]=[g("批量复制 (链接)")])),_:1},8,["disabled"])])]))]),_:1})]),_:1})]),_:1})])}}}),[["__scopeId","data-v-7167ad3a"]]);export{le as default};
