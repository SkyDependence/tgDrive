import{_ as a}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                             *//* empty css               *//* empty css                  */import{a as e,aj as l,f as s,aa as t,d as r,b as o,I as d,a1 as i,ax as u,aI as c,w as n,$ as m,aJ as v,ap as p,aK as f,J as w,aL as g,F as _,G as h,j as y,z as b,A as V,B as k}from"./element-plus-BpKNpHyv.js";import{s as P}from"./request-CJwrkdbI.js";import{d as j,r as x,V as C,f as U,c as z,a as B,P as M,u as T,H as F,O as G,R as I,o as L,G as R,M as q}from"./vue-vendor-B9yd_xiB.js";import"./vendor-BoV0XpOF.js";const A={class:"user-profile"},D={class:"profile-header"},O={class:"header-content"},$={class:"avatar-section"},J={class:"user-info"},H={class:"username"},K={class:"user-role"},N={class:"user-status"},S={class:"header-actions"},Z={class:"profile-content"},E={class:"info-card"},Q={class:"card-header"},W={class:"card-content"},X={class:"email-info"},Y={class:"stats-card"},aa={class:"card-header"},ea={class:"card-content"},la={class:"stat-item"},sa={class:"stat-icon"},ta={class:"stat-info"},ra={class:"stat-value"},oa={class:"stat-item"},da={class:"stat-icon"},ia={class:"stat-info"},ua={class:"stat-value"},ca={class:"stat-item"},na={class:"stat-icon"},ma={class:"stat-info"},va={class:"stat-value"},pa={class:"stat-item"},fa={class:"stat-icon"},wa={class:"stat-info"},ga={class:"stat-value"},_a={class:"security-card"},ha={class:"card-header"},ya={class:"card-content"},ba={class:"security-item"},Va={class:"security-item"},ka={class:"security-info"},Pa={class:"security-desc"},ja={class:"dialog-footer"},xa={class:"dialog-footer"},Ca={class:"avatar-upload"},Ua={class:"current-avatar"},za={class:"dialog-footer"},Ba=a(j({__name:"UserProfile",setup(a){const j=x({}),Ba=x({}),Ma=x(!1),Ta=x(!1),Fa=x(!1),Ga=x(!1),Ia=x(!1),La=x(!1),Ra=x(),qa=x(),Aa=C({nickname:"",email:"",phone:"",remark:""}),Da=C({oldPassword:"",newPassword:"",confirmPassword:""}),Oa=C({avatar:""}),$a={nickname:[{max:50,message:"昵称长度不能超过 50 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],remark:[{max:200,message:"备注长度不能超过 200 个字符",trigger:"blur"}]},Ja={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,max:50,message:"密码长度在 8 到 50 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(a,e,l)=>{e!==Da.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},Ha=()=>{Object.assign(Aa,{nickname:j.value.nickname||"",email:j.value.email||"",phone:j.value.phone||"",remark:j.value.remark||""}),Ma.value=!0},Ka=()=>{var a;Ma.value=!1,null==(a=Ra.value)||a.clearValidate()},Na=async()=>{if(Ra.value)try{await Ra.value.validate(),Ga.value=!0,await P.put("/api/user/profile",Aa),e.success("个人资料更新成功"),Object.assign(j.value,Aa),Ka()}catch(a){e.error("个人资料更新失败")}finally{Ga.value=!1}},Sa=()=>{Object.assign(Da,{oldPassword:"",newPassword:"",confirmPassword:""}),Ta.value=!0},Za=()=>{var a;Ta.value=!1,null==(a=qa.value)||a.clearValidate()},Ea=async()=>{if(qa.value)try{await qa.value.validate(),Ia.value=!0,await P.put("/api/user/password",{oldPassword:Da.oldPassword,newPassword:Da.newPassword}),e.success("密码修改成功"),Za()}catch(a){e.error("密码修改失败")}finally{Ia.value=!1}},Qa=()=>{Oa.avatar=j.value.avatar||"",Fa.value=!0},Wa=()=>{Fa.value=!1},Xa=async()=>{try{La.value=!0,await P.put("/api/user/avatar",{avatar:Oa.avatar}),e.success("头像更新成功"),j.value.avatar=Oa.avatar,Wa()}catch(a){e.error("头像更新失败")}finally{La.value=!1}},Ya=()=>{e.info("邮箱绑定功能开发中")},ae=a=>["正常","禁用","锁定"][a]||"未知",ee=a=>a?new Date(a).toLocaleString("zh-CN"):"",le=a=>{if(0===a)return"0 B";const e=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB","TB"][e]},se=a=>{if(!a)return 0;const e=new Date,l=new Date(a),s=Math.abs(e.getTime()-l.getTime());return Math.ceil(s/864e5)};return U(()=>{(async()=>{try{const a=await P.get("/api/user/profile");j.value=a.data}catch(a){e.error("加载用户信息失败")}})(),(async()=>{try{const a=await P.get("/api/user/stats");Ba.value=a.data}catch(a){}})()}),(a,e)=>{const P=l,x=s,C=t,U=r,te=_,re=h,oe=y,de=o,ie=b,ue=V,ce=k,ne=d;return L(),z("div",A,[B("div",D,[e[14]||(e[14]=B("div",{class:"header-background"},null,-1)),B("div",O,[B("div",$,[M(P,{size:120,src:j.value.avatar,icon:T(i),class:"profile-avatar"},null,8,["src","icon"]),M(x,{type:"primary",size:"small",onClick:Qa,class:"avatar-edit-btn",icon:T(u)},{default:F(()=>e[11]||(e[11]=[I(" 更换头像 ")])),_:1},8,["icon"])]),B("div",J,[B("h1",H,G(j.value.nickname||j.value.username),1),B("p",K,[M(C,{type:"admin"===j.value.role?"danger":"primary",size:"large"},{default:F(()=>[I(G("admin"===j.value.role?"管理员":"普通用户"),1)]),_:1},8,["type"])]),B("p",N,[M(U,null,{default:F(()=>[M(T(c))]),_:1}),I(" 最后登录："+G(ee(j.value.lastLoginTime)||"从未登录"),1)])]),B("div",S,[M(x,{type:"primary",onClick:Ha,icon:T(u)},{default:F(()=>e[12]||(e[12]=[I(" 编辑资料 ")])),_:1},8,["icon"]),M(x,{onClick:Sa,icon:T(n)},{default:F(()=>e[13]||(e[13]=[I(" 修改密码 ")])),_:1},8,["icon"])])])]),B("div",Z,[M(de,{gutter:24},{default:F(()=>[M(oe,{span:16},{default:F(()=>[B("div",E,[B("div",Q,[B("h3",null,[M(U,null,{default:F(()=>[M(T(m))]),_:1}),e[15]||(e[15]=I("基本信息"))])]),B("div",W,[M(re,{column:2,border:""},{default:F(()=>[M(te,{label:"用户ID"},{default:F(()=>[I(G(j.value.id),1)]),_:1}),M(te,{label:"用户名"},{default:F(()=>[I(G(j.value.username),1)]),_:1}),M(te,{label:"昵称"},{default:F(()=>[I(G(j.value.nickname||"未设置"),1)]),_:1}),M(te,{label:"邮箱"},{default:F(()=>[B("div",X,[I(G(j.value.email||"未设置")+" ",1),j.value.email?(L(),R(C,{key:0,type:"success",size:"small",class:"verified-tag"},{default:F(()=>e[16]||(e[16]=[I(" 已验证 ")])),_:1})):q("",!0)])]),_:1}),M(te,{label:"手机号"},{default:F(()=>[I(G(j.value.phone||"未设置"),1)]),_:1}),M(te,{label:"注册时间"},{default:F(()=>[I(G(ee(j.value.createTime)),1)]),_:1}),M(te,{label:"更新时间"},{default:F(()=>[I(G(ee(j.value.updateTime)),1)]),_:1}),M(te,{label:"账户状态"},{default:F(()=>{return[M(C,{type:(a=j.value.status,["success","warning","danger"][a]||"info")},{default:F(()=>[I(G(ae(j.value.status)),1)]),_:1},8,["type"])];var a}),_:1}),M(te,{label:"备注",span:2},{default:F(()=>[I(G(j.value.remark||"无"),1)]),_:1})]),_:1})])])]),_:1}),M(oe,{span:8},{default:F(()=>[B("div",Y,[B("div",aa,[B("h3",null,[M(U,null,{default:F(()=>[M(T(v))]),_:1}),e[17]||(e[17]=I("使用统计"))])]),B("div",ea,[B("div",la,[B("div",sa,[M(U,{color:"#409eff"},{default:F(()=>[M(T(p))]),_:1})]),B("div",ta,[B("div",ra,G(Ba.value.fileCount||0),1),e[18]||(e[18]=B("div",{class:"stat-label"},"文件数量",-1))])]),B("div",oa,[B("div",da,[M(U,{color:"#67c23a"},{default:F(()=>[M(T(f))]),_:1})]),B("div",ia,[B("div",ua,G(le(Ba.value.totalSize||0)),1),e[19]||(e[19]=B("div",{class:"stat-label"},"存储空间",-1))])]),B("div",ca,[B("div",na,[M(U,{color:"#e6a23c"},{default:F(()=>[M(T(w))]),_:1})]),B("div",ma,[B("div",va,G(Ba.value.downloadCount||0),1),e[20]||(e[20]=B("div",{class:"stat-label"},"下载次数",-1))])]),B("div",pa,[B("div",fa,[M(U,{color:"#f56c6c"},{default:F(()=>[M(T(g))]),_:1})]),B("div",wa,[B("div",ga,G(se(j.value.createTime)),1),e[21]||(e[21]=B("div",{class:"stat-label"},"使用天数",-1))])])])]),B("div",_a,[B("div",ha,[B("h3",null,[M(U,null,{default:F(()=>[M(T(n))]),_:1}),e[22]||(e[22]=I("安全设置"))])]),B("div",ya,[B("div",ba,[e[24]||(e[24]=B("div",{class:"security-info"},[B("div",{class:"security-title"},"登录密码"),B("div",{class:"security-desc"},"定期更换密码可以提高账户安全性")],-1)),M(x,{size:"small",onClick:Sa},{default:F(()=>e[23]||(e[23]=[I(" 修改 ")])),_:1})]),B("div",Va,[B("div",ka,[e[25]||(e[25]=B("div",{class:"security-title"},"邮箱验证",-1)),B("div",Pa,G(j.value.email?"已绑定邮箱":"未绑定邮箱"),1)]),M(x,{size:"small",onClick:Ya},{default:F(()=>[I(G(j.value.email?"更换":"绑定"),1)]),_:1})])])])]),_:1})]),_:1})]),M(ne,{modelValue:Ma.value,"onUpdate:modelValue":e[4]||(e[4]=a=>Ma.value=a),title:"编辑个人资料",width:"600px","before-close":Ka},{footer:F(()=>[B("span",ja,[M(x,{onClick:Ka},{default:F(()=>e[26]||(e[26]=[I("取消")])),_:1}),M(x,{type:"primary",onClick:Na,loading:Ga.value},{default:F(()=>e[27]||(e[27]=[I(" 保存 ")])),_:1},8,["loading"])])]),default:F(()=>[M(ce,{model:Aa,rules:$a,ref_key:"editFormRef",ref:Ra,"label-width":"100px"},{default:F(()=>[M(ue,{label:"昵称",prop:"nickname"},{default:F(()=>[M(ie,{modelValue:Aa.nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>Aa.nickname=a),placeholder:"请输入昵称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),M(ue,{label:"邮箱",prop:"email"},{default:F(()=>[M(ie,{modelValue:Aa.email,"onUpdate:modelValue":e[1]||(e[1]=a=>Aa.email=a),type:"email",placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),M(ue,{label:"手机号",prop:"phone"},{default:F(()=>[M(ie,{modelValue:Aa.phone,"onUpdate:modelValue":e[2]||(e[2]=a=>Aa.phone=a),placeholder:"请输入手机号",maxlength:"11"},null,8,["modelValue"])]),_:1}),M(ue,{label:"备注",prop:"remark"},{default:F(()=>[M(ie,{modelValue:Aa.remark,"onUpdate:modelValue":e[3]||(e[3]=a=>Aa.remark=a),type:"textarea",rows:3,placeholder:"请输入个人简介或备注",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),M(ne,{modelValue:Ta.value,"onUpdate:modelValue":e[8]||(e[8]=a=>Ta.value=a),title:"修改密码",width:"500px","before-close":Za},{footer:F(()=>[B("span",xa,[M(x,{onClick:Za},{default:F(()=>e[28]||(e[28]=[I("取消")])),_:1}),M(x,{type:"primary",onClick:Ea,loading:Ia.value},{default:F(()=>e[29]||(e[29]=[I(" 确认修改 ")])),_:1},8,["loading"])])]),default:F(()=>[M(ce,{model:Da,rules:Ja,ref_key:"passwordFormRef",ref:qa,"label-width":"100px"},{default:F(()=>[M(ue,{label:"当前密码",prop:"oldPassword"},{default:F(()=>[M(ie,{modelValue:Da.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=a=>Da.oldPassword=a),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),M(ue,{label:"新密码",prop:"newPassword"},{default:F(()=>[M(ie,{modelValue:Da.newPassword,"onUpdate:modelValue":e[6]||(e[6]=a=>Da.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),M(ue,{label:"确认密码",prop:"confirmPassword"},{default:F(()=>[M(ie,{modelValue:Da.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=a=>Da.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),M(ne,{modelValue:Fa.value,"onUpdate:modelValue":e[10]||(e[10]=a=>Fa.value=a),title:"更换头像",width:"400px","before-close":Wa},{footer:F(()=>[B("span",za,[M(x,{onClick:Wa},{default:F(()=>e[31]||(e[31]=[I("取消")])),_:1}),M(x,{type:"primary",onClick:Xa,loading:La.value},{default:F(()=>e[32]||(e[32]=[I(" 保存 ")])),_:1},8,["loading"])])]),default:F(()=>[B("div",Ca,[B("div",Ua,[M(P,{size:100,src:Oa.avatar||j.value.avatar,icon:T(i)},null,8,["src","icon"])]),M(ce,{model:Oa,"label-width":"80px"},{default:F(()=>[M(ue,{label:"头像URL"},{default:F(()=>[M(ie,{modelValue:Oa.avatar,"onUpdate:modelValue":e[9]||(e[9]=a=>Oa.avatar=a),placeholder:"请输入头像图片URL",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e[30]||(e[30]=B("div",{class:"avatar-tips"},[B("p",null,"提示："),B("ul",null,[B("li",null,"支持 JPG、PNG、GIF 格式"),B("li",null,"建议图片尺寸为 200x200 像素"),B("li",null,"图片大小不超过 2MB")])],-1))])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-9993b662"]]);export{Ba as default};
