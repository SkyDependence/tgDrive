import{_ as e}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                   *//* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css               *//* empty css                 */import{d as l,j as a,r as i,w as s,G as o,H as t,o as n,a as r,P as u,u as c,R as d,c as v,O as p,K as f,I as m,M as g,n as w,f as h,y,Q as k,a7 as b,$ as _}from"./vue-vendor-6Mo5xx1f.js";import{s as x}from"./request-6gu65CLC.js";import{I as C,J as j,K as z,l as I,L as V,d as N,M as U,f as L,N as M,a as T,i as $,O as B,P as D,Q as Y,v as R,R as F,m as P,S,y as H,z as E,j as O,H as K,C as q,T as G,b as Q,U as W,V as J,W as X,X as Z,k as A,Y as ee,Z as le,_ as ae}from"./element-plus-CR-v5VwI.js";import{H as ie}from"./vendor-D7C3kDz-.js";const se={class:"preview-container"},oe={key:0,class:"image-preview"},te={key:1,class:"video-preview"},ne=["src"],re={key:2,class:"audio-preview"},ue={class:"audio-info"},ce=["src"],de={key:3,class:"pdf-preview"},ve=["src"],pe=["href"],fe={key:4,class:"text-preview"},me={class:"text-content"},ge={key:5,class:"office-preview"},we={class:"office-viewer"},he=["src"],ye={key:6,class:"code-preview"},ke=["innerHTML"],be={key:7,class:"unsupported-preview"},_e={class:"unsupported-content"},xe={key:8,"element-loading-text":"加载中...",class:"loading-overlay"},Ce={class:"dialog-footer"},je=e(l({__name:"FilePreview",props:{modelValue:{type:Boolean},fileInfo:{}},emits:["update:modelValue","download"],setup(e,{emit:l}){const h=e,y=l,k=a({get:()=>h.modelValue,set:e=>y("update:modelValue",e)}),b=i(!1),_=i(""),x=i(""),$=a(()=>{var e,l;return(null==(e=h.fileInfo)?void 0:e.fileName)&&(null==(l=h.fileInfo.fileName.split(".").pop())?void 0:l.toLowerCase())||""}),B=a(()=>["jpg","jpeg","png","gif","bmp","webp","svg"].includes($.value)),D=a(()=>["mp4","avi","mov","wmv","flv","webm","mkv"].includes($.value)),Y=a(()=>["mp3","wav","flac","aac","ogg","m4a"].includes($.value)),R=a(()=>"pdf"===$.value),F=a(()=>["txt","md","json","xml","csv","log"].includes($.value)),P=a(()=>["doc","docx","xls","xlsx","ppt","pptx"].includes($.value)),S=a(()=>["js","ts","vue","html","css","scss","less","java","py","cpp","c","go","rs","php","rb","swift","kt"].includes($.value)),H=a(()=>{var e;return(null==(e=h.fileInfo)?void 0:e.downloadUrl)||""}),E=()=>({js:"javascript",ts:"typescript",vue:"vue",html:"html",css:"css",scss:"scss",less:"less",java:"java",py:"python",cpp:"cpp",c:"c",go:"go",rs:"rust",php:"php",rb:"ruby",swift:"swift",kt:"kotlin"}[$.value]||"plaintext"),O=e=>{const l="string"==typeof e?parseInt(e):e;if(0===l)return"0 B";const a=Math.floor(Math.log(l)/Math.log(1024));return parseFloat((l/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB","TB"][a]},K=async()=>{if(h.fileInfo&&(F.value||S.value)){b.value=!0;try{const e=await fetch(H.value),l=await e.text();if(S.value){const e=ie.highlight(l,{language:E()});x.value=e.value}else _.value=l}catch(e){T.error("加载文件内容失败")}finally{b.value=!1}}},q=()=>{h.fileInfo&&y("download",h.fileInfo)},G=()=>{k.value=!1,_.value="",x.value=""};return s(()=>h.fileInfo,async e=>{e&&k.value&&(await w(),(F.value||S.value)&&K())},{immediate:!0}),s(k,async e=>{e&&h.fileInfo&&(await w(),(F.value||S.value)&&K())}),(e,l)=>{var a;const i=V,s=N,w=U,h=L,y=C,T=M;return n(),o(y,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=e=>k.value=e),title:(null==(a=e.fileInfo)?void 0:a.fileName)||"文件预览",width:"80%","before-close":G,class:"file-preview-dialog"},{footer:t(()=>[r("div",Ce,[u(h,{onClick:q},{default:t(()=>[u(s,null,{default:t(()=>[u(c(j))]),_:1}),l[4]||(l[4]=d(" 下载 "))]),_:1}),u(h,{type:"primary",onClick:G},{default:t(()=>l[5]||(l[5]=[d("关闭")])),_:1})])]),default:t(()=>{var a,o,y,k;return[r("div",se,[B.value?(n(),v("div",oe,[u(i,{src:H.value,alt:null==(a=e.fileInfo)?void 0:a.fileName,fit:"contain",class:"preview-image","preview-src-list":[H.value],"initial-index":0,"preview-teleported":""},null,8,["src","alt","preview-src-list"])])):D.value?(n(),v("div",te,[r("video",{src:H.value,controls:"",class:"preview-video",preload:"metadata"}," 您的浏览器不支持视频播放 ",8,ne)])):Y.value?(n(),v("div",re,[r("div",ue,[u(s,{size:"48",color:"#409EFF"},{default:t(()=>[u(c(z))]),_:1}),r("h3",null,p(null==(o=e.fileInfo)?void 0:o.fileName),1)]),r("audio",{src:H.value,controls:"",class:"preview-audio",preload:"metadata"}," 您的浏览器不支持音频播放 ",8,ce)])):R.value?(n(),v("div",de,[r("iframe",{src:H.value,class:"preview-iframe",frameborder:"0"},[l[1]||(l[1]=d(" 您的浏览器不支持PDF预览，请")),r("a",{href:H.value,target:"_blank"},"点击下载",8,pe)],8,ve)])):F.value?(n(),v("div",fe,[u(w,{height:"500px"},{default:t(()=>[r("pre",me,p(_.value),1)]),_:1})])):P.value?(n(),v("div",ge,[r("div",we,[r("iframe",{src:`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(H.value)}`,class:"preview-iframe",frameborder:"0"}," 文档预览加载中... ",8,he)])])):S.value?(n(),v("div",ye,[u(w,{height:"500px"},{default:t(()=>[r("pre",null,[r("code",{class:f(E()),innerHTML:x.value},null,10,ke)])]),_:1})])):(n(),v("div",be,[r("div",_e,[u(s,{size:"64",color:"#909399"},{default:t(()=>[u(c(I))]),_:1}),l[3]||(l[3]=r("h3",null,"暂不支持此文件类型的预览",-1)),r("p",null,"文件名: "+p(null==(y=e.fileInfo)?void 0:y.fileName),1),r("p",null,"文件大小: "+p(O(null==(k=e.fileInfo)?void 0:k.size)),1),u(h,{type:"primary",onClick:q},{default:t(()=>[u(s,null,{default:t(()=>[u(c(j))]),_:1}),l[2]||(l[2]=d(" 下载文件 "))]),_:1})])])),b.value?m((n(),v("div",xe,null,512)),[[T,b.value]]):g("",!0)])]}),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-0f36186f"]]),ze={class:"page-container"},Ie={class:"card-header"},Ve={class:"header-left"},Ne={class:"header-right"},Ue={class:"search-filter-section"},Le={class:"filter-stats"},Me={class:"stats-text"},Te={style:{display:"flex","align-items":"center",gap:"8px"}},$e={class:"file-type-icon"},Be={key:2},De=["onClick"],Ye={class:"file-info"},Re={class:"file-type-icon mobile-file-icon"},Fe={class:"file-name-container"},Pe={class:"file-name-mobile"},Se={class:"file-meta"},He={class:"file-actions"},Ee={class:"batch-actions"},Oe={class:"dialog-footer"},Ke=e(l({__name:"FileList",setup(e){const l=i([]),s=i(!1),w=i(1),z=i(10),I=i(0),V=i(!1),U=i([]),ie=i(!1),se=i(null),oe=i(!1),te=i(null),ne=i(""),re=i(""),ue=i(null),ce=()=>{ie.value=window.innerWidth<768},de={document:["pdf","doc","docx","txt","rtf","odt","pages"],image:["jpg","jpeg","png","gif","bmp","svg","webp","ico","tiff","raw"],audio:["mp3","wav","flac","aac","ogg","m4a","wma"],video:["mp4","avi","mkv","mov","wmv","flv","webm","m4v"],archive:["zip","rar","7z","tar","gz","bz2","xz"],code:["js","ts","html","css","scss","less","vue","jsx","tsx","py","java","cpp","c","php","rb","go","rs","swift","kt"],spreadsheet:["xls","xlsx","csv","ods","numbers"],design:["psd","ai","sketch","fig","xd","indd"]},ve={document:"📄",image:"🖼️",audio:"🎵",video:"🎬",archive:"📦",code:"💻",spreadsheet:"📊",design:"🎨",other:"📋"},pe={document:"文档",image:"图片",audio:"音频",video:"视频",archive:"压缩包",code:"代码",spreadsheet:"表格",design:"设计",other:"其他"},fe=e=>{const l=(e=>{const l=e.lastIndexOf(".");return l>0?e.substring(l+1).toLowerCase():""})(e);for(const[a,i]of Object.entries(de))if(i.includes(l))return a;return"other"},me=e=>{const l=fe(e);return ve[l]||ve.other},ge=e=>{const l=fe(e);return pe[l]||pe.other},we=a(()=>{let e=[...l.value];if(ne.value.trim()){const l=ne.value.toLowerCase().trim();e=e.filter(e=>e.fileName.toLowerCase().includes(l))}if(re.value&&(e=e.filter(e=>fe(e.fileName)===re.value)),ue.value&&ue.value[0]&&ue.value[1]){const l=new Date(ue.value[0]).getTime()/1e3,a=new Date(ue.value[1]).getTime()/1e3+86400;e=e.filter(e=>e.uploadTime>=l&&e.uploadTime<a)}return e}),he=a(()=>!!(ne.value.trim()||re.value||ue.value)),ye=()=>{},ke=()=>{},be=()=>{},_e=()=>{ne.value="",re.value="",ue.value=null},xe=e=>U.value.some(l=>l.fileId===e.fileId),Ce=e=>{xe(e)?U.value=U.value.filter(l=>l.fileId!==e.fileId):U.value.push(e)},Ke=async()=>{var e,a;s.value=!0;try{const i=await x.get(`/fileList?page=${w.value}&size=${z.value}`);if(1===(null==(e=i.data)?void 0:e.code)){const e=i.data.data;l.value=e.records||[],I.value=e.total||0}else T.error((null==(a=i.data)?void 0:a.msg)||"获取文件列表失败")}catch(i){T.error("获取文件列表失败，请检查网络")}finally{s.value=!1}},qe=e=>{U.value=e},Ge=(e,l)=>{navigator.clipboard.writeText(e).then(()=>{T.success(l)}).catch(e=>{T.error("复制失败: "+e)})},Qe=()=>{const e=U.value.map(e=>`[${e.fileName}](${e.downloadUrl})`).join("\n");Ge(e,`已批量复制 ${U.value.length} 个 Markdown 链接`)},We=()=>{const e=U.value.map(e=>e.downloadUrl).join("\n");Ge(e,`已批量复制 ${U.value.length} 个下载链接`)},Je=async()=>{var e,l;if(0!==U.value.length)try{await H.confirm(`确定要删除选中的 ${U.value.length} 个文件吗？此操作不可撤销。`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const e=U.value.map(e=>x.delete(`/file/${e.fileId}`)),l=await Promise.allSettled(e);let a=0,i=0;l.forEach((e,l)=>{"fulfilled"===e.status&&1===e.value.data.code?a++:i++}),a>0&&T.success(`成功删除 ${a} 个文件`),i>0&&T.error(`${i} 个文件删除失败`),U.value=[],Ke()}catch(a){"cancel"!==a&&T.error("批量删除失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.msg)||a.message))}else T.warning("请先选择要删除的文件")},Xe=e=>new Date(1e3*e).toLocaleString("zh-CN",{hour12:!1}),Ze=()=>{V.value=!0},Ae=async()=>{var e,l;V.value=!1;const a=T({message:"正在更新...",type:"info",duration:0});try{const a=await x.put("/file-url");1===(null==(e=a.data)?void 0:e.code)?(T.success("URL 更新成功"),Ke()):T.error((null==(l=a.data)?void 0:l.msg)||"URL 更新失败")}catch(i){T.error("更新失败，请检查网络")}finally{a.close()}},el=e=>{w.value=e,U.value=[],Ke(),ie.value&&se.value&&(se.value.scrollTop=0)},ll=e=>{z.value=e,w.value=1,U.value=[],Ke()},al=e=>{Ge(`[${e.fileName}](${e.downloadUrl})`,"Markdown 格式已复制")},il=e=>{Ge(e.downloadUrl,"下载链接已复制")},sl=e=>{window.open(e,"_blank")},ol=e=>{te.value=e,oe.value=!0},tl=e=>{sl(e.downloadUrl)},nl=async e=>{var l,a;try{await H.confirm(`确定要删除文件 "${e.fileName}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const l=await x.delete(`/file/${e.fileId}`);1===l.data.code?(T.success("文件删除成功"),U.value=U.value.filter(l=>l.fileId!==e.fileId),Ke()):T.error(l.data.msg||"删除失败")}catch(i){"cancel"!==i&&T.error("删除文件失败: "+((null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||i.message))}};return h(()=>{ce(),window.addEventListener("resize",ce),Ke()}),y(()=>{window.removeEventListener("resize",ce)}),(e,l)=>{const a=N,i=L,h=E,y=O,x=K,T=q,H=G,ce=Q,de=W,ve=J,pe=X,Ke=Z,Ge=A,rl=ae,ul=ee,cl=$,dl=C,vl=M;return n(),v("div",ze,[u(cl,{class:"content-card"},{header:t(()=>[r("div",Ie,[r("div",Ve,[u(a,null,{default:t(()=>[u(c(B))]),_:1}),l[9]||(l[9]=r("span",null,"文件列表",-1))]),r("div",Ne,[u(i,{type:"primary",onClick:Ze,icon:c(D)},{default:t(()=>l[10]||(l[10]=[d("更新 URL 前缀")])),_:1},8,["icon"])])])]),default:t(()=>[r("div",Ue,[u(ce,{gutter:16,class:"search-row"},{default:t(()=>[u(y,{xs:24,sm:12,md:8,lg:6},{default:t(()=>[u(h,{modelValue:ne.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ne.value=e),placeholder:"搜索文件名...","prefix-icon":c(Y),clearable:"",onInput:ye,class:"search-input"},null,8,["modelValue","prefix-icon"])]),_:1}),u(y,{xs:24,sm:12,md:8,lg:6},{default:t(()=>[u(T,{modelValue:re.value,"onUpdate:modelValue":l[1]||(l[1]=e=>re.value=e),placeholder:"文件类型",clearable:"",onChange:ke,class:"type-filter"},{default:t(()=>[u(x,{label:"全部类型",value:""}),u(x,{label:"📄 文档",value:"document"}),u(x,{label:"🖼️ 图片",value:"image"}),u(x,{label:"🎵 音频",value:"audio"}),u(x,{label:"🎬 视频",value:"video"}),u(x,{label:"📦 压缩包",value:"archive"}),u(x,{label:"💻 代码",value:"code"}),u(x,{label:"📊 表格",value:"spreadsheet"}),u(x,{label:"🎨 设计",value:"design"}),u(x,{label:"📋 其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),u(y,{xs:24,sm:12,md:8,lg:6},{default:t(()=>[u(H,{modelValue:ue.value,"onUpdate:modelValue":l[2]||(l[2]=e=>ue.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:be,class:"date-filter"},null,8,["modelValue"])]),_:1}),u(y,{xs:24,sm:12,md:8,lg:6},{default:t(()=>[r("div",Le,[r("span",Me,"共 "+p(we.value.length)+" 个文件",1),he.value?(n(),o(i,{key:0,type:"info",size:"small",onClick:_e,plain:""},{default:t(()=>l[11]||(l[11]=[d(" 清除筛选 ")])),_:1})):g("",!0)])]),_:1})]),_:1})]),ie.value?g("",!0):m((n(),o(Ke,{key:0,data:we.value,onSelectionChange:qe,height:"calc(100vh - 280px)",style:{width:"100%"}},{default:t(()=>[u(de,{type:"selection",width:"55",align:"center"}),u(de,{prop:"fileName",label:"文件名","min-width":"200","show-overflow-tooltip":"",fixed:"left"},{default:t(e=>[r("div",Te,[r("span",$e,p(me(e.row.fileName)),1),r("span",null,p(e.row.fileName),1),"other"!==fe(e.row.fileName)?(n(),o(ve,{key:0,size:"small",class:"file-category-tag"},{default:t(()=>[d(p(ge(e.row.fileName)),1)]),_:2},1024)):g("",!0)])]),_:1}),u(de,{prop:"size",label:"大小",width:"120",align:"center"}),u(de,{prop:"uploadTime",label:"上传时间",width:"180",align:"center"},{default:t(e=>[d(p(Xe(e.row.uploadTime)),1)]),_:1}),u(de,{label:"操作",width:"480",align:"center",fixed:"right"},{default:t(e=>[u(pe,null,{default:t(()=>[u(i,{type:"info",size:"small",onClick:l=>ol(e.row),icon:c(R)},{default:t(()=>l[12]||(l[12]=[d("预览")])),_:2},1032,["onClick","icon"]),u(i,{type:"primary",size:"small",onClick:l=>al(e.row),icon:c(F)},{default:t(()=>l[13]||(l[13]=[d("Markdown")])),_:2},1032,["onClick","icon"]),u(i,{type:"success",size:"small",onClick:l=>il(e.row),icon:c(P)},{default:t(()=>l[14]||(l[14]=[d("链接")])),_:2},1032,["onClick","icon"]),u(i,{type:"warning",size:"small",onClick:l=>sl(e.row.downloadUrl),icon:c(j)},{default:t(()=>l[15]||(l[15]=[d("下载")])),_:2},1032,["onClick","icon"]),u(i,{type:"danger",size:"small",onClick:l=>nl(e.row),icon:c(S)},{default:t(()=>l[16]||(l[16]=[d("删除")])),_:2},1032,["onClick","icon"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[vl,s.value]]),ie.value?(n(),v("div",{key:1,class:"mobile-file-list",ref_key:"mobileListRef",ref:se},[0!==we.value.length||s.value?g("",!0):(n(),o(Ge,{key:0,description:he.value?"没有符合条件的文件":"暂无文件"},null,8,["description"])),s.value?(n(),o(rl,{key:1,rows:5,animated:""})):(n(),v("div",Be,[(n(!0),v(k,null,b(we.value,e=>(n(),v("div",{key:e.fileId,class:f(["mobile-file-item",{"is-selected":xe(e)}]),onClick:l=>Ce(e)},[r("div",Ye,[u(c(le),{"model-value":xe(e),onChange:()=>Ce(e),onClick:l[3]||(l[3]=_(()=>{},["stop"])),size:"large",class:"mobile-checkbox"},null,8,["model-value","onChange"]),r("span",Re,p(me(e.fileName)),1),r("div",Fe,[r("span",Pe,p(e.fileName),1),"other"!==fe(e.fileName)?(n(),o(ve,{key:0,size:"small",class:"file-category-tag mobile-tag"},{default:t(()=>[d(p(ge(e.fileName)),1)]),_:2},1024)):g("",!0)])]),r("div",Se,[r("span",null,"大小: "+p(e.size),1),r("span",null,"上传时间: "+p(Xe(e.uploadTime)),1)]),r("div",He,[u(pe,null,{default:t(()=>[u(i,{type:"info",size:"small",onClick:_(l=>ol(e),["stop"]),icon:c(R),circle:""},null,8,["onClick","icon"]),u(i,{type:"primary",size:"small",onClick:_(l=>al(e),["stop"]),icon:c(F),circle:""},null,8,["onClick","icon"]),u(i,{type:"success",size:"small",onClick:_(l=>il(e),["stop"]),icon:c(P),circle:""},null,8,["onClick","icon"]),u(i,{type:"warning",size:"small",onClick:_(l=>sl(e.downloadUrl),["stop"]),icon:c(j),circle:""},null,8,["onClick","icon"]),u(i,{type:"danger",size:"small",onClick:_(l=>nl(e),["stop"]),icon:c(S),circle:""},null,8,["onClick","icon"])]),_:2},1024)])],10,De))),128))]))],512)):g("",!0),r("div",{class:f(["footer-toolbar",{"is-mobile":ie.value}])},[r("div",Ee,[u(i,{type:"primary",onClick:Qe,disabled:0===U.value.length,icon:c(F),plain:""},{default:t(()=>l[17]||(l[17]=[d(" 批量复制 (MD) ")])),_:1},8,["disabled","icon"]),u(i,{type:"success",onClick:We,disabled:0===U.value.length,icon:c(P),plain:""},{default:t(()=>l[18]||(l[18]=[d(" 批量复制 (链接) ")])),_:1},8,["disabled","icon"]),u(i,{type:"danger",onClick:Je,disabled:0===U.value.length,icon:c(S),plain:""},{default:t(()=>[d(" 批量删除 ("+p(U.value.length)+") ",1)]),_:1},8,["disabled","icon"])]),I.value>0?(n(),o(ul,{key:0,"current-page":w.value,"onUpdate:currentPage":l[4]||(l[4]=e=>w.value=e),"page-size":z.value,"onUpdate:pageSize":l[5]||(l[5]=e=>z.value=e),total:I.value,"page-sizes":[10,20,50,100],layout:ie.value?"sizes, prev, pager, next":"total, sizes, prev, pager, next, jumper",onSizeChange:ll,onCurrentChange:el,background:"",small:""},null,8,["current-page","page-size","total","layout"])):g("",!0)],2)]),_:1}),u(dl,{modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=e=>V.value=e),title:"更新 URL 前缀",width:"500px"},{footer:t(()=>[r("span",Oe,[u(i,{onClick:l[6]||(l[6]=e=>V.value=!1)},{default:t(()=>l[19]||(l[19]=[d("取消")])),_:1}),u(i,{type:"primary",onClick:Ae},{default:t(()=>l[20]||(l[20]=[d("确认更新")])),_:1})])]),default:t(()=>[l[21]||(l[21]=r("span",null," 此操作将根据服务器最新配置，更新所有文件的下载链接前缀。当您更换了域名或IP地址后，可以使用此功能。 ",-1))]),_:1},8,["modelValue"]),u(je,{modelValue:oe.value,"onUpdate:modelValue":l[8]||(l[8]=e=>oe.value=e),"file-info":te.value,onDownload:tl},null,8,["modelValue","file-info"])])}}}),[["__scopeId","data-v-68b26a5b"]]);export{Ke as default};
