import{_ as e}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                *//* empty css                 *//* empty css                     *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                  */import{i as a,aF as l,a as o,y as t,U as s,A as d,d as n,e as r,aG as i,aH as u,aI as c,f as m,B as p,aJ as g,z as f,aK as b}from"./element-plus-Kv_AC7qh.js";import{s as y}from"./request-DEbmt4v_.js";import{d as h,b as v,W as _,f as k,c as w,Q as V,I as U,o as x,a as j,H as S,u as O,O as I,S as E,P as B}from"./vue-vendor-uyOI1CZy.js";import"./vendor-DlW7-jsh.js";const C={class:"misc-settings-container"},z={class:"background-settings"},P={class:"upload-section"},G=["src"],T={class:"opacity-value"},W={class:"seo-settings"},q=e(h({__name:"MiscSettingsPage",setup(e){const h=v("background"),q=v(!1),A=_({enabled:!1,imageUrl:"",mode:"cover",opacity:80}),M=_({title:"",description:"",keywords:"",author:"",favicon:"",ogImage:""}),R={Authorization:`Bearer ${localStorage.getItem("token")}`},$=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<5;return a?!!l||(o.error("图片大小不能超过 5MB!"),!1):(o.error("只能上传图片文件!"),!1)},H=e=>{if(1===e.code){let a=e.data.url;a.startsWith("/")&&(a=window.location.origin+a),A.imageUrl=a,o.success("背景图片上传成功")}else o.error(e.msg||"上传失败")},J=async()=>{q.value=!0;try{const e=await y.post("/misc/background",A);1===e.data.code?(o.success("背景设置保存成功"),K(),window.dispatchEvent(new CustomEvent("backgroundSettingsUpdated",{detail:A}))):o.error(e.data.msg||"保存失败")}catch(e){o.error("保存失败")}finally{q.value=!1}},L=async()=>{q.value=!0;try{const e=await y.post("/misc/seo",M);1===e.data.code?o.success("SEO设置保存成功"):o.error(e.data.msg||"保存失败")}catch(e){o.error("保存失败")}finally{q.value=!1}},N=()=>{t.confirm("确定要重置背景设置吗？","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A.enabled=!1,A.imageUrl="",A.mode="cover",A.opacity=80,o.success("背景设置已重置")})},F=()=>{t.confirm("确定要重置SEO设置吗？","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{M.title="",M.description="",M.keywords="",M.author="",M.favicon="",M.ogImage="",o.success("SEO设置已重置")})},K=()=>{const e=document.body;if(A.enabled&&A.imageUrl){e.style.backgroundImage=`url(${A.imageUrl})`,e.style.backgroundSize=A.mode,e.style.backgroundRepeat="repeat"===A.mode?"repeat":"no-repeat",e.style.backgroundPosition="center",e.style.backgroundAttachment="fixed"===A.mode?"fixed":"scroll";const a=document.querySelector(".background-overlay");if(a)a.style.opacity=""+(100-A.opacity)/100;else{const a=document.createElement("div");a.className="background-overlay",a.style.cssText=`\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: var(--el-bg-color);\n        opacity: ${(100-A.opacity)/100};\n        pointer-events: none;\n        z-index: -1;\n      `,e.appendChild(a)}}else{e.style.backgroundImage="";const a=document.querySelector(".background-overlay");a&&a.remove()}};return k(()=>{(async()=>{try{const e=await y.get("/misc/settings");if(1===e.data.code){const{background:a,seo:l}=e.data.data;a&&(Object.assign(A,a),A.imageUrl&&A.imageUrl.startsWith("/")&&(A.imageUrl=window.location.origin+A.imageUrl)),l&&Object.assign(M,l)}}catch(e){}})()}),(e,o)=>{const t=s,y=d,v=n,_=r,k=i,K=u,Q=c,D=m,X=p,Y=g,Z=f,ee=b,ae=a;return x(),w("div",C,[V(ae,{class:"settings-card"},{header:U(()=>o[10]||(o[10]=[j("div",{class:"card-header"},[j("h2",null,"杂项管理"),j("p",null,"管理网站背景图片和SEO设置")],-1)])),default:U(()=>[V(ee,{modelValue:h.value,"onUpdate:modelValue":o[9]||(o[9]=e=>h.value=e),class:"settings-tabs"},{default:U(()=>[V(Y,{label:"背景图片",name:"background"},{default:U(()=>[j("div",z,[V(X,{model:A,"label-width":"120px"},{default:U(()=>[V(y,{label:"启用背景图"},{default:U(()=>[V(t,{modelValue:A.enabled,"onUpdate:modelValue":o[0]||(o[0]=e=>A.enabled=e)},null,8,["modelValue"])]),_:1}),A.enabled?(x(),S(y,{key:0,label:"背景图片"},{default:U(()=>[j("div",P,[V(_,{class:"background-uploader",action:"/misc/upload-background",headers:R,"show-file-list":!1,"on-success":H,"before-upload":$,accept:"image/*"},{default:U(()=>[A.imageUrl?(x(),w("img",{key:0,src:A.imageUrl,class:"background-preview"},null,8,G)):(x(),S(v,{key:1,class:"background-uploader-icon"},{default:U(()=>[V(O(l))]),_:1}))]),_:1}),o[11]||(o[11]=j("div",{class:"upload-tips"},[j("p",null,"建议尺寸：1920x1080 或更高"),j("p",null,"支持格式：JPG、PNG、WebP"),j("p",null,"文件大小：不超过5MB")],-1))])]),_:1})):I("",!0),A.enabled?(x(),S(y,{key:1,label:"背景模式"},{default:U(()=>[V(K,{modelValue:A.mode,"onUpdate:modelValue":o[1]||(o[1]=e=>A.mode=e)},{default:U(()=>[V(k,{value:"cover"},{default:U(()=>o[12]||(o[12]=[E("覆盖")])),_:1}),V(k,{value:"contain"},{default:U(()=>o[13]||(o[13]=[E("包含")])),_:1}),V(k,{value:"repeat"},{default:U(()=>o[14]||(o[14]=[E("重复")])),_:1}),V(k,{value:"fixed"},{default:U(()=>o[15]||(o[15]=[E("固定")])),_:1})]),_:1},8,["modelValue"])]),_:1})):I("",!0),A.enabled?(x(),S(y,{key:2,label:"透明度"},{default:U(()=>[V(Q,{modelValue:A.opacity,"onUpdate:modelValue":o[2]||(o[2]=e=>A.opacity=e),min:10,max:100,step:5,"show-stops":""},null,8,["modelValue"]),j("span",T,B(A.opacity)+"%",1)]),_:1})):I("",!0),V(y,null,{default:U(()=>[V(D,{type:"primary",onClick:J,loading:q.value},{default:U(()=>o[16]||(o[16]=[E("保存背景设置")])),_:1},8,["loading"]),V(D,{onClick:N},{default:U(()=>o[17]||(o[17]=[E("重置")])),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),V(Y,{label:"SEO设置",name:"seo"},{default:U(()=>[j("div",W,[V(X,{model:M,"label-width":"120px"},{default:U(()=>[V(y,{label:"网站标题"},{default:U(()=>[V(Z,{modelValue:M.title,"onUpdate:modelValue":o[3]||(o[3]=e=>M.title=e),placeholder:"请输入网站标题",maxlength:"60","show-word-limit":""},null,8,["modelValue"])]),_:1}),V(y,{label:"网站描述"},{default:U(()=>[V(Z,{modelValue:M.description,"onUpdate:modelValue":o[4]||(o[4]=e=>M.description=e),type:"textarea",rows:3,placeholder:"请输入网站描述",maxlength:"160","show-word-limit":""},null,8,["modelValue"])]),_:1}),V(y,{label:"关键词"},{default:U(()=>[V(Z,{modelValue:M.keywords,"onUpdate:modelValue":o[5]||(o[5]=e=>M.keywords=e),type:"textarea",rows:2,placeholder:"请输入关键词，用英文逗号分隔",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),V(y,{label:"作者"},{default:U(()=>[V(Z,{modelValue:M.author,"onUpdate:modelValue":o[6]||(o[6]=e=>M.author=e),placeholder:"请输入作者信息",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),V(y,{label:"网站图标"},{default:U(()=>[V(Z,{modelValue:M.favicon,"onUpdate:modelValue":o[7]||(o[7]=e=>M.favicon=e),placeholder:"请输入网站图标URL"},null,8,["modelValue"])]),_:1}),V(y,{label:"OG图片"},{default:U(()=>[V(Z,{modelValue:M.ogImage,"onUpdate:modelValue":o[8]||(o[8]=e=>M.ogImage=e),placeholder:"请输入Open Graph图片URL"},null,8,["modelValue"])]),_:1}),V(y,null,{default:U(()=>[V(D,{type:"primary",onClick:L,loading:q.value},{default:U(()=>o[18]||(o[18]=[E("保存SEO设置")])),_:1},8,["loading"]),V(D,{onClick:F},{default:U(()=>o[19]||(o[19]=[E("重置")])),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),[["__scopeId","data-v-74c2493e"]]);export{q as default};
