import{_ as e}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                   *//* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css                  *//* empty css                 */import{d as l,j as a,r as i,w as o,G as s,H as t,o as n,a as u,P as r,u as c,R as d,c as v,O as p,K as f,I as m,M as g,n as w,f as y,y as h,ah as k,Q as C,aa as _,$ as b}from"./vue-vendor-B9yd_xiB.js";import{s as x}from"./request-BlLXdTX7.js";import{I,J as j,K as z,l as U,L as V,d as $,M as L,f as N,N as B,a as M,i as P,O as T,P as R,Q as S,v as F,R as D,m as E,S as H,y as K,z as q,T as G,U as O,V as Q,W,X as J,Y as X,k as Y,Z}from"./element-plus-B6Syq966.js";import{H as A}from"./vendor-DO3eE842.js";const ee={class:"preview-container"},le={key:0,class:"image-preview"},ae={key:1,class:"video-preview"},ie=["src"],oe={key:2,class:"audio-preview"},se={class:"audio-info"},te=["src"],ne={key:3,class:"pdf-preview"},ue=["src"],re=["href"],ce={key:4,class:"text-preview"},de={class:"text-content"},ve={key:5,class:"office-preview"},pe={class:"office-viewer"},fe=["src"],me={key:6,class:"code-preview"},ge=["innerHTML"],we={key:7,class:"unsupported-preview"},ye={class:"unsupported-content"},he={key:8,"element-loading-text":"加载中...",class:"loading-overlay"},ke={class:"dialog-footer"},Ce=e(l({__name:"FilePreview",props:{modelValue:{type:Boolean},fileInfo:{}},emits:["update:modelValue","download"],setup(e,{emit:l}){const y=e,h=l,k=a({get:()=>y.modelValue,set:e=>h("update:modelValue",e)}),C=i(!1),_=i(""),b=i(""),x=a(()=>{var e,l;return(null==(e=y.fileInfo)?void 0:e.fileName)&&(null==(l=y.fileInfo.fileName.split(".").pop())?void 0:l.toLowerCase())||""}),P=a(()=>["jpg","jpeg","png","gif","bmp","webp","svg"].includes(x.value)),T=a(()=>["mp4","avi","mov","wmv","flv","webm","mkv"].includes(x.value)),R=a(()=>["mp3","wav","flac","aac","ogg","m4a"].includes(x.value)),S=a(()=>"pdf"===x.value),F=a(()=>["txt","md","json","xml","csv","log"].includes(x.value)),D=a(()=>["doc","docx","xls","xlsx","ppt","pptx"].includes(x.value)),E=a(()=>["js","ts","vue","html","css","scss","less","java","py","cpp","c","go","rs","php","rb","swift","kt"].includes(x.value)),H=a(()=>{var e;return(null==(e=y.fileInfo)?void 0:e.downloadUrl)||""}),K=()=>({js:"javascript",ts:"typescript",vue:"vue",html:"html",css:"css",scss:"scss",less:"less",java:"java",py:"python",cpp:"cpp",c:"c",go:"go",rs:"rust",php:"php",rb:"ruby",swift:"swift",kt:"kotlin"}[x.value]||"plaintext"),q=e=>{const l="string"==typeof e?parseInt(e):e;if(0===l)return"0 B";const a=Math.floor(Math.log(l)/Math.log(1024));return parseFloat((l/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB","TB"][a]},G=async()=>{if(y.fileInfo&&(F.value||E.value)){C.value=!0;try{const e=await fetch(H.value),l=await e.text();if(E.value){const e=A.highlight(l,{language:K()});b.value=e.value}else _.value=l}catch(e){M.error("加载文件内容失败")}finally{C.value=!1}}},O=()=>{y.fileInfo&&h("download",y.fileInfo)},Q=()=>{k.value=!1,_.value="",b.value=""};return o(()=>y.fileInfo,async e=>{e&&k.value&&(await w(),(F.value||E.value)&&G())},{immediate:!0}),o(k,async e=>{e&&y.fileInfo&&(await w(),(F.value||E.value)&&G())}),(e,l)=>{var a;const i=V,o=$,w=L,y=N,h=I,x=B;return n(),s(h,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=e=>k.value=e),title:(null==(a=e.fileInfo)?void 0:a.fileName)||"文件预览",width:"80%","before-close":Q,class:"file-preview-dialog"},{footer:t(()=>[u("div",ke,[r(y,{onClick:O},{default:t(()=>[r(o,null,{default:t(()=>[r(c(j))]),_:1}),l[4]||(l[4]=d(" 下载 "))]),_:1}),r(y,{type:"primary",onClick:Q},{default:t(()=>l[5]||(l[5]=[d("关闭")])),_:1})])]),default:t(()=>{var a,s,h,k;return[u("div",ee,[P.value?(n(),v("div",le,[r(i,{src:H.value,alt:null==(a=e.fileInfo)?void 0:a.fileName,fit:"contain",class:"preview-image","preview-src-list":[H.value],"initial-index":0,"preview-teleported":""},null,8,["src","alt","preview-src-list"])])):T.value?(n(),v("div",ae,[u("video",{src:H.value,controls:"",class:"preview-video",preload:"metadata"}," 您的浏览器不支持视频播放 ",8,ie)])):R.value?(n(),v("div",oe,[u("div",se,[r(o,{size:"48",color:"#409EFF"},{default:t(()=>[r(c(z))]),_:1}),u("h3",null,p(null==(s=e.fileInfo)?void 0:s.fileName),1)]),u("audio",{src:H.value,controls:"",class:"preview-audio",preload:"metadata"}," 您的浏览器不支持音频播放 ",8,te)])):S.value?(n(),v("div",ne,[u("iframe",{src:H.value,class:"preview-iframe",frameborder:"0"},[l[1]||(l[1]=d(" 您的浏览器不支持PDF预览，请")),u("a",{href:H.value,target:"_blank"},"点击下载",8,re)],8,ue)])):F.value?(n(),v("div",ce,[r(w,{height:"500px"},{default:t(()=>[u("pre",de,p(_.value),1)]),_:1})])):D.value?(n(),v("div",ve,[u("div",pe,[u("iframe",{src:`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(H.value)}`,class:"preview-iframe",frameborder:"0"}," 文档预览加载中... ",8,fe)])])):E.value?(n(),v("div",me,[r(w,{height:"500px"},{default:t(()=>[u("pre",null,[u("code",{class:f(K()),innerHTML:b.value},null,10,ge)])]),_:1})])):(n(),v("div",we,[u("div",ye,[r(o,{size:"64",color:"#909399"},{default:t(()=>[r(c(U))]),_:1}),l[3]||(l[3]=u("h3",null,"暂不支持此文件类型的预览",-1)),u("p",null,"文件名: "+p(null==(h=e.fileInfo)?void 0:h.fileName),1),u("p",null,"文件大小: "+p(q(null==(k=e.fileInfo)?void 0:k.size)),1),r(y,{type:"primary",onClick:O},{default:t(()=>[r(o,null,{default:t(()=>[r(c(j))]),_:1}),l[2]||(l[2]=d(" 下载文件 "))]),_:1})])])),C.value?m((n(),v("div",he,null,512)),[[x,C.value]]):g("",!0)])]}),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-0f36186f"]]),_e={class:"page-container"},be={class:"card-header"},xe={class:"header-left"},Ie={class:"header-right"},je={style:{display:"flex","align-items":"center",gap:"8px"}},ze={key:2},Ue=["onClick"],Ve={class:"file-info"},$e={class:"file-name-mobile"},Le={class:"file-meta"},Ne={key:0,class:"file-public"},Be={class:"file-actions"},Me={class:"batch-actions"},Pe={class:"dialog-footer"},Te=e(l({__name:"FileList",setup(e){const l=i([]),a=i(!1),o=i(1),w=i(10),z=i(0),V=i(!1),L=i([]),A=i(!1),ee=i(null),le=i(!1),ae=i(null),ie=i(""),oe=()=>{A.value=window.innerWidth<768},se=e=>L.value.some(l=>l.fileId===e.fileId),te=e=>{se(e)?L.value=L.value.filter(l=>l.fileId!==e.fileId):L.value.push(e)},ne=async()=>{var e,i;a.value=!0;try{let a=`/fileList?page=${o.value}&size=${w.value}`;ie.value&&(a+=`&keyword=${encodeURIComponent(ie.value)}`);const s=await x.get(a);if(1===(null==(e=s.data)?void 0:e.code)){const e=s.data.data;l.value=e.records||[],z.value=e.total||0}else M.error((null==(i=s.data)?void 0:i.msg)||"获取文件列表失败")}catch(s){M.error("获取文件列表失败，请检查网络")}finally{a.value=!1}},ue=e=>{L.value=e},re=(e,l)=>{navigator.clipboard.writeText(e).then(()=>{M.success(l)}).catch(e=>{M.error("复制失败: "+e)})},ce=()=>{const e=L.value.map(e=>`[${e.fileName}](${e.downloadUrl})`).join("\n");re(e,`已批量复制 ${L.value.length} 个 Markdown 链接`)},de=()=>{const e=L.value.map(e=>e.downloadUrl).join("\n");re(e,`已批量复制 ${L.value.length} 个下载链接`)},ve=async()=>{var e,l;if(0!==L.value.length)try{await K.confirm(`确定要删除选中的 ${L.value.length} 个文件吗？此操作不可撤销。`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const e=L.value.map(e=>x.delete(`/file/${e.fileId}`)),l=await Promise.allSettled(e);let a=0,i=0;l.forEach((e,l)=>{"fulfilled"===e.status&&1===e.value.data.code?a++:i++}),a>0&&M.success(`成功删除 ${a} 个文件`),i>0&&M.error(`${i} 个文件删除失败`),L.value=[],ne()}catch(a){"cancel"!==a&&M.error("批量删除失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.msg)||a.message))}else M.warning("请先选择要删除的文件")},pe=e=>new Date(1e3*e).toLocaleString("zh-CN",{hour12:!1}),fe=()=>{V.value=!0},me=async()=>{var e,l;V.value=!1;const a=M({message:"正在更新...",type:"info",duration:0});try{const a=await x.put("/file-url");1===(null==(e=a.data)?void 0:e.code)?(M.success("URL 更新成功"),ne()):M.error((null==(l=a.data)?void 0:l.msg)||"URL 更新失败")}catch(i){M.error("更新失败，请检查网络")}finally{a.close()}},ge=e=>{o.value=e,L.value=[],ne(),A.value&&ee.value&&(ee.value.scrollTop=0)},we=e=>{w.value=e,o.value=1,L.value=[],ne()},ye=e=>{re(`[${e.fileName}](${e.downloadUrl})`,"Markdown 格式已复制")},he=e=>{re(e.downloadUrl,"下载链接已复制")},ke=e=>{window.open(e,"_blank")},Te=e=>{ae.value=e,le.value=!0},Re=e=>{ke(e.downloadUrl)},Se=async e=>{var l,a;try{await K.confirm(`确定要删除文件 "${e.fileName}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const l=await x.delete(`/file/${e.fileId}`);1===l.data.code?(M.success("文件删除成功"),L.value=L.value.filter(l=>l.fileId!==e.fileId),ne()):M.error(l.data.msg||"删除失败")}catch(i){"cancel"!==i&&M.error("删除文件失败: "+((null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||i.message))}},Fe=()=>{o.value=1,ne()},De=()=>{ie.value="",o.value=1,ne()};return y(()=>{oe(),window.addEventListener("resize",oe),ne()}),h(()=>{window.removeEventListener("resize",oe)}),(e,i)=>{const y=$,h=q,x=N,M=G,K=O,oe=Q,ne=W,re=Y,Ee=Z,He=J,Ke=P,qe=I,Ge=B;return n(),v("div",_e,[r(Ke,{class:"content-card"},{header:t(()=>[u("div",be,[u("div",xe,[r(y,null,{default:t(()=>[r(c(T))]),_:1}),i[7]||(i[7]=u("span",null,"文件列表",-1))]),u("div",Ie,[r(h,{modelValue:ie.value,"onUpdate:modelValue":i[0]||(i[0]=e=>ie.value=e),placeholder:"搜索文件名",clearable:"",style:{width:"200px","margin-right":"10px"},onKeyup:k(Fe,["enter"])},null,8,["modelValue"]),r(x,{type:"primary",onClick:Fe,icon:c(R)},{default:t(()=>i[8]||(i[8]=[d("搜索")])),_:1},8,["icon"]),r(x,{type:"default",onClick:De,icon:c(S)},{default:t(()=>i[9]||(i[9]=[d("全部")])),_:1},8,["icon"]),r(x,{type:"primary",onClick:fe,icon:c(S),style:{"margin-left":"10px"}},{default:t(()=>i[10]||(i[10]=[d("更新 URL 前缀")])),_:1},8,["icon"])])])]),default:t(()=>[A.value?g("",!0):m((n(),s(ne,{key:0,data:l.value,onSelectionChange:ue,height:"calc(100vh - 280px)",style:{width:"100%"}},{default:t(()=>[r(M,{type:"selection",width:"55",align:"center"}),r(M,{prop:"fileName",label:"文件名","min-width":"200","show-overflow-tooltip":"",fixed:"left"},{default:t(e=>[u("div",je,[r(y,null,{default:t(()=>[r(c(U))]),_:1}),u("span",null,p(e.row.fileName),1)])]),_:1}),r(M,{prop:"size",label:"大小",width:"120",align:"center"}),r(M,{prop:"uploadTime",label:"上传时间",width:"180",align:"center"},{default:t(e=>[d(p(pe(e.row.uploadTime)),1)]),_:1}),r(M,{label:"公开",width:"100",align:"center"},{default:t(l=>["admin"===e.currentRole||l.row.userId===e.currentUserId?(n(),s(K,{key:0,modelValue:l.row.isPublic,"onUpdate:modelValue":e=>l.row.isPublic=e,onChange:a=>e.updatePublicStatus(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])):g("",!0)]),_:1}),r(M,{label:"操作",width:"480",align:"center",fixed:"right"},{default:t(e=>[r(oe,null,{default:t(()=>[r(x,{type:"info",size:"small",onClick:l=>Te(e.row),icon:c(F)},{default:t(()=>i[11]||(i[11]=[d("预览")])),_:2},1032,["onClick","icon"]),r(x,{type:"primary",size:"small",onClick:l=>ye(e.row),icon:c(D)},{default:t(()=>i[12]||(i[12]=[d("Markdown")])),_:2},1032,["onClick","icon"]),r(x,{type:"success",size:"small",onClick:l=>he(e.row),icon:c(E)},{default:t(()=>i[13]||(i[13]=[d("链接")])),_:2},1032,["onClick","icon"]),r(x,{type:"warning",size:"small",onClick:l=>ke(e.row.downloadUrl),icon:c(j)},{default:t(()=>i[14]||(i[14]=[d("下载")])),_:2},1032,["onClick","icon"]),r(x,{type:"danger",size:"small",onClick:l=>Se(e.row),icon:c(H)},{default:t(()=>i[15]||(i[15]=[d("删除")])),_:2},1032,["onClick","icon"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ge,a.value]]),A.value?(n(),v("div",{key:1,class:"mobile-file-list",ref_key:"mobileListRef",ref:ee},[0!==l.value.length||a.value?g("",!0):(n(),s(re,{key:0,description:"暂无文件"})),a.value?(n(),s(Ee,{key:1,rows:5,animated:""})):(n(),v("div",ze,[(n(!0),v(C,null,_(l.value,l=>(n(),v("div",{key:l.fileId,class:f(["mobile-file-item",{"is-selected":se(l)}]),onClick:e=>te(l)},[u("div",Ve,[r(c(X),{"model-value":se(l),onChange:()=>te(l),onClick:i[1]||(i[1]=b(()=>{},["stop"])),size:"large",class:"mobile-checkbox"},null,8,["model-value","onChange"]),r(y,{class:"file-icon"},{default:t(()=>[r(c(U))]),_:1}),u("span",$e,p(l.fileName),1)]),u("div",Le,[u("span",null,"大小: "+p(l.size),1),u("span",null,"上传时间: "+p(pe(l.uploadTime)),1),"admin"===e.currentRole||l.userId===e.currentUserId?(n(),v("div",Ne,[r(K,{modelValue:l.isPublic,"onUpdate:modelValue":e=>l.isPublic=e,onChange:a=>e.updatePublicStatus(l),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"]),i[16]||(i[16]=d(" 公开 "))])):g("",!0)]),u("div",Be,[r(oe,null,{default:t(()=>[r(x,{type:"info",size:"small",onClick:b(e=>Te(l),["stop"]),icon:c(F),circle:""},null,8,["onClick","icon"]),r(x,{type:"primary",size:"small",onClick:b(e=>ye(l),["stop"]),icon:c(D),circle:""},null,8,["onClick","icon"]),r(x,{type:"success",size:"small",onClick:b(e=>he(l),["stop"]),icon:c(E),circle:""},null,8,["onClick","icon"]),r(x,{type:"warning",size:"small",onClick:b(e=>ke(l.downloadUrl),["stop"]),icon:c(j),circle:""},null,8,["onClick","icon"]),r(x,{type:"danger",size:"small",onClick:b(e=>Se(l),["stop"]),icon:c(H),circle:""},null,8,["onClick","icon"])]),_:2},1024)])],10,Ue))),128))]))],512)):g("",!0),u("div",{class:f(["footer-toolbar",{"is-mobile":A.value}])},[u("div",Me,[r(x,{type:"primary",onClick:ce,disabled:0===L.value.length,icon:c(D),plain:""},{default:t(()=>i[17]||(i[17]=[d(" 批量复制 (MD) ")])),_:1},8,["disabled","icon"]),r(x,{type:"success",onClick:de,disabled:0===L.value.length,icon:c(E),plain:""},{default:t(()=>i[18]||(i[18]=[d(" 批量复制 (链接) ")])),_:1},8,["disabled","icon"]),r(x,{type:"danger",onClick:ve,disabled:0===L.value.length,icon:c(H),plain:""},{default:t(()=>[d(" 批量删除 ("+p(L.value.length)+") ",1)]),_:1},8,["disabled","icon"])]),z.value>0?(n(),s(He,{key:0,"current-page":o.value,"onUpdate:currentPage":i[2]||(i[2]=e=>o.value=e),"page-size":w.value,"onUpdate:pageSize":i[3]||(i[3]=e=>w.value=e),total:z.value,"page-sizes":[10,20,50,100],layout:A.value?"sizes, prev, pager, next":"total, sizes, prev, pager, next, jumper",onSizeChange:we,onCurrentChange:ge,background:"",small:""},null,8,["current-page","page-size","total","layout"])):g("",!0)],2)]),_:1}),r(qe,{modelValue:V.value,"onUpdate:modelValue":i[5]||(i[5]=e=>V.value=e),title:"更新 URL 前缀",width:"500px"},{footer:t(()=>[u("span",Pe,[r(x,{onClick:i[4]||(i[4]=e=>V.value=!1)},{default:t(()=>i[19]||(i[19]=[d("取消")])),_:1}),r(x,{type:"primary",onClick:me},{default:t(()=>i[20]||(i[20]=[d("确认更新")])),_:1})])]),default:t(()=>[i[21]||(i[21]=u("span",null," 此操作将根据服务器最新配置，更新所有文件的下载链接前缀。当您更换了域名或IP地址后，可以使用此功能。 ",-1))]),_:1},8,["modelValue"]),r(Ce,{modelValue:le.value,"onUpdate:modelValue":i[6]||(i[6]=e=>le.value=e),"file-info":ae.value,onDownload:Re},null,8,["modelValue","file-info"])])}}}),[["__scopeId","data-v-95d41336"]]);export{Te as default};
