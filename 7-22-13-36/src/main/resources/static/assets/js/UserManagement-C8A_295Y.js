import{_ as e}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                        *//* empty css                     *//* empty css                  *//* empty css                   *//* empty css                             *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css               *//* empty css                 */import{a,d as l,f as t,b as r,W as s,X as o,I as u,N as d,a1 as n,aH as i,P as p,v as m,ax as c,S as f,y as b,z as g,j as v,H as _,C as h,T as w,aj as V,aa as y,U as k,F as j,G as U,A as C,B as z}from"./element-plus-BpKNpHyv.js";import{s as x}from"./request-CJwrkdbI.js";import{d as P,r as S,V as T,f as q,c as I,a as $,P as L,H as B,R as H,u as A,I as D,G as O,o as R,O as E,M as F}from"./vue-vendor-B9yd_xiB.js";import"./vendor-BoV0XpOF.js";const G={class:"user-management"},M={class:"page-header"},N={class:"header-content"},W={class:"page-title"},X={class:"header-actions"},Z={class:"content-container"},J={class:"search-section"},K={class:"table-section"},Q={class:"pagination-section"},Y={key:0,class:"user-detail"},ee={class:"dialog-footer"},ae=e(P({__name:"UserManagement",setup(e){const P=S(!1),ae=S(!1),le=S([]),te=S([]),re=S(null),se=S(!1),oe=S(!1),ue=S(!1),de=S(),ne=T({keyword:"",role:"",status:"",enabled:""}),ie=T({currentPage:1,pageSize:20,total:0}),pe=T({id:null,username:"",nickname:"",email:"",phone:"",password:"",confirmPassword:"",role:"user",status:0,avatar:"",remark:"",enabled:!0}),me={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:50,message:"密码长度在 8 到 50 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==pe.password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},ce=async()=>{P.value=!0;try{const e={page:ie.currentPage,size:ie.pageSize,...ne},a=await x.get("/api/admin/users",{params:e});le.value=a.data.list||a.data,ie.total=a.data.total||le.value.length}catch(e){a.error("加载用户列表失败")}finally{P.value=!1}},fe=()=>{ie.currentPage=1,ce()},be=e=>{ie.pageSize=e,ce()},ge=e=>{ie.currentPage=e,ce()},ve=e=>{te.value=e},_e=()=>{se.value=!1,re.value=null},he=()=>{ue.value=!1,we(),oe.value=!0},we=()=>{var e;Object.assign(pe,{id:null,username:"",nickname:"",email:"",phone:"",password:"",confirmPassword:"",role:"user",status:0,avatar:"",remark:"",enabled:!0}),null==(e=de.value)||e.clearValidate()},Ve=()=>{oe.value=!1,we()},ye=async()=>{if(de.value)try{await de.value.validate(),ae.value=!0;const e={...pe};delete e.confirmPassword,ue.value?(await x.put(`/api/admin/users/${pe.id}`,e),a.success("用户更新成功")):(await x.post("/api/admin/users",e),a.success("用户创建成功")),Ve(),ce()}catch(e){a.error(ue.value?"用户更新失败":"用户创建失败")}finally{ae.value=!1}},ke=e=>["success","warning","danger"][e]||"info",je=e=>["正常","禁用","锁定"][e]||"未知",Ue=e=>e?new Date(e).toLocaleString("zh-CN"):"";return q(()=>{ce()}),(e,S)=>{const T=l,q=t,te=g,we=v,Ce=_,ze=h,xe=r,Pe=w,Se=V,Te=y,qe=k,Ie=s,$e=o,Le=j,Be=U,He=u,Ae=C,De=z,Oe=d;return R(),I("div",G,[$("div",M,[$("div",N,[$("h1",W,[L(T,null,{default:B(()=>[L(A(n))]),_:1}),S[19]||(S[19]=H(" 用户管理 "))]),S[20]||(S[20]=$("p",{class:"page-subtitle"},"管理系统中的所有用户账户",-1))]),$("div",X,[L(q,{type:"primary",onClick:he,icon:A(i)},{default:B(()=>S[21]||(S[21]=[H(" 添加用户 ")])),_:1},8,["icon"])])]),$("div",Z,[$("div",J,[L(xe,{gutter:16},{default:B(()=>[L(we,{span:8},{default:B(()=>[L(te,{modelValue:ne.keyword,"onUpdate:modelValue":S[0]||(S[0]=e=>ne.keyword=e),placeholder:"搜索用户名、邮箱或昵称","prefix-icon":A(p),clearable:"",onInput:fe},null,8,["modelValue","prefix-icon"])]),_:1}),L(we,{span:4},{default:B(()=>[L(ze,{modelValue:ne.role,"onUpdate:modelValue":S[1]||(S[1]=e=>ne.role=e),placeholder:"角色筛选",clearable:"",onChange:fe},{default:B(()=>[L(Ce,{label:"管理员",value:"admin"}),L(Ce,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),L(we,{span:4},{default:B(()=>[L(ze,{modelValue:ne.status,"onUpdate:modelValue":S[2]||(S[2]=e=>ne.status=e),placeholder:"状态筛选",clearable:"",onChange:fe},{default:B(()=>[L(Ce,{label:"正常",value:0}),L(Ce,{label:"禁用",value:1}),L(Ce,{label:"锁定",value:2})]),_:1},8,["modelValue"])]),_:1}),L(we,{span:4},{default:B(()=>[L(ze,{modelValue:ne.enabled,"onUpdate:modelValue":S[3]||(S[3]=e=>ne.enabled=e),placeholder:"启用状态",clearable:"",onChange:fe},{default:B(()=>[L(Ce,{label:"启用",value:!0}),L(Ce,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),L(we,{span:4},{default:B(()=>[L(q,{type:"primary",onClick:fe,icon:A(p)},{default:B(()=>S[22]||(S[22]=[H(" 搜索 ")])),_:1},8,["icon"])]),_:1})]),_:1})]),$("div",K,[D((R(),O(Ie,{data:le.value,stripe:"",border:"",style:{width:"100%"},onSelectionChange:ve},{default:B(()=>[L(Pe,{type:"selection",width:"55"}),L(Pe,{prop:"id",label:"ID",width:"80"}),L(Pe,{label:"头像",width:"80"},{default:B(({row:e})=>[L(Se,{size:40,src:e.avatar,icon:A(n),class:"user-avatar"},null,8,["src","icon"])]),_:1}),L(Pe,{prop:"username",label:"用户名","min-width":"120"}),L(Pe,{prop:"nickname",label:"昵称","min-width":"120"}),L(Pe,{prop:"email",label:"邮箱","min-width":"180"}),L(Pe,{prop:"phone",label:"手机号","min-width":"120"}),L(Pe,{label:"角色",width:"100"},{default:B(({row:e})=>[L(Te,{type:"admin"===e.role?"danger":"primary"},{default:B(()=>[H(E("admin"===e.role?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),L(Pe,{label:"状态",width:"100"},{default:B(({row:e})=>[L(Te,{type:ke(e.status),effect:"light"},{default:B(()=>[H(E(je(e.status)),1)]),_:2},1032,["type"])]),_:1}),L(Pe,{label:"启用状态",width:"100"},{default:B(({row:e})=>[L(qe,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a,onChange:l=>(async e=>{try{await x.put(`/api/admin/users/${e.id}/status`,{enabled:e.enabled}),a.success("状态更新成功")}catch(l){e.enabled=!e.enabled,a.error("状态更新失败")}})(e),disabled:"admin"===e.role},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),L(Pe,{prop:"createTime",label:"创建时间",width:"180"},{default:B(({row:e})=>[H(E(Ue(e.createTime)),1)]),_:1}),L(Pe,{prop:"lastLoginTime",label:"最后登录",width:"180"},{default:B(({row:e})=>[H(E(Ue(e.lastLoginTime)||"从未登录"),1)]),_:1}),L(Pe,{label:"操作",width:"200",fixed:"right"},{default:B(({row:e})=>[L(q,{type:"primary",size:"small",onClick:a=>{return l=e,re.value=l,void(se.value=!0);var l},icon:A(m)},{default:B(()=>S[23]||(S[23]=[H(" 详情 ")])),_:2},1032,["onClick","icon"]),L(q,{type:"warning",size:"small",onClick:a=>{return l=e,ue.value=!0,Object.assign(pe,{id:l.id,username:l.username,nickname:l.nickname,email:l.email,phone:l.phone,role:l.role,status:l.status,avatar:l.avatar,remark:l.remark,enabled:l.enabled,password:"",confirmPassword:""}),void(oe.value=!0);var l},icon:A(c)},{default:B(()=>S[24]||(S[24]=[H(" 编辑 ")])),_:2},1032,["onClick","icon"]),L(q,{type:"danger",size:"small",onClick:l=>(async e=>{try{await b.confirm(`确定要删除用户 "${e.username}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.delete(`/api/admin/users/${e.id}`),a.success("用户删除成功"),ce()}catch(l){"cancel"!==l&&a.error("用户删除失败")}})(e),disabled:"admin"===e.role,icon:A(f)},{default:B(()=>S[25]||(S[25]=[H(" 删除 ")])),_:2},1032,["onClick","disabled","icon"])]),_:1})]),_:1},8,["data"])),[[Oe,P.value]]),$("div",Q,[L($e,{"current-page":ie.currentPage,"onUpdate:currentPage":S[4]||(S[4]=e=>ie.currentPage=e),"page-size":ie.pageSize,"onUpdate:pageSize":S[5]||(S[5]=e=>ie.pageSize=e),"page-sizes":[10,20,50,100],total:ie.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:be,onCurrentChange:ge},null,8,["current-page","page-size","total"])])])]),L(He,{modelValue:se.value,"onUpdate:modelValue":S[6]||(S[6]=e=>se.value=e),title:"用户详情",width:"600px","before-close":_e},{default:B(()=>[re.value?(R(),I("div",Y,[L(Be,{column:2,border:""},{default:B(()=>[L(Le,{label:"头像"},{default:B(()=>[L(Se,{size:60,src:re.value.avatar,icon:A(n)},null,8,["src","icon"])]),_:1}),L(Le,{label:"用户ID"},{default:B(()=>[H(E(re.value.id),1)]),_:1}),L(Le,{label:"用户名"},{default:B(()=>[H(E(re.value.username),1)]),_:1}),L(Le,{label:"昵称"},{default:B(()=>[H(E(re.value.nickname||"未设置"),1)]),_:1}),L(Le,{label:"邮箱"},{default:B(()=>[H(E(re.value.email||"未设置"),1)]),_:1}),L(Le,{label:"手机号"},{default:B(()=>[H(E(re.value.phone||"未设置"),1)]),_:1}),L(Le,{label:"角色"},{default:B(()=>[L(Te,{type:"admin"===re.value.role?"danger":"primary"},{default:B(()=>[H(E("admin"===re.value.role?"管理员":"普通用户"),1)]),_:1},8,["type"])]),_:1}),L(Le,{label:"状态"},{default:B(()=>[L(Te,{type:ke(re.value.status)},{default:B(()=>[H(E(je(re.value.status)),1)]),_:1},8,["type"])]),_:1}),L(Le,{label:"启用状态"},{default:B(()=>[L(Te,{type:re.value.enabled?"success":"danger"},{default:B(()=>[H(E(re.value.enabled?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),L(Le,{label:"创建时间"},{default:B(()=>[H(E(Ue(re.value.createTime)),1)]),_:1}),L(Le,{label:"更新时间"},{default:B(()=>[H(E(Ue(re.value.updateTime)),1)]),_:1}),L(Le,{label:"最后登录"},{default:B(()=>[H(E(Ue(re.value.lastLoginTime)||"从未登录"),1)]),_:1}),L(Le,{label:"备注",span:2},{default:B(()=>[H(E(re.value.remark||"无"),1)]),_:1})]),_:1})])):F("",!0)]),_:1},8,["modelValue"]),L(He,{modelValue:oe.value,"onUpdate:modelValue":S[18]||(S[18]=e=>oe.value=e),title:ue.value?"编辑用户":"添加用户",width:"600px","before-close":Ve},{footer:B(()=>[$("span",ee,[L(q,{onClick:Ve},{default:B(()=>S[26]||(S[26]=[H("取消")])),_:1}),L(q,{type:"primary",onClick:ye,loading:ae.value},{default:B(()=>[H(E(ue.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:B(()=>[L(De,{model:pe,rules:me,ref_key:"userFormRef",ref:de,"label-width":"100px"},{default:B(()=>[L(xe,{gutter:16},{default:B(()=>[L(we,{span:12},{default:B(()=>[L(Ae,{label:"用户名",prop:"username"},{default:B(()=>[L(te,{modelValue:pe.username,"onUpdate:modelValue":S[7]||(S[7]=e=>pe.username=e),placeholder:"请输入用户名",disabled:ue.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),L(we,{span:12},{default:B(()=>[L(Ae,{label:"昵称",prop:"nickname"},{default:B(()=>[L(te,{modelValue:pe.nickname,"onUpdate:modelValue":S[8]||(S[8]=e=>pe.nickname=e),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),L(xe,{gutter:16},{default:B(()=>[L(we,{span:12},{default:B(()=>[L(Ae,{label:"邮箱",prop:"email"},{default:B(()=>[L(te,{modelValue:pe.email,"onUpdate:modelValue":S[9]||(S[9]=e=>pe.email=e),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),L(we,{span:12},{default:B(()=>[L(Ae,{label:"手机号",prop:"phone"},{default:B(()=>[L(te,{modelValue:pe.phone,"onUpdate:modelValue":S[10]||(S[10]=e=>pe.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),ue.value?F("",!0):(R(),O(xe,{key:0,gutter:16},{default:B(()=>[L(we,{span:12},{default:B(()=>[L(Ae,{label:"密码",prop:"password"},{default:B(()=>[L(te,{modelValue:pe.password,"onUpdate:modelValue":S[11]||(S[11]=e=>pe.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),L(we,{span:12},{default:B(()=>[L(Ae,{label:"确认密码",prop:"confirmPassword"},{default:B(()=>[L(te,{modelValue:pe.confirmPassword,"onUpdate:modelValue":S[12]||(S[12]=e=>pe.confirmPassword=e),type:"password",placeholder:"请确认密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),L(xe,{gutter:16},{default:B(()=>[L(we,{span:12},{default:B(()=>[L(Ae,{label:"角色",prop:"role"},{default:B(()=>[L(ze,{modelValue:pe.role,"onUpdate:modelValue":S[13]||(S[13]=e=>pe.role=e),placeholder:"请选择角色"},{default:B(()=>[L(Ce,{label:"普通用户",value:"user"}),L(Ce,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),L(we,{span:12},{default:B(()=>[L(Ae,{label:"状态",prop:"status"},{default:B(()=>[L(ze,{modelValue:pe.status,"onUpdate:modelValue":S[14]||(S[14]=e=>pe.status=e),placeholder:"请选择状态"},{default:B(()=>[L(Ce,{label:"正常",value:0}),L(Ce,{label:"禁用",value:1}),L(Ce,{label:"锁定",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),L(Ae,{label:"头像",prop:"avatar"},{default:B(()=>[L(te,{modelValue:pe.avatar,"onUpdate:modelValue":S[15]||(S[15]=e=>pe.avatar=e),placeholder:"请输入头像URL"},null,8,["modelValue"])]),_:1}),L(Ae,{label:"备注",prop:"remark"},{default:B(()=>[L(te,{modelValue:pe.remark,"onUpdate:modelValue":S[16]||(S[16]=e=>pe.remark=e),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),L(Ae,{label:"启用状态"},{default:B(()=>[L(qe,{modelValue:pe.enabled,"onUpdate:modelValue":S[17]||(S[17]=e=>pe.enabled=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-734bc79a"]]);export{ae as default};
