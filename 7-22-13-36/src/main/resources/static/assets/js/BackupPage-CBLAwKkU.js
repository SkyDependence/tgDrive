import{_ as a}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                *//* empty css                  *//* empty css                   */import{i as e,ay as t,J as o,c as r,a as s,y as n,d as l,f as c,D as i,e as d}from"./element-plus-BpKNpHyv.js";import{s as u}from"./request-CJwrkdbI.js";import{d as p,r as m,c as f,P as v,H as h,o as g,a as y,u as w,R as b}from"./vue-vendor-B9yd_xiB.js";import"./vendor-BoV0XpOF.js";const _={class:"page-container"},j={class:"card-header"},k={class:"action-section"},R={class:"action-item"},x={class:"action-item"},B=a(p({__name:"BackupPage",setup(a){const p=m(!1),B=m(!1),C=m(),D=a=>{var e;"application/octet-stream"===(null==(e=a.raw)?void 0:e.type)||a.name.endsWith(".db")?n.confirm(`您确定要使用文件 "${a.name}" 恢复数据库吗？此操作不可逆。`,"警告",{confirmButtonText:"确定恢复",cancelButtonText:"取消",type:"warning"}).then(()=>{L(a)}).catch(()=>{s.info("已取消恢复操作")}):s.error("只能上传 .db 格式的数据库文件!")},L=async a=>{var e;if(!a.raw)return;B.value=!0;const t=new FormData;t.append("multipartFile",a.raw);try{const a=await u({url:"/backup/upload",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}});if(1!==a.data.code)throw new Error(a.data.msg||"数据库恢复失败");s.success("数据库恢复成功")}catch(o){s.error(o.message||"数据库恢复失败")}finally{B.value=!1,null==(e=C.value)||e.clearFiles()}},T=async()=>{p.value=!0;try{const a=await u({url:"/backup/download",method:"get",responseType:"blob"}),e=new Blob([a.data]),t=window.URL.createObjectURL(e),o=document.createElement("a");o.href=t;const r=(new Date).toISOString().slice(0,19).replace(/:/g,"-");o.setAttribute("download",`tgDrive-backup-${r}.db`),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(t),s.success("数据库备份下载成功")}catch(a){s.error("下载失败："+a.message)}finally{p.value=!1}};return(a,s)=>{const n=l,u=c,m=i,L=d,U=e;return g(),f("div",_,[v(U,{class:"content-card"},{header:h(()=>[y("div",j,[v(n,null,{default:h(()=>[v(w(t))]),_:1}),s[0]||(s[0]=y("span",null,"数据库管理",-1))])]),default:h(()=>[y("div",k,[y("div",R,[s[2]||(s[2]=y("h3",null,"备份数据库",-1)),s[3]||(s[3]=y("p",null,"将当前数据库下载为 .db 文件。请妥善保管备份文件。",-1)),v(u,{type:"primary",onClick:T,loading:p.value,icon:w(o),size:"large"},{default:h(()=>s[1]||(s[1]=[b(" 下载备份 ")])),_:1},8,["loading","icon"])]),v(m,{direction:"horizontal"}),y("div",x,[s[5]||(s[5]=y("h3",null,"恢复数据库",-1)),s[6]||(s[6]=y("p",null,"从 .db 备份文件恢复数据库。此操作将覆盖当前所有数据，请谨慎操作。",-1)),v(L,{ref_key:"uploadRef",ref:C,"auto-upload":!1,"show-file-list":!1,accept:".db","on-change":D},{default:h(()=>[v(u,{type:"danger",loading:B.value,icon:w(r),size:"large",plain:""},{default:h(()=>s[4]||(s[4]=[b(" 选择文件并恢复 ")])),_:1},8,["loading","icon"])]),_:1},512)])])]),_:1})])}}}),[["__scopeId","data-v-3422c4d6"]]);export{B as default};
