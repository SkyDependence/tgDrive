import{_ as e}from"./_plugin-vue_export-helper-Bm9C0Znx.js";/* empty css                   *//* empty css                *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css                 */import{d as l,j as a,r as i,w as o,G as t,H as s,o as n,a as r,P as u,u as c,R as d,c as v,O as p,K as f,I as m,M as w,n as y,f as g,y as h,ah as k,Q as _,aa as C,Y as b,$ as x}from"./vue-vendor-B9yd_xiB.js";import{s as I}from"./request-DAe7TuTT.js";import{I as j,J as z,K as U,l as V,L as $,d as L,M as N,f as B,N as M,a as T,i as P,O as R,P as F,Q as S,R as D,S as E,v as H,T as K,m as q,U as G,y as O,z as Q,V as W,W as Y,X as J,Y as X,Z,_ as A,$ as ee,k as le,a0 as ae}from"./element-plus-CPDzLibR.js";import{H as ie}from"./vendor-rGL9xwM8.js";const oe={class:"preview-container"},te={key:0,class:"image-preview"},se={key:1,class:"video-preview"},ne=["src"],re={key:2,class:"audio-preview"},ue={class:"audio-info"},ce=["src"],de={key:3,class:"pdf-preview"},ve=["src"],pe=["href"],fe={key:4,class:"text-preview"},me={class:"text-content"},we={key:5,class:"office-preview"},ye={class:"office-viewer"},ge=["src"],he={key:6,class:"code-preview"},ke=["innerHTML"],_e={key:7,class:"unsupported-preview"},Ce={class:"unsupported-content"},be={key:8,"element-loading-text":"加载中...",class:"loading-overlay"},xe={class:"dialog-footer"},Ie=e(l({__name:"FilePreview",props:{modelValue:{type:Boolean},fileInfo:{}},emits:["update:modelValue","download"],setup(e,{emit:l}){const g=e,h=l,k=a({get:()=>g.modelValue,set:e=>h("update:modelValue",e)}),_=i(!1),C=i(""),b=i(""),x=a(()=>{var e,l;return(null==(e=g.fileInfo)?void 0:e.fileName)&&(null==(l=g.fileInfo.fileName.split(".").pop())?void 0:l.toLowerCase())||""}),I=a(()=>["jpg","jpeg","png","gif","bmp","webp","svg"].includes(x.value)),P=a(()=>["mp4","avi","mov","wmv","flv","webm","mkv"].includes(x.value)),R=a(()=>["mp3","wav","flac","aac","ogg","m4a"].includes(x.value)),F=a(()=>"pdf"===x.value),S=a(()=>["txt","md","json","xml","csv","log"].includes(x.value)),D=a(()=>["doc","docx","xls","xlsx","ppt","pptx"].includes(x.value)),E=a(()=>["js","ts","vue","html","css","scss","less","java","py","cpp","c","go","rs","php","rb","swift","kt"].includes(x.value)),H=a(()=>{var e;return(null==(e=g.fileInfo)?void 0:e.downloadUrl)||""}),K=()=>({js:"javascript",ts:"typescript",vue:"vue",html:"html",css:"css",scss:"scss",less:"less",java:"java",py:"python",cpp:"cpp",c:"c",go:"go",rs:"rust",php:"php",rb:"ruby",swift:"swift",kt:"kotlin"}[x.value]||"plaintext"),q=e=>{const l="string"==typeof e?parseInt(e):e;if(0===l)return"0 B";const a=Math.floor(Math.log(l)/Math.log(1024));return parseFloat((l/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB","TB"][a]},G=async()=>{if(g.fileInfo&&(S.value||E.value)){_.value=!0;try{const e=await fetch(H.value),l=await e.text();if(E.value){const e=ie.highlight(l,{language:K()});b.value=e.value}else C.value=l}catch(e){T.error("加载文件内容失败")}finally{_.value=!1}}},O=()=>{g.fileInfo&&h("download",g.fileInfo)},Q=()=>{k.value=!1,C.value="",b.value=""};return o(()=>g.fileInfo,async e=>{e&&k.value&&(await y(),(S.value||E.value)&&G())},{immediate:!0}),o(k,async e=>{e&&g.fileInfo&&(await y(),(S.value||E.value)&&G())}),(e,l)=>{var a;const i=$,o=L,y=N,g=B,h=j,x=M;return n(),t(h,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=e=>k.value=e),title:(null==(a=e.fileInfo)?void 0:a.fileName)||"文件预览",width:"80%","before-close":Q,class:"file-preview-dialog"},{footer:s(()=>[r("div",xe,[u(g,{onClick:O},{default:s(()=>[u(o,null,{default:s(()=>[u(c(z))]),_:1}),l[4]||(l[4]=d(" 下载 "))]),_:1}),u(g,{type:"primary",onClick:Q},{default:s(()=>l[5]||(l[5]=[d("关闭")])),_:1})])]),default:s(()=>{var a,t,h,k;return[r("div",oe,[I.value?(n(),v("div",te,[u(i,{src:H.value,alt:null==(a=e.fileInfo)?void 0:a.fileName,fit:"contain",class:"preview-image","preview-src-list":[H.value],"initial-index":0,"preview-teleported":""},null,8,["src","alt","preview-src-list"])])):P.value?(n(),v("div",se,[r("video",{src:H.value,controls:"",class:"preview-video",preload:"metadata"}," 您的浏览器不支持视频播放 ",8,ne)])):R.value?(n(),v("div",re,[r("div",ue,[u(o,{size:"48",color:"#409EFF"},{default:s(()=>[u(c(U))]),_:1}),r("h3",null,p(null==(t=e.fileInfo)?void 0:t.fileName),1)]),r("audio",{src:H.value,controls:"",class:"preview-audio",preload:"metadata"}," 您的浏览器不支持音频播放 ",8,ce)])):F.value?(n(),v("div",de,[r("iframe",{src:H.value,class:"preview-iframe",frameborder:"0"},[l[1]||(l[1]=d(" 您的浏览器不支持PDF预览，请")),r("a",{href:H.value,target:"_blank"},"点击下载",8,pe)],8,ve)])):S.value?(n(),v("div",fe,[u(y,{height:"500px"},{default:s(()=>[r("pre",me,p(C.value),1)]),_:1})])):D.value?(n(),v("div",we,[r("div",ye,[r("iframe",{src:`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(H.value)}`,class:"preview-iframe",frameborder:"0"}," 文档预览加载中... ",8,ge)])])):E.value?(n(),v("div",he,[u(y,{height:"500px"},{default:s(()=>[r("pre",null,[r("code",{class:f(K()),innerHTML:b.value},null,10,ke)])]),_:1})])):(n(),v("div",_e,[r("div",Ce,[u(o,{size:"64",color:"#909399"},{default:s(()=>[u(c(V))]),_:1}),l[3]||(l[3]=r("h3",null,"暂不支持此文件类型的预览",-1)),r("p",null,"文件名: "+p(null==(h=e.fileInfo)?void 0:h.fileName),1),r("p",null,"文件大小: "+p(q(null==(k=e.fileInfo)?void 0:k.size)),1),u(g,{type:"primary",onClick:O},{default:s(()=>[u(o,null,{default:s(()=>[u(c(z))]),_:1}),l[2]||(l[2]=d(" 下载文件 "))]),_:1})])])),_.value?m((n(),v("div",be,null,512)),[[x,_.value]]):w("",!0)])]}),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-0f36186f"]]),je={class:"page-container"},ze={class:"card-header"},Ue={class:"header-left"},Ve={class:"header-right"},$e={style:{display:"flex","align-items":"center",gap:"8px"}},Le=["onClick"],Ne={key:2},Be=["onClick"],Me={class:"file-info"},Te=["onClick"],Pe={class:"file-meta"},Re={class:"file-actions"},Fe={class:"batch-actions"},Se={class:"dialog-footer"},De=e(l({__name:"FileList",setup(e){const l=i([]),o=i(!1),y=i(1),U=i(10),$=i(0),N=i(!1),ie=i([]),oe=i(!1),te=i(null),se=i(!1),ne=i(null),re=i(""),ue=i("/"),ce=a(()=>ue.value.split("/").filter(e=>e)),de=e=>{ue.value=e,y.value=1,re.value="",ye()},ve=i(!1),pe=i(""),fe=()=>{oe.value=window.innerWidth<768},me=e=>ie.value.some(l=>l.fileId===e.fileId),we=e=>{me(e)?ie.value=ie.value.filter(l=>l.fileId!==e.fileId):ie.value.push(e)},ye=async()=>{var e,a;o.value=!0;try{let i=`/fileList?page=${y.value}&size=${U.value}&path=${encodeURIComponent(ue.value)}`;re.value&&(i+=`&keyword=${encodeURIComponent(re.value)}`);const o=await I.get(i);if(1===(null==(e=o.data)?void 0:e.code)){const e=o.data.data;l.value=e.records||[],$.value=e.total||0}else T.error((null==(a=o.data)?void 0:a.msg)||"获取文件列表失败")}catch(i){T.error("获取文件列表失败，请检查网络")}finally{o.value=!1}},ge=e=>{ie.value=e},he=(e,l)=>{navigator.clipboard.writeText(e).then(()=>{T.success(l)}).catch(e=>{T.error("复制失败: "+e)})},ke=()=>{const e=ie.value.map(e=>`[${e.fileName}](${e.downloadUrl})`).join("\n");he(e,`已批量复制 ${ie.value.length} 个 Markdown 链接`)},_e=()=>{const e=ie.value.map(e=>e.downloadUrl).join("\n");he(e,`已批量复制 ${ie.value.length} 个下载链接`)},Ce=async()=>{var e,l;if(0!==ie.value.length)try{await O.confirm(`确定要删除选中的 ${ie.value.length} 个文件吗？此操作不可撤销。`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const e=ie.value.map(e=>I.delete(`/file/${e.fileId}`)),l=await Promise.allSettled(e);let a=0,i=0;l.forEach((e,l)=>{"fulfilled"===e.status&&1===e.value.data.code?a++:i++}),a>0&&T.success(`成功删除 ${a} 个文件`),i>0&&T.error(`${i} 个文件删除失败`),ie.value=[],ye()}catch(a){"cancel"!==a&&T.error("批量删除失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.msg)||a.message))}else T.warning("请先选择要删除的文件")},be=e=>new Date(1e3*e).toLocaleString("zh-CN",{hour12:!1}),xe=()=>{N.value=!0},De=async()=>{var e,l;N.value=!1;const a=T({message:"正在更新...",type:"info",duration:0});try{const a=await I.put("/file-url");1===(null==(e=a.data)?void 0:e.code)?(T.success("URL 更新成功"),ye()):T.error((null==(l=a.data)?void 0:l.msg)||"URL 更新失败")}catch(i){T.error("更新失败，请检查网络")}finally{a.close()}},Ee=e=>{y.value=e,ie.value=[],ye(),oe.value&&te.value&&(te.value.scrollTop=0)},He=e=>{U.value=e,y.value=1,ie.value=[],ye()},Ke=e=>{he(`[${e.fileName}](${e.downloadUrl})`,"Markdown 格式已复制")},qe=e=>{he(e.downloadUrl,"下载链接已复制")},Ge=e=>{window.open(e,"_blank")},Oe=e=>{ne.value=e,se.value=!0},Qe=e=>{Ge(e.downloadUrl)},We=async()=>{if(!pe.value)return void T.warning("请输入文件夹名称");const e=ue.value+pe.value;try{const l=await I.post("/folder",null,{params:{folderPath:e}});1===l.data.code?(T.success("文件夹创建成功"),ve.value=!1,pe.value="",ye()):T.error(l.data.msg||"创建失败")}catch(l){T.error("创建文件夹失败")}},Ye=e=>{e.dir?de(e.webdavPath):Oe(e)},Je=async e=>{var l,a;try{let l;await O.confirm(`确定要删除${e.dir?"文件夹":"文件"} "${e.fileName}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),l=e.dir?await I.delete("/folder",{params:{folderPath:e.webdavPath}}):await I.delete(`/file/${e.fileId}`),1===l.data.code?(T.success((e.dir?"文件夹":"文件")+"删除成功"),ie.value=ie.value.filter(l=>l.fileId!==e.fileId),ye()):T.error(l.data.msg||"删除失败")}catch(i){"cancel"!==i&&T.error("删除失败: "+((null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||i.message))}},Xe=()=>{y.value=1,ye()},Ze=()=>{re.value="",y.value=1,ye()};return g(()=>{fe(),window.addEventListener("resize",fe),ye()}),h(()=>{window.removeEventListener("resize",fe)}),(e,a)=>{const i=L,g=Q,h=B,I=W,T=Y,O=J,ue=X,fe=Z,ye=le,he=ae,Ae=A,el=P,ll=j,al=M;return n(),v("div",je,[u(el,{class:"content-card"},{header:s(()=>[r("div",ze,[r("div",Ue,[u(i,null,{default:s(()=>[u(c(R))]),_:1}),a[12]||(a[12]=r("span",null,"文件列表",-1))]),r("div",Ve,[u(g,{modelValue:re.value,"onUpdate:modelValue":a[0]||(a[0]=e=>re.value=e),placeholder:"搜索文件名",clearable:"",style:{width:"200px","margin-right":"10px"},onKeyup:k(Xe,["enter"])},null,8,["modelValue"]),u(h,{type:"primary",onClick:Xe,icon:c(F)},{default:s(()=>a[13]||(a[13]=[d("搜索")])),_:1},8,["icon"]),u(h,{type:"default",onClick:Ze,icon:c(S)},{default:s(()=>a[14]||(a[14]=[d("全部")])),_:1},8,["icon"]),u(h,{type:"primary",onClick:a[1]||(a[1]=e=>ve.value=!0),icon:c(D),style:{"margin-left":"10px"}},{default:s(()=>a[15]||(a[15]=[d("创建文件夹")])),_:1},8,["icon"]),u(h,{type:"primary",onClick:xe,icon:c(S),style:{"margin-left":"10px"}},{default:s(()=>a[16]||(a[16]=[d("更新 URL 前缀")])),_:1},8,["icon"])])])]),default:s(()=>[u(T,{separator:"/",style:{margin:"10px 20px"}},{default:s(()=>[u(I,{onClick:a[2]||(a[2]=e=>de("/"))},{default:s(()=>a[17]||(a[17]=[d("根目录")])),_:1}),(n(!0),v(_,null,C(ce.value,(e,l)=>(n(),t(I,{key:l,onClick:e=>de((e=>"/"+ce.value.slice(0,e+1).join("/")+"/")(l))},{default:s(()=>[d(p(e),1)]),_:2},1032,["onClick"]))),128))]),_:1}),oe.value?w("",!0):m((n(),t(fe,{key:0,data:l.value,onSelectionChange:ge,height:"calc(100vh - 280px)",style:{width:"100%"}},{default:s(()=>[u(O,{type:"selection",width:"55",align:"center"}),u(O,{prop:"fileName",label:"文件名","min-width":"200","show-overflow-tooltip":"",fixed:"left"},{default:s(e=>[r("div",$e,[e.row.dir?(n(),t(i,{key:0},{default:s(()=>[u(c(E))]),_:1})):(n(),t(i,{key:1},{default:s(()=>[u(c(V))]),_:1})),r("span",{onClick:l=>Ye(e.row),style:b({cursor:e.row.dir?"pointer":"default",color:e.row.dir?"var(--el-color-primary)":"inherit"})},p(e.row.fileName),13,Le)])]),_:1}),u(O,{prop:"size",label:"大小",width:"120",align:"center"}),u(O,{prop:"uploadTime",label:"上传时间",width:"180",align:"center"},{default:s(e=>[d(p(be(e.row.uploadTime)),1)]),_:1}),u(O,{label:"操作",width:"480",align:"center",fixed:"right"},{default:s(e=>[u(ue,null,{default:s(()=>[u(h,{type:"info",size:"small",onClick:l=>Oe(e.row),icon:c(H)},{default:s(()=>a[18]||(a[18]=[d("预览")])),_:2},1032,["onClick","icon"]),u(h,{type:"primary",size:"small",onClick:l=>Ke(e.row),icon:c(K)},{default:s(()=>a[19]||(a[19]=[d("Markdown")])),_:2},1032,["onClick","icon"]),u(h,{type:"success",size:"small",onClick:l=>qe(e.row),icon:c(q)},{default:s(()=>a[20]||(a[20]=[d("链接")])),_:2},1032,["onClick","icon"]),u(h,{type:"warning",size:"small",onClick:l=>Ge(e.row.downloadUrl),icon:c(z)},{default:s(()=>a[21]||(a[21]=[d("下载")])),_:2},1032,["onClick","icon"]),u(h,{type:"danger",size:"small",onClick:l=>Je(e.row),icon:c(G)},{default:s(()=>a[22]||(a[22]=[d("删除")])),_:2},1032,["onClick","icon"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[al,o.value]]),oe.value?(n(),v("div",{key:1,class:"mobile-file-list",ref_key:"mobileListRef",ref:te},[0!==l.value.length||o.value?w("",!0):(n(),t(ye,{key:0,description:"暂无文件"})),o.value?(n(),t(he,{key:1,rows:5,animated:""})):(n(),v("div",Ne,[(n(!0),v(_,null,C(l.value,e=>(n(),v("div",{key:e.fileId,class:f(["mobile-file-item",{"is-selected":me(e)}]),onClick:l=>we(e)},[r("div",Me,[u(c(ee),{"model-value":me(e),onChange:()=>we(e),onClick:a[3]||(a[3]=x(()=>{},["stop"])),size:"large",class:"mobile-checkbox"},null,8,["model-value","onChange"]),e.dir?(n(),t(i,{key:0,class:"file-icon"},{default:s(()=>[u(c(E))]),_:1})):(n(),t(i,{key:1,class:"file-icon"},{default:s(()=>[u(c(V))]),_:1})),r("span",{class:"file-name-mobile",onClick:x(l=>Ye(e),["stop"]),style:b({cursor:e.dir?"pointer":"default",color:e.dir?"var(--el-color-primary)":"inherit"})},p(e.fileName),13,Te)]),r("div",Pe,[r("span",null,"大小: "+p(e.size),1),r("span",null,"上传时间: "+p(be(e.uploadTime)),1)]),r("div",Re,[u(ue,null,{default:s(()=>[u(h,{type:"info",size:"small",onClick:x(l=>Oe(e),["stop"]),icon:c(H),circle:""},null,8,["onClick","icon"]),u(h,{type:"primary",size:"small",onClick:x(l=>Ke(e),["stop"]),icon:c(K),circle:""},null,8,["onClick","icon"]),u(h,{type:"success",size:"small",onClick:x(l=>qe(e),["stop"]),icon:c(q),circle:""},null,8,["onClick","icon"]),u(h,{type:"warning",size:"small",onClick:x(l=>Ge(e.downloadUrl),["stop"]),icon:c(z),circle:""},null,8,["onClick","icon"]),u(h,{type:"danger",size:"small",onClick:x(l=>Je(e),["stop"]),icon:c(G),circle:""},null,8,["onClick","icon"])]),_:2},1024)])],10,Be))),128))]))],512)):w("",!0),r("div",{class:f(["footer-toolbar",{"is-mobile":oe.value}])},[r("div",Fe,[u(h,{type:"primary",onClick:ke,disabled:0===ie.value.length,icon:c(K),plain:""},{default:s(()=>a[23]||(a[23]=[d(" 批量复制 (MD) ")])),_:1},8,["disabled","icon"]),u(h,{type:"success",onClick:_e,disabled:0===ie.value.length,icon:c(q),plain:""},{default:s(()=>a[24]||(a[24]=[d(" 批量复制 (链接) ")])),_:1},8,["disabled","icon"]),u(h,{type:"danger",onClick:Ce,disabled:0===ie.value.length,icon:c(G),plain:""},{default:s(()=>[d(" 批量删除 ("+p(ie.value.length)+") ",1)]),_:1},8,["disabled","icon"])]),$.value>0?(n(),t(Ae,{key:0,"current-page":y.value,"onUpdate:currentPage":a[4]||(a[4]=e=>y.value=e),"page-size":U.value,"onUpdate:pageSize":a[5]||(a[5]=e=>U.value=e),total:$.value,"page-sizes":[10,20,50,100],layout:oe.value?"sizes, prev, pager, next":"total, sizes, prev, pager, next, jumper",onSizeChange:He,onCurrentChange:Ee,background:"",small:""},null,8,["current-page","page-size","total","layout"])):w("",!0)],2)]),_:1}),u(ll,{modelValue:N.value,"onUpdate:modelValue":a[7]||(a[7]=e=>N.value=e),title:"更新 URL 前缀",width:"500px"},{footer:s(()=>[r("span",Se,[u(h,{onClick:a[6]||(a[6]=e=>N.value=!1)},{default:s(()=>a[25]||(a[25]=[d("取消")])),_:1}),u(h,{type:"primary",onClick:De},{default:s(()=>a[26]||(a[26]=[d("确认更新")])),_:1})])]),default:s(()=>[a[27]||(a[27]=r("span",null," 此操作将根据服务器最新配置，更新所有文件的下载链接前缀。当您更换了域名或IP地址后，可以使用此功能。 ",-1))]),_:1},8,["modelValue"]),u(Ie,{modelValue:se.value,"onUpdate:modelValue":a[8]||(a[8]=e=>se.value=e),"file-info":ne.value,onDownload:Qe},null,8,["modelValue","file-info"]),u(ll,{modelValue:ve.value,"onUpdate:modelValue":a[11]||(a[11]=e=>ve.value=e),title:"创建文件夹",width:"300px"},{footer:s(()=>[u(h,{onClick:a[10]||(a[10]=e=>ve.value=!1)},{default:s(()=>a[28]||(a[28]=[d("取消")])),_:1}),u(h,{type:"primary",onClick:We},{default:s(()=>a[29]||(a[29]=[d("创建")])),_:1})]),default:s(()=>[u(g,{modelValue:pe.value,"onUpdate:modelValue":a[9]||(a[9]=e=>pe.value=e),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-5af2b14d"]]);export{De as default};
